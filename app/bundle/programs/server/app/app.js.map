{"version":3,"sources":["meteor://ğŸ’»app/server/lib/cordova/facebook-login.js","meteor://ğŸ’»app/server/lib/accounts.js","meteor://ğŸ’»app/server/lib/cordova.js","meteor://ğŸ’»app/server/startup/migrations/v001.js","meteor://ğŸ’»app/server/startup/migrations/v002.js","meteor://ğŸ’»app/server/startup/migrations/v003.js","meteor://ğŸ’»app/server/startup/migrations/v004.js","meteor://ğŸ’»app/server/startup/migrations/v005.js","meteor://ğŸ’»app/server/startup/migrations/v006.js","meteor://ğŸ’»app/server/startup/migrations/v007.js","meteor://ğŸ’»app/server/startup/migrations/v008.js","meteor://ğŸ’»app/server/startup/migrations/v009.js","meteor://ğŸ’»app/server/startup/migrations/v010.js","meteor://ğŸ’»app/server/startup/migrations/v011.js","meteor://ğŸ’»app/server/startup/migrations/v012.js","meteor://ğŸ’»app/server/startup/migrations/v013.js","meteor://ğŸ’»app/server/startup/migrations/v014.js","meteor://ğŸ’»app/server/startup/migrations/v015.js","meteor://ğŸ’»app/server/startup/migrations/v016.js","meteor://ğŸ’»app/server/startup/migrations/v017.js","meteor://ğŸ’»app/server/startup/migrations/v018.js","meteor://ğŸ’»app/server/startup/migrations/v019.js","meteor://ğŸ’»app/server/startup/migrations/v020.js","meteor://ğŸ’»app/server/startup/migrations/v021.js","meteor://ğŸ’»app/server/startup/migrations/v022.js","meteor://ğŸ’»app/server/startup/migrations/v023.js","meteor://ğŸ’»app/server/startup/migrations/v024.js","meteor://ğŸ’»app/server/startup/migrations/v025.js","meteor://ğŸ’»app/server/startup/migrations/v026.js","meteor://ğŸ’»app/server/startup/migrations/v027.js","meteor://ğŸ’»app/server/startup/migrations/v028.js","meteor://ğŸ’»app/server/startup/migrations/v029.js","meteor://ğŸ’»app/server/startup/migrations/v030.js","meteor://ğŸ’»app/server/startup/migrations/v031.js","meteor://ğŸ’»app/server/startup/migrations/v032.js","meteor://ğŸ’»app/server/startup/migrations/v033.js","meteor://ğŸ’»app/server/startup/migrations/v034.js","meteor://ğŸ’»app/server/startup/migrations/v035.js","meteor://ğŸ’»app/server/startup/migrations/v036.js","meteor://ğŸ’»app/server/startup/migrations/v037.js","meteor://ğŸ’»app/server/startup/migrations/v038.js","meteor://ğŸ’»app/server/startup/migrations/v039.js","meteor://ğŸ’»app/server/startup/migrations/v040.js","meteor://ğŸ’»app/server/startup/migrations/v041.js","meteor://ğŸ’»app/server/startup/migrations/v042.js","meteor://ğŸ’»app/server/startup/migrations/v043.js","meteor://ğŸ’»app/server/startup/migrations/v044.js","meteor://ğŸ’»app/server/startup/migrations/v045.js","meteor://ğŸ’»app/server/startup/migrations/v046.js","meteor://ğŸ’»app/server/startup/migrations/v047.js","meteor://ğŸ’»app/server/startup/migrations/v048.js","meteor://ğŸ’»app/server/startup/migrations/v049.js","meteor://ğŸ’»app/server/startup/migrations/v050.js","meteor://ğŸ’»app/server/startup/migrations/v051.js","meteor://ğŸ’»app/server/startup/migrations/v052.js","meteor://ğŸ’»app/server/startup/migrations/v053.js","meteor://ğŸ’»app/server/startup/migrations/v054.js","meteor://ğŸ’»app/server/startup/migrations/v055.js","meteor://ğŸ’»app/server/startup/migrations/v056.js","meteor://ğŸ’»app/server/startup/migrations/v057.js","meteor://ğŸ’»app/server/startup/migrations/v058.js","meteor://ğŸ’»app/server/startup/migrations/v059.js","meteor://ğŸ’»app/server/startup/migrations/v060.js","meteor://ğŸ’»app/server/startup/migrations/v061.js","meteor://ğŸ’»app/server/startup/migrations/v062.js","meteor://ğŸ’»app/server/startup/migrations/v063.js","meteor://ğŸ’»app/server/startup/migrations/v064.js","meteor://ğŸ’»app/server/startup/migrations/v065.js","meteor://ğŸ’»app/server/startup/migrations/v066.js","meteor://ğŸ’»app/server/startup/migrations/v067.js","meteor://ğŸ’»app/server/startup/migrations/v068.js","meteor://ğŸ’»app/server/startup/migrations/v069.js","meteor://ğŸ’»app/server/startup/migrations/v070.js","meteor://ğŸ’»app/server/startup/migrations/v071.js","meteor://ğŸ’»app/server/startup/migrations/v072.js","meteor://ğŸ’»app/server/startup/migrations/v073.js","meteor://ğŸ’»app/server/startup/migrations/v074.js","meteor://ğŸ’»app/server/startup/migrations/v075.js","meteor://ğŸ’»app/server/startup/migrations/v076.js","meteor://ğŸ’»app/server/startup/migrations/v077.js","meteor://ğŸ’»app/server/startup/migrations/v078.js","meteor://ğŸ’»app/server/startup/migrations/v079.js","meteor://ğŸ’»app/server/startup/migrations/v080.js","meteor://ğŸ’»app/server/startup/migrations/v081.js","meteor://ğŸ’»app/server/startup/migrations/v082.js","meteor://ğŸ’»app/server/startup/migrations/v083.js","meteor://ğŸ’»app/server/startup/migrations/v084.js","meteor://ğŸ’»app/server/startup/migrations/v085.js","meteor://ğŸ’»app/server/startup/migrations/v086.js","meteor://ğŸ’»app/server/startup/migrations/v087.js","meteor://ğŸ’»app/server/startup/migrations/v088.js","meteor://ğŸ’»app/server/startup/migrations/v089.js","meteor://ğŸ’»app/server/startup/migrations/v090.js","meteor://ğŸ’»app/server/startup/migrations/v091.js","meteor://ğŸ’»app/server/startup/migrations/v092.js","meteor://ğŸ’»app/server/startup/migrations/v093.js","meteor://ğŸ’»app/server/startup/migrations/v094.js","meteor://ğŸ’»app/server/startup/migrations/v095.js","meteor://ğŸ’»app/server/startup/migrations/v096.js","meteor://ğŸ’»app/server/startup/migrations/v097.js","meteor://ğŸ’»app/server/startup/migrations/v098.js","meteor://ğŸ’»app/server/startup/migrations/v099.js","meteor://ğŸ’»app/server/startup/migrations/v100.js","meteor://ğŸ’»app/server/startup/migrations/v101.js","meteor://ğŸ’»app/server/startup/migrations/v102.js","meteor://ğŸ’»app/server/startup/migrations/v103.js","meteor://ğŸ’»app/server/startup/migrations/v104.js","meteor://ğŸ’»app/server/startup/migrations/v105.js","meteor://ğŸ’»app/server/startup/migrations/xrun.js","meteor://ğŸ’»app/server/startup/appcache.js","meteor://ğŸ’»app/server/startup/avatar.js","meteor://ğŸ’»app/server/startup/cron.js","meteor://ğŸ’»app/server/startup/i18n-validation.js","meteor://ğŸ’»app/server/startup/initialData.js","meteor://ğŸ’»app/server/startup/presence.js","meteor://ğŸ’»app/server/startup/roomPublishes.js","meteor://ğŸ’»app/server/startup/serverRunning.js","meteor://ğŸ’»app/server/configuration/accounts_meld.js","meteor://ğŸ’»app/server/methods/OEmbedCacheCleanup.js","meteor://ğŸ’»app/server/methods/addAllUserToRoom.js","meteor://ğŸ’»app/server/methods/addRoomLeader.js","meteor://ğŸ’»app/server/methods/addRoomModerator.js","meteor://ğŸ’»app/server/methods/addRoomOwner.js","meteor://ğŸ’»app/server/methods/afterVerifyEmail.js","meteor://ğŸ’»app/server/methods/canAccessRoom.js","meteor://ğŸ’»app/server/methods/channelsList.js","meteor://ğŸ’»app/server/methods/createDirectMessage.js","meteor://ğŸ’»app/server/methods/deleteFileMessage.js","meteor://ğŸ’»app/server/methods/deleteUser.js","meteor://ğŸ’»app/server/methods/eraseRoom.js","meteor://ğŸ’»app/server/methods/getAvatarSuggestion.js","meteor://ğŸ’»app/server/methods/getRoomIdByNameOrId.js","meteor://ğŸ’»app/server/methods/getRoomNameById.js","meteor://ğŸ’»app/server/methods/getTotalChannels.js","meteor://ğŸ’»app/server/methods/getUsernameSuggestion.js","meteor://ğŸ’»app/server/methods/getUsersOfRoom.js","meteor://ğŸ’»app/server/methods/groupsList.js","meteor://ğŸ’»app/server/methods/hideRoom.js","meteor://ğŸ’»app/server/methods/loadHistory.js","meteor://ğŸ’»app/server/methods/loadLocale.js","meteor://ğŸ’»app/server/methods/loadMissedMessages.js","meteor://ğŸ’»app/server/methods/loadNextMessages.js","meteor://ğŸ’»app/server/methods/loadSurroundingMessages.js","meteor://ğŸ’»app/server/methods/logoutCleanUp.js","meteor://ğŸ’»app/server/methods/messageSearch.js","meteor://ğŸ’»app/server/methods/migrate.js","meteor://ğŸ’»app/server/methods/muteUserInRoom.js","meteor://ğŸ’»app/server/methods/openRoom.js","meteor://ğŸ’»app/server/methods/readMessages.js","meteor://ğŸ’»app/server/methods/registerUser.js","meteor://ğŸ’»app/server/methods/removeRoomLeader.js","meteor://ğŸ’»app/server/methods/removeRoomModerator.js","meteor://ğŸ’»app/server/methods/removeRoomOwner.js","meteor://ğŸ’»app/server/methods/removeUserFromRoom.js","meteor://ğŸ’»app/server/methods/reportMessage.js","meteor://ğŸ’»app/server/methods/resetAvatar.js","meteor://ğŸ’»app/server/methods/roomNameExists.js","meteor://ğŸ’»app/server/methods/saveUserPreferences.js","meteor://ğŸ’»app/server/methods/saveUserProfile.js","meteor://ğŸ’»app/server/methods/sendConfirmationEmail.js","meteor://ğŸ’»app/server/methods/sendForgotPasswordEmail.js","meteor://ğŸ’»app/server/methods/setAvatarFromService.js","meteor://ğŸ’»app/server/methods/setUserActiveStatus.js","meteor://ğŸ’»app/server/methods/setUserPassword.js","meteor://ğŸ’»app/server/methods/toogleFavorite.js","meteor://ğŸ’»app/server/methods/unmuteUserInRoom.js","meteor://ğŸ’»app/server/methods/userSetUtcOffset.js","meteor://ğŸ’»app/server/publications/activeUsers.js","meteor://ğŸ’»app/server/publications/channelAndPrivateAutocomplete.js","meteor://ğŸ’»app/server/publications/fullUserData.js","meteor://ğŸ’»app/server/publications/messages.js","meteor://ğŸ’»app/server/publications/privateHistory.js","meteor://ğŸ’»app/server/publications/room.js","meteor://ğŸ’»app/server/publications/roomFiles.js","meteor://ğŸ’»app/server/publications/roomSubscriptionsByRole.js","meteor://ğŸ’»app/server/publications/spotlight.js","meteor://ğŸ’»app/server/publications/subscription.js","meteor://ğŸ’»app/server/publications/userAutocomplete.js","meteor://ğŸ’»app/server/publications/userChannels.js","meteor://ğŸ’»app/server/publications/userData.js","meteor://ğŸ’»app/server/stream/messages.js","meteor://ğŸ’»app/server/stream/streamBroadcast.js","meteor://ğŸ’»app/lib/RegExp.js","meteor://ğŸ’»app/lib/francocatena_fix.js"],"names":["_","module","watch","require","default","v","getIdentity","accessToken","HTTP","get","params","access_token","data","error","extend","Error","message","response","Accounts","registerLoginHandler","loginRequest","cordova","authResponse","identity","serviceData","expiresAt","Date","now","expiresIn","whitelisted","fields","pick","options","profile","updateOrCreateUserFromExternalService","s","accountsConfig","forbidClientAccountCreation","loginExpirationInDays","RocketChat","settings","config","emailTemplates","siteName","from","verifyEmailHtml","verifyEmail","text","html","user","url","replace","Meteor","absoluteUrl","resetPasswordHtml","resetPassword","enrollAccount","subject","TAPi18n","__","lng","language","placeholders","header","footer","name","email","emails","address","onCreateUser","callbacks","run","status","active","firstName","lastName","services","service","Object","values","username","verified","insertUserDoc","wrap","roles","Match","test","globalRoles","String","length","concat","password","defaultAuthServiceRoles","split","map","trim","type","_id","call","users","findOne","joinDefaultChannels","runAsUser","joinDefaultChannelsSilenced","defer","hasAdmin","models","Users","push","authz","addUserRoles","validateLoginAttempt","login","allowed","Array","isArray","includes","validEmail","filter","updateLastLoginById","validateNewUser","domainWhiteList","isEmpty","domain","inWhiteList","some","match","RegExp","escape","methods","push_test","method","hasRole","Push","enabled","query","$and","userId","$or","$exists","tokens","appCollection","find","count","send","title","apn","sound","sendPush","token","tries","post","statusCode","console","log","remove","SystemLogger","milli","Math","pow","setTimeout","configurePush","debug","allow","gcm","apiKey","projectNumber","passphrase","keyData","certData","gateway","undefined","Configure","production","sendInterval","sendBatchSize","serverSend","badge","forEach","app","topic","appName","startup","Migrations","add","version","up","lastLogin","generateUsernameSuggestion","setUsername","JSON","stringify","avatarOrigin","avatars","getAvatarSuggestionForUser","keys","dataURI","blob","image","contentType","RocketChatFile","dataURIParse","rs","bufferToStream","Buffer","fileStore","FileUpload","getStore","deleteByName","file","insert","setAvatarOrigin","Subscriptions","tryDropIndex","uid","nonreactive","sub","update","findOneById","$set","$unset","Rooms","room","$in","uids","usernames","t","k","oldId","sort","join","removeById","rid","multi","Messages","rn","$rename","item","Random","id","toLowerCase","setNameById","$ne","msgs","$lt","removeByRoomId","$size","newUserName","findOneByUsername","floor","random","findByType","newId","id0","id1","ids","u","by","findOneByName","upsert","index","urls","isString","OEmbed","rocketUrlParser","Settings","CDN_PREFIX","value","group","ENV","MAIL_URL","denyUnverifiedEmails","public","avatarStore","path","toMigrate","source","Mongo","Collection","target","model","OEmbedCache","collection","rawCollection","collectionName","doc","rawSource","wrapAsync","drop","err","errmsg","newUsernames","uniq","admin","findOneAdmin","oldestUser","createdAt","setAllUsersActive","metaKeys","old","new","oldAndNew","oldSetting","oldValue","newSetting","newValue","oldFilesCollection","oldGridFSCollection","oldChunkCollection","newFilesCollection","Uploads","newGridFSCollection","newChunkCollection","cfsRecord","nameParts","original","extension","pop","record","size","complete","uploading","store","uploadedAt","updatedAt","oldGridFsFile","ObjectID","copies","files","key","filename","chunkSize","uploadDate","aliases","metadata","md5","files_id","oldChunk","n","urlsItem","parsedUrl","pathname","msg","_hidden","changes","Accounts_Facebook","Accounts_Facebook_id","Accounts_Facebook_secret","Accounts_Google","Accounts_Google_id","Accounts_Google_secret","Accounts_Github","Accounts_Github_id","Accounts_Github_secret","Accounts_Gitlab","Accounts_Gitlab_id","Accounts_Gitlab_secret","Accounts_Linkedin","Accounts_Linkedin_id","Accounts_Linkedin_secret","Accounts_Meteor","Accounts_Meteor_id","Accounts_Meteor_secret","Accounts_Twitter","Accounts_Twitter_id","Accounts_Twitter_secret","to","ServiceConfiguration","configurations","admins","fetch","pluck","green","rooms","findByTypes","creator","msgQuery","msgOptions","cursorFileMessages","$multi","i18nLabel","upgradeEtsToEditAt","Permissions","persistent","hidden","mentions","_roles","scope","Roles","addRole","LDAP_Url","LDAP_TLS","LDAP_DN","LDAP_Bind_Search","$setOnInsert","WebRTC_STUN_Server","WebRTC_TURN_Server","WebRTC_TURN_Username","WebRTC_TURN_Password","servers","encodeURIComponent","API_Analytics","scriptAlert","integrations","Integrations","script","processIncomingRequestScript","prepareOutgoingRequestScript","processOutgoingResponseScript","integration","loginHeader","requestUrl","resolve","result","npmRequestOptions","encoding","Assets","setAsset","content","headers","e","addUserPermission","allowPinning","$addToSet","footerValue","packageValue","customOauth","parts","bot","__migration_assets_files","chunks","__migration_assets_chunks","list","oldFile","mime","updateById","defaultUrl","assets","newRoomNotification","preferences","disableNewRoomNotification","newMessageNotification","disableNewMessageNotification","optOut","i18nDescription","favoriteRooms","lastVisitor","limit","lastNumber","parseInt","autolinkerUrls","RocketBot_Enabled","RocketBot_Name","ts","code","tryEnsureIndex","label","escapeHTML","Statistics","installedAt","subscriptions","$not","$type","subscription","setArchivedByUsername","forward","timeout","replace1","replace2","replace3","replace4","replace5","replace6","oldColor","LivechatDepartment","showOnRegistration","GoogleSiteVerification_id","setting","reactions","visitor","visitorEmails","oauth","athorizedClients","section","channel","OAuthApps","redirectUri","getUsersInRole","removeUserFromRoles","oldPermission","down","newPermission","rids","outgoingIntegrations","i","event","retryFailedCalls","retryCount","retryDelay","linkedin","setName","runOnEdits","emailAddress","existingUser","emailHeader","emailFooter","startWithHTML","endsWithHTML","fs","args","logError","insertAvatar","details","avatarsFileStore","stream","callback","Promise","batch","arr","fn","all","splice","then","s3","direct","AmazonS3","GoogleStorage","googleCloudStorage","avatarOrigins","avatarsPathRecord","avatarStoreTypeRecord","avatarsPath","process","env","AVATARS_PATH","avatarStoreType","oldAvatarGridFS","GridFS","countSync","Number","error_box","usersTotal","current","gridFSAvatar","getFileWithReadStream","readStream","deleteFile","filePath","stat","statSync","isFile","createReadStream","unlinkSync","avatarsFiles","avatarsChunks","audioNotification","lastActivity","LDAP_Domain_Base","LDAP_Domain_Search_User_ID","LDAP_Use_Custom_Domain_Search","LDAP_Custom_Domain_Search","LDAP_Domain_Search_User","LDAP_Domain_Search_Password","LDAP_Domain_Search_Filter","LDAP_Domain_Search_Object_Class","LDAP_Domain_Search_Object_Category","Custom_Domain_Search","parse","userDN","LDAP_Sync_User_Data","LDAP_Import_Users","majorColors","newvariables","lightenDarkenColor","col","amt","usePound","slice","num","r","b","g","toString","color","editor","newPreference","unreadRoomsMode","settingsMap","newSettingKey","getVersion","migrateTo","MIGRATION_VERSION","control","_getControl","last","_list","_setControl","AppCache","onlineOnly","WebApp","connectHandlers","use","bindEnvironment","req","res","decodeURIComponent","writeHead","write","end","exec","sandstorm","picture","setHeader","Avatars","reqModifiedHeader","initials","getAvatarColor","substr","toUpperCase","svg","logger","Logger","SyncedCron","opts","level","generateStatistics","statistics","save","host","warn","cleanupOEmbedCache","schedule","parser","cron","getMinutes","job","getHours","start","flat","obj","newObj","isObject","i18nValidation","l","errors","langs","TAPi18next","resStore","lang","len","present","difference","red","white","rpad","createWithIdTypeAndName","db","create","statusDefault","utcOffset","getBinary","ADMIN_PASS","adminUser","ADMIN_NAME","ADMIN_EMAIL","re","findOneByEmailAddress","ADMIN_USERNAME","nameValidation","checkUsernameAvailability","setPassword","INITIAL_USER","initialUser","TEST_MODE","addUserToDefaultChannels","instance","port","PORT","INSTANCE_IP","InstanceStatus","registerInstance","UserPresence","UserPresenceMonitor","roomTypes","setPublish","identifier","cl","announcement","muted","archived","ro","reactWhenReadOnly","jitsiTimeout","description","sysMes","joinCodeRequired","hasPermission","findByTypeAndName","roomId","findByTypeNameAndUserId","findById","ready","tokenpass","findByTypeAndNameContainingUsername","hasAtLeastOnePermission","findByTypeContainingUsernames","semver","oplogState","MongoInternals","defaultRemoteCollectionDriver","mongo","_oplogHandle","onOplogEntry","desiredNodeVersion","clean","readFileSync","cwd","desiredNodeVersionMajor","major","Info","versions","node","arch","platform","commit","hash","branch","satisfies","startup_box","exit","orig_updateOrCreateUserFromExternalService","serviceName","_OAuthCustom","primaryEmail","a","primary","findQuery","findWhere","resetPasswordAndSetRequirePasswordChange","setServiceId","setEmailVerified","apply","arguments","OEmbedCacheCleanup","date","expirationDays","setDate","getDate","removeAfterDate","addAllUserToRoom","activeUsersOnly","check","Boolean","userCount","userFilter","findOneByRoomIdAndUserId","addUsernameById","createWithRoomAndUser","open","alert","unread","userMentions","groupMentions","createUserJoinWithRoomIdAndUser","addRoomLeader","addRoleById","fromUser","createSubscriptionRoleAddedWithRoomIdAndUser","role","Notifications","notifyLogged","addRoomModerator","addRoomOwner","afterVerifyEmail","verifiedEmail","removeUserRoles","canAccessRoom","Maybe","channelsList","channelType","unblock","Optional","isNumber","roomIds","findByTypeAndUserId","userPref","getUserPreference","globalPref","mergeChannels","channels","findByNameContainingTypesWithUsername","findContainingTypesWithUsername","createDirectMessage","me","upsertSubscription","ls","RateLimiter","limitMethod","deleteFileMessage","fileID","getMessageByFileId","deleteById","deleteUser","adminCount","userIsAdmin","indexOf","action","eraseRoom","canBeDeleted","facebook","google","github","pictureUrl","twitter","profile_image_url_https","gitlab","avatar_url","Gravatar","imageUrl","secure","validAvatars","avatar","getAvatarSuggestion","getRoomIdByNameOrId","getRoomNameById","getTotalChannels","slug","slugify","usernameIsAvaliable","generateSuggestion","preferredHandle","first","flatten","compact","getUsernameSuggestion","getUsersOfRoom","showAll","_user","records","findByRoomId","total","groupsList","nameFilter","groups","escapeRegExp","findByIds","hideRoom","hideByRoomIdAndUserId","hideMessagesOfType","types","loadHistory","fromId","canAnonymous","canPreview","editedAt","findVisibleByRoomIdBeforeTimestampNotContainingTypes","findVisibleByRoomIdNotContainingTypes","UI_Use_Real_Name","messages","starred","mention","unreadNotLoaded","firstUnread","firstMessage","unreadMessages","findVisibleByRoomIdBetweenTimestampsNotContainingTypes","loadLocale","locale","getText","shift","loadMissedMessages","findVisibleByRoomIdAfterTimestamp","loadNextMessages","findVisibleByRoomId","loadSurroundingMessages","ceil","recordsBefore","findVisibleByRoomIdBeforeTimestamp","moreBefore","recordsAfter","afterMessages","moreAfter","logoutCleanUp","messageSearch","currentUserId","currentUserName","currentUserTimezoneOffset","filterStarred","filterUrl","filterPinned","pinned","filterLocation","location","$exist","filterBeforeDate","day","month","year","beforeDate","setHours","getUTCHours","getTimezoneOffset","$lte","filterAfterDate","afterDate","setUTCHours","$gte","filterOnDate","dayAfter","filterLabel","tag","sortByTimestamp","direction","startsWith","$regex","$options","$text","$search","score","$meta","getMigrationVersion","muteUserInRoom","ObjectIncluding","mutedUser","muteUsernameByRoomId","createUserMutedWithRoomIdAndUser","openRoom","openByRoomIdAndUserId","readMessages","setAsReadByRoomIdAndUserId","registerUser","formData","AllowAnonymousRead","AllowAnonymousWrite","_loginUser","pass","secretURL","validateEmailDomain","userData","importedUser","importIds","createUser","saveCustomFields","userModel","sendVerificationEmail","removeRoomLeader","removeRoleById","createSubscriptionRoleRemovedWithRoomIdAndUser","removeRoomModerator","removeRoomOwner","numOwners","removeUserFromRoom","removedUser","removeUsernameById","removeByRoomIdAndUserId","createUserRemovedWithRoomIdAndUser","reportMessage","messageId","Reports","createWithMessageDescriptionAndUserId","resetAvatar","unsetAvatarOrigin","DDPRateLimiter","addRule","roomNameExists","saveUserPreferences","setLanguage","useEmojis","convertAsciiEmoji","saveMobileBandwidth","collapseMediaByDefault","autoImageLoad","emailNotificationMode","roomsListExhibitionMode","unreadAlert","notificationsSoundVolume","audioNotifications","desktopNotifications","mobileNotifications","idleTimeLimit","enableAutoAway","highlights","desktopNotificationDuration","viewMode","hideUsernames","hideRoles","hideAvatars","hideFlexTab","sendOnEnter","roomCounterSidebar","setPreferences","saveUserProfile","customFields","checkPassword","typedPassword","bcrypt","passCheck","_checkPassword","digest","algorithm","realname","setRealName","newPassword","logout","setProfile","sendConfirmationEmail","sendForgotPasswordEmail","regex","userEmail","sendResetPasswordEmail","setAvatarFromService","setUserAvatar","setUserActiveStatus","setUserActive","unsetLoginTokens","setUserPassword","requirePasswordChange","unsetRequirePasswordChange","toggleFavorite","f","setFavoriteByRoomIdAndUserId","unmuteUserInRoom","unmutedUser","unmuteUsernameByRoomId","createUserUnmutedWithRoomIdAndUser","userSetUtcOffset","setUtcOffset","publish","findUsersNotOffline","selector","pub","cursorHandle","findByNameStartingAndTypes","observeChanges","added","changed","removed","onStop","stop","getFullUserData","publication","cursor","cursorDelete","findInvisibleByRoomId","cursorDeleteHandle","lastUpdate","latestDate","oldestDate","inclusive","unreads","updated","findForUpdates","deleted","trashFindDeletedAfter","_deletedAt","latest","oldest","findByContainingUsername","lm","fname","_updatedAt","lastMessage","livechatData","tags","sms","sentiment","roomMap","_room","findByDefaultAndTypes","findBySubscriptionUserIdUpdatedAfter","findBySubscriptionUserId","getRoomByTypeAndName","roomFind","getRoomFind","cache","on","notifyUserInThisInstance","cursorFileListHandle","findNotHiddenFilesOfRoom","findByRoomIdAndRoles","fetchRooms","spotlight","roomOptions","findByNameAndTypeNotDefault","userOptions","findByActiveUsersExcept","searchableRoomTypes","entries","roomType","includeInRoomSearch","findByNameAndTypesNotContainingUsername","$nin","audioNotificationValue","mobilePushNotifications","emailNotifications","blocked","blocker","autoTranslate","autoTranslateLanguage","disableNotifications","hideUnreadStatus","findByUserId","processQueryOptionsOnResult","exceptions","findActiveByUsernameOrNameRegexWithExceptions","term","statusConnection","defaultRoom","requirePasswordChangeReason","statusLivechat","msgStream","Streamer","allowWrite","allowRead","eventName","allowEmit","roomParticipant","publishMessage","imported","emitWithoutBroadcast","_db","DDPCommon","connections","sections","connection","auth","_authorizeConnection","info","instanceId","ok","broadcastAuth","authorizeConnection","getCollection","startMatrixBroadcast","_createdAt","observe","extraInformation","isDocker","instanceRecord","disconnect","DDP","connect","_dontPrintErrors","LoggerManager","logLevel","onReconnect","remoteId","selfId","streamName","StreamerCentral","instances","_emit","startStreamCastBroadcast","_stream","raw_msg","parseDDP","subscribe","startStreamBroadcast","broadcast","fromInstance","results","connected","endpoint","conn","assign","currentStatus","i18n_status_func"],"mappings":"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","file":"/app.js","sourcesContent":["import _ from 'underscore';\n\nfunction getIdentity(accessToken) {\n\ttry {\n\t\treturn HTTP.get('https://graph.facebook.com/me', {\n\t\t\tparams: {\n\t\t\t\taccess_token: accessToken\n\t\t\t}\n\t\t}).data;\n\t} catch (error) {\n\t\tthrow _.extend(new Error(`Failed to fetch identity from Facebook. ${ error.message }`), {\n\t\t\tresponse: error.response\n\t\t});\n\t}\n}\n\nAccounts.registerLoginHandler(function(loginRequest) {\n\tif (!loginRequest.cordova) {\n\t\treturn;\n\t}\n\n\tloginRequest = loginRequest.authResponse;\n\n\tconst identity = getIdentity(loginRequest.accessToken);\n\tconst serviceData = {\n\t\taccessToken: loginRequest.accessToken,\n\t\texpiresAt: Date.now() + 1000 * loginRequest.expiresIn\n\t};\n\n\tconst whitelisted = ['id', 'email', 'name', 'first_name', 'last_name', 'link', 'username', 'gender', 'locale', 'age_range'];\n\tconst fields = _.pick(identity, whitelisted);\n\tconst options = {\n\t\tprofile: {}\n\t};\n\n\t_.extend(serviceData, fields);\n\t_.extend(options.profile, fields);\n\n\treturn Accounts.updateOrCreateUserFromExternalService('facebook', serviceData, options);\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nconst accountsConfig = {\n\tforbidClientAccountCreation: true,\n\tloginExpirationInDays: RocketChat.settings.get('Accounts_LoginExpiration')\n};\n\nAccounts.config(accountsConfig);\n\nAccounts.emailTemplates.siteName = RocketChat.settings.get('Site_Name');\n\nAccounts.emailTemplates.from = `${ RocketChat.settings.get('Site_Name') } <${ RocketChat.settings.get('From_Email') }>`;\n\nconst verifyEmailHtml = Accounts.emailTemplates.verifyEmail.text;\n\nAccounts.emailTemplates.verifyEmail.html = function(user, url) {\n\turl = url.replace(Meteor.absoluteUrl(), `${ Meteor.absoluteUrl() }login/`);\n\treturn verifyEmailHtml(user, url);\n};\n\nconst resetPasswordHtml = Accounts.emailTemplates.resetPassword.text;\n\nAccounts.emailTemplates.resetPassword.html = function(user, url) {\n\turl = url.replace(/\\/#\\//, '/');\n\treturn resetPasswordHtml(user, url);\n};\n\nAccounts.emailTemplates.enrollAccount.subject = function(user = {}) {\n\tlet subject;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\tsubject = RocketChat.settings.get('Accounts_Enrollment_Email_Subject');\n\t} else {\n\t\tsubject = TAPi18n.__('Accounts_Enrollment_Email_Subject_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\treturn RocketChat.placeholders.replace(subject);\n};\n\nAccounts.emailTemplates.enrollAccount.html = function(user = {}/*, url*/) {\n\tlet html;\n\tif (RocketChat.settings.get('Accounts_Enrollment_Customized')) {\n\t\thtml = RocketChat.settings.get('Accounts_Enrollment_Email');\n\t} else {\n\t\thtml = TAPi18n.__('Accounts_Enrollment_Email_Default', {\n\t\t\tlng: user.language || RocketChat.settings.get('language') || 'en'\n\t\t});\n\t}\n\n\tconst header = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Header') || '');\n\tconst footer = RocketChat.placeholders.replace(RocketChat.settings.get('Email_Footer') || '');\n\n\thtml = RocketChat.placeholders.replace(html, {\n\t\tname: user.name,\n\t\temail: user.emails && user.emails[0] && user.emails[0].address\n\t});\n\n\treturn header + html + footer;\n};\n\nAccounts.onCreateUser(function(options, user = {}) {\n\tRocketChat.callbacks.run('beforeCreateUser', options, user);\n\n\tuser.status = 'offline';\n\tuser.active = !RocketChat.settings.get('Accounts_ManuallyApproveNewUsers');\n\n\tif (!user.name) {\n\t\tif (options.profile) {\n\t\t\tif (options.profile.name) {\n\t\t\t\tuser.name = options.profile.name;\n\t\t\t} else if (options.profile.firstName && options.profile.lastName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = `${ options.profile.firstName } ${ options.profile.lastName }`;\n\t\t\t} else if (options.profile.firstName) {\n\t\t\t\t// LinkedIn format\n\t\t\t\tuser.name = options.profile.firstName;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.services) {\n\t\tfor (const service of Object.values(user.services)) {\n\t\t\tif (!user.name) {\n\t\t\t\tuser.name = service.name || service.username;\n\t\t\t}\n\n\t\t\tif (!user.emails && service.email) {\n\t\t\t\tuser.emails = [{\n\t\t\t\t\taddress: service.email,\n\t\t\t\t\tverified: true\n\t\t\t\t}];\n\t\t\t}\n\t\t}\n\t}\n\n\treturn user;\n});\n\nAccounts.insertUserDoc = _.wrap(Accounts.insertUserDoc, function(insertUserDoc, options, user) {\n\tlet roles = [];\n\n\tif (Match.test(user.globalRoles, [String]) && user.globalRoles.length > 0) {\n\t\troles = roles.concat(user.globalRoles);\n\t}\n\n\tdelete user.globalRoles;\n\n\tif (user.services && !user.services.password) {\n\t\tconst defaultAuthServiceRoles = String(RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Default_Roles')).split(',');\n\t\tif (defaultAuthServiceRoles.length > 0) {\n\t\t\troles = roles.concat(defaultAuthServiceRoles.map(s => s.trim()));\n\t\t}\n\t}\n\n\tif (!user.type) {\n\t\tuser.type = 'user';\n\t}\n\n\tconst _id = insertUserDoc.call(Accounts, options, user);\n\n\tuser = Meteor.users.findOne({\n\t\t_id\n\t});\n\n\tif (user.username) {\n\t\tif (options.joinDefaultChannels !== false && user.joinDefaultChannels !== false) {\n\t\t\tMeteor.runAsUser(_id, function() {\n\t\t\t\treturn Meteor.call('joinDefaultChannels', options.joinDefaultChannelsSilenced);\n\t\t\t});\n\t\t}\n\n\t\tif (user.type !== 'visitor') {\n\t\t\tMeteor.defer(function() {\n\t\t\t\treturn RocketChat.callbacks.run('afterCreateUser', user);\n\t\t\t});\n\t\t}\n\t}\n\n\tif (roles.length === 0) {\n\t\tconst hasAdmin = RocketChat.models.Users.findOne({\n\t\t\troles: 'admin',\n\t\t\ttype: 'user'\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (hasAdmin) {\n\t\t\troles.push('user');\n\t\t} else {\n\t\t\troles.push('admin');\n\t\t}\n\t}\n\n\tRocketChat.authz.addUserRoles(_id, roles);\n\n\treturn _id;\n});\n\nAccounts.validateLoginAttempt(function(login) {\n\tlogin = RocketChat.callbacks.run('beforeValidateLogin', login);\n\n\tif (login.allowed !== true) {\n\t\treturn login.allowed;\n\t}\n\n\tif (login.user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (!!login.user.active !== true) {\n\t\tthrow new Meteor.Error('error-user-is-not-activated', 'User is not activated', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (!login.user.roles || !Array.isArray(login.user.roles)) {\n\t\tthrow new Meteor.Error('error-user-has-no-roles', 'User has no roles', {\n\t\t\t'function': 'Accounts.validateLoginAttempt'\n\t\t});\n\t}\n\n\tif (login.user.roles.includes('admin') === false && login.type === 'password' && RocketChat.settings.get('Accounts_EmailVerification') === true) {\n\t\tconst validEmail = login.user.emails.filter(email => email.verified === true);\n\t\tif (validEmail.length === 0) {\n\t\t\tthrow new Meteor.Error('error-invalid-email', 'Invalid email __email__');\n\t\t}\n\t}\n\n\tlogin = RocketChat.callbacks.run('onValidateLogin', login);\n\n\tRocketChat.models.Users.updateLastLoginById(login.user._id);\n\tMeteor.defer(function() {\n\t\treturn RocketChat.callbacks.run('afterValidateLogin', login);\n\t});\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tif (RocketChat.settings.get('Accounts_Registration_AuthenticationServices_Enabled') === false && RocketChat.settings.get('LDAP_Enable') === false && !(user.services && user.services.password)) {\n\t\tthrow new Meteor.Error('registration-disabled-authentication-services', 'User registration is disabled for authentication services');\n\t}\n\n\treturn true;\n});\n\nAccounts.validateNewUser(function(user) {\n\tif (user.type === 'visitor') {\n\t\treturn true;\n\t}\n\n\tlet domainWhiteList = RocketChat.settings.get('Accounts_AllowedDomainsList');\n\tif (_.isEmpty(s.trim(domainWhiteList))) {\n\t\treturn true;\n\t}\n\n\tdomainWhiteList = domainWhiteList.split(',').map(domain => domain.trim());\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tconst email = user.emails[0].address;\n\t\tconst inWhiteList = domainWhiteList.some(domain => email.match(`@${ RegExp.escape(domain) }$`));\n\n\t\tif (inWhiteList === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-domain');\n\t\t}\n\t}\n\n\treturn true;\n});\n","/* global Push, SystemLogger */\n\nMeteor.methods({\n\t// log() {\n\t// \treturn console.log(...arguments);\n\t// },\n\n\tpush_test() {\n\t\tconst user = Meteor.user();\n\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tif (Push.enabled !== true) {\n\t\t\tthrow new Meteor.Error('error-push-disabled', 'Push is disabled', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\t$and: [{\n\t\t\t\tuserId: user._id\n\t\t\t}, {\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}]\n\t\t\t}]\n\t\t};\n\n\t\tconst tokens = Push.appCollection.find(query).count();\n\n\t\tif (tokens === 0) {\n\t\t\tthrow new Meteor.Error('error-no-tokens-for-this-user', 'There are no tokens for this user', {\n\t\t\t\tmethod: 'push_test'\n\t\t\t});\n\t\t}\n\n\t\tPush.send({\n\t\t\tfrom: 'push',\n\t\t\ttitle: `@${ user.username }`,\n\t\t\ttext: TAPi18n.__('This_is_a_push_test_messsage'),\n\t\t\tapn: {\n\t\t\t\ttext: `@${ user.username }:\\n${ TAPi18n.__('This_is_a_push_test_messsage') }`\n\t\t\t},\n\t\t\tsound: 'default',\n\t\t\tquery: {\n\t\t\t\tuserId: user._id\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\tmessage: 'Your_push_was_sent_to_s_devices',\n\t\t\tparams: [tokens]\n\t\t};\n\t}\n});\n\nfunction sendPush(service, token, options, tries = 0) {\n\tconst data = {\n\t\tdata: {\n\t\t\ttoken,\n\t\t\toptions\n\t\t}\n\t};\n\n\treturn HTTP.post(`${ RocketChat.settings.get('Push_gateway') }/push/${ service }/send`, data, function(error, response) {\n\t\tif (response && response.statusCode === 406) {\n\t\t\tconsole.log('removing push token', token);\n\t\t\tPush.appCollection.remove({\n\t\t\t\t$or: [{\n\t\t\t\t\t'token.apn': token\n\t\t\t\t}, {\n\t\t\t\t\t'token.gcm': token\n\t\t\t\t}]\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tif (!error) {\n\t\t\treturn;\n\t\t}\n\n\t\tSystemLogger.error(`Error sending push to gateway (${ tries } try) ->`, error);\n\n\t\tif (tries <= 6) {\n\t\t\tconst milli = Math.pow(10, tries + 2);\n\n\t\t\tSystemLogger.log('Trying sending push to gateway again in', milli, 'milliseconds');\n\n\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\treturn sendPush(service, token, options, tries + 1);\n\t\t\t}, milli);\n\t\t}\n\t});\n}\n\nfunction configurePush() {\n\tif (RocketChat.settings.get('Push_debug')) {\n\t\tPush.debug = true;\n\t\tconsole.log('Push: configuring...');\n\t}\n\n\tif (RocketChat.settings.get('Push_enable') === true) {\n\t\tPush.allow({\n\t\t\tsend(userId/*, notification*/) {\n\t\t\t\treturn RocketChat.authz.hasRole(userId, 'admin');\n\t\t\t}\n\t\t});\n\n\t\tlet apn;\n\t\tlet gcm;\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === false) {\n\t\t\tgcm = {\n\t\t\t\tapiKey: RocketChat.settings.get('Push_gcm_api_key'),\n\t\t\t\tprojectNumber: RocketChat.settings.get('Push_gcm_project_number')\n\t\t\t};\n\n\t\t\tapn = {\n\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_passphrase'),\n\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_key'),\n\t\t\t\tcertData: RocketChat.settings.get('Push_apn_cert')\n\t\t\t};\n\n\t\t\tif (RocketChat.settings.get('Push_production') !== true) {\n\t\t\t\tapn = {\n\t\t\t\t\tpassphrase: RocketChat.settings.get('Push_apn_dev_passphrase'),\n\t\t\t\t\tkeyData: RocketChat.settings.get('Push_apn_dev_key'),\n\t\t\t\t\tcertData: RocketChat.settings.get('Push_apn_dev_cert'),\n\t\t\t\t\tgateway: 'gateway.sandbox.push.apple.com'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (!apn.keyData || apn.keyData.trim() === '' || !apn.certData || apn.certData.trim() === '') {\n\t\t\t\tapn = undefined;\n\t\t\t}\n\n\t\t\tif (!gcm.apiKey || gcm.apiKey.trim() === '' || !gcm.projectNumber || gcm.projectNumber.trim() === '') {\n\t\t\t\tgcm = undefined;\n\t\t\t}\n\t\t}\n\n\t\tPush.Configure({\n\t\t\tapn,\n\t\t\tgcm,\n\t\t\tproduction: RocketChat.settings.get('Push_production'),\n\t\t\tsendInterval: 1000,\n\t\t\tsendBatchSize: 10\n\t\t});\n\n\t\tif (RocketChat.settings.get('Push_enable_gateway') === true) {\n\t\t\tPush.serverSend = function(options = {badge: 0}) {\n\t\t\t\tif (options.from !== String(options.from)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"from\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.title !== String(options.title)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"title\" not a string');\n\t\t\t\t}\n\t\t\t\tif (options.text !== String(options.text)) {\n\t\t\t\t\tthrow new Error('Push.send: option \"text\" not a string');\n\t\t\t\t}\n\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\tconsole.log(`Push: send message \"${ options.title }\" via query`, options.query);\n\t\t\t\t}\n\n\t\t\t\tconst query = {\n\t\t\t\t\t$and: [options.query, {\n\t\t\t\t\t\t$or: [{\n\t\t\t\t\t\t\t'token.apn': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, {\n\t\t\t\t\t\t\t'token.gcm': {\n\t\t\t\t\t\t\t\t$exists: true\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}]\n\t\t\t\t\t}]\n\t\t\t\t};\n\n\t\t\t\treturn Push.appCollection.find(query).forEach((app) => {\n\t\t\t\t\tif (RocketChat.settings.get('Push_debug')) {\n\t\t\t\t\t\tconsole.log('Push: send to token', app.token);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.apn) {\n\t\t\t\t\t\toptions.topic = app.appName;\n\t\t\t\t\t\treturn sendPush('apn', app.token.apn, options);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (app.token.gcm) {\n\t\t\t\t\t\treturn sendPush('gcm', app.token.gcm, options);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\treturn Push.enabled = true;\n\t}\n}\n\nMeteor.startup(function() {\n\treturn configurePush();\n});\n","RocketChat.Migrations.add({\n\tversion: 1,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tlastLogin: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst username = RocketChat.generateUsernameSuggestion(user);\n\t\t\tif (username && username.trim() !== '') {\n\t\t\t\treturn RocketChat.models.Users.setUsername(user._id, username);\n\t\t\t} else {\n\t\t\t\treturn console.log('User without username', JSON.stringify(user, null, ' '));\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals getAvatarSuggestionForUser */\n\nRocketChat.Migrations.add({\n\tversion: 2,\n\tup() {\n\t\treturn RocketChat.models.Users.find({\n\t\t\tavatarOrigin: {\n\t\t\t\t$exists: false\n\t\t\t},\n\t\t\tusername: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tconst avatars = getAvatarSuggestionForUser(user);\n\t\t\tconst services = Object.keys(avatars);\n\n\t\t\tif (services.length === 0) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst service = services[0];\n\n\t\t\tconsole.log(user.username, '->', service);\n\n\t\t\tconst dataURI = avatars[service].blob;\n\t\t\tconst {image, contentType} = RocketChatFile.dataURIParse(dataURI);\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(image, 'base64'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName(user.username);\n\n\t\t\tconst file = {\n\t\t\t\tuserId: user._id,\n\t\t\t\ttype: contentType\n\t\t\t};\n\n\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin(user._id, service);\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 3,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('uid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('rid_1_uid_1');\n\n\t\tconsole.log('Fixing ChatSubscription uid');\n\n\t\tRocketChat.models.Subscriptions.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((sub) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(sub.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Subscriptions.update(sub._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatRoom uids');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'uids.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach(function(room) {\n\t\t\tconst update = {};\n\t\t\tconst users = RocketChat.models.Users.find({\n\t\t\t\t_id: {\n\t\t\t\t\t$in: room.uids\n\t\t\t\t},\n\t\t\t\tusername: {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tconst usernames = users.map(function(user) {\n\t\t\t\treturn user.username;\n\t\t\t});\n\n\t\t\tif (!update.$set) {\n\t\t\t\tupdate.$set = {};\n\t\t\t}\n\n\t\t\tif (!update.$unset) {\n\t\t\t\tupdate.$unset = {};\n\t\t\t}\n\n\t\t\tupdate.$set.usernames = usernames;\n\t\t\tupdate.$unset.uids = 1;\n\n\t\t\tconst user = RocketChat.models.Users.findOneById(room.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (room.t === 'd' && usernames.length === 2) {\n\t\t\t\tfor (const k of Object.keys(update.$set)) {\n\t\t\t\t\tconst v = update.$set[k];\n\t\t\t\t\troom[k] = v;\n\t\t\t\t}\n\n\t\t\t\tfor (const k of Object.keys(update.$unset)) {\n\t\t\t\t\tdelete room[k];\n\t\t\t\t}\n\n\t\t\t\tconst oldId = room._id;\n\n\t\t\t\troom._id = usernames.sort().join(',');\n\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t\tRocketChat.models.Rooms.removeById(oldId);\n\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.models.Messages.update({\n\t\t\t\t\trid: oldId\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: room._id\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn RocketChat.models.Rooms.update(room._id, update);\n\t\t\t}\n\t\t});\n\n\t\tconsole.log('Fixing ChatMessage uid');\n\n\t\tRocketChat.models.Messages.find({\n\t\t\tuid: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tnonreactive: true\n\t\t}).forEach((message) => {\n\t\t\tconst update = {};\n\t\t\tconst user = RocketChat.models.Users.findOneById(message.uid, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (user) {\n\t\t\t\tif (!update.$set) {\n\t\t\t\t\tupdate.$set = {};\n\t\t\t\t}\n\n\t\t\t\tif (!update.$unset) {\n\t\t\t\t\tupdate.$unset = {};\n\t\t\t\t}\n\n\t\t\t\tupdate.$set['u._id'] = user._id;\n\t\t\t\tupdate.$set['u.username'] = user.username;\n\t\t\t\tupdate.$unset.uid = 1;\n\t\t\t}\n\n\t\t\tif (Object.keys(update).length > 0) {\n\t\t\t\treturn RocketChat.models.Messages.update(message._id, update);\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 4,\n\tup() {\n\t\tRocketChat.models.Messages.tryDropIndex('rid_1');\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1');\n\n\t\tconsole.log('Rename rn to name');\n\n\t\tRocketChat.models.Subscriptions.update({\n\t\t\trn: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$rename: {\n\t\t\t\trn: 'name'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconsole.log('Adding names to rooms without name');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tname: ''\n\t\t}).forEach((item) => {\n\t\t\tconst name = Random.id().toLowerCase();\n\n\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: item._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: true\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Making room names unique');\n\n\t\tRocketChat.models.Rooms.find().forEach(function(room) {\n\n\t\t\treturn RocketChat.models.Rooms.find({\n\t\t\t\tname: room.name,\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: room._id\n\t\t\t\t}\n\t\t\t}).forEach((item) => {\n\t\t\t\tconst name = `${ room.name }-${ Random.id(2).toLowerCase() }`;\n\n\t\t\t\tRocketChat.models.Rooms.setNameById(item._id, name);\n\n\t\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: item._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: true\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 5,\n\tup() {\n\t\tconsole.log('Dropping test rooms with less than 2 messages');\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\tmsgs: {\n\t\t\t\t$lt: 2\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Dropping test rooms with less than 2 user');\n\t\tRocketChat.models.Rooms.find({\n\t\t\tusernames: {\n\t\t\t\t$size: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconsole.log('Dropped: ', room.name);\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\treturn RocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t});\n\n\t\tconsole.log('Adding username to all users');\n\t\tRocketChat.models.Users.find({\n\t\t\tusername: {\n\t\t\t\t$exists: 0\n\t\t\t},\n\t\t\temails: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tlet newUserName = user.emails[0].address.split('@')[0];\n\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\tif (RocketChat.models.Users.findOneByUsername(newUserName)) {\n\t\t\t\t\t\tnewUserName = newUserName + Math.floor((Math.random() * 10) + 1);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconsole.log(`Adding: username ${ newUserName } to all user ${ user._id }`);\n\t\t\treturn RocketChat.models.Users.setUsername(user._id, newUserName);\n\t\t});\n\n\t\tconsole.log('Fixing _id of direct messages rooms');\n\t\tRocketChat.models.Rooms.findByType('d').forEach(function(room) {\n\t\t\tlet newId = '';\n\t\t\tconst id0 = RocketChat.models.Users.findOneByUsername(room.usernames[0])._id;\n\t\t\tconst id1 = RocketChat.models.Users.findOneByUsername(room.usernames[1])._id;\n\t\t\tconst ids = [id0, id1];\n\n\t\t\tnewId = ids.sort().join('');\n\t\t\tif (newId !== room._id) {\n\t\t\t\tconsole.log(`Fixing: _id ${ room._id } to ${ newId }`);\n\t\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t\trid: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\trid: newId\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tmulti: 1\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\t\t\t\troom._id = newId;\n\t\t\t\tRocketChat.models.Rooms.insert(room);\n\t\t\t}\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id0\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[1]\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn RocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id,\n\t\t\t\t'u._id': id1\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tname: room.usernames[0]\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconsole.log('Adding u.username to all documents');\n\t\tRocketChat.models.Users.find({}, {\n\t\t\tusername: 1\n\t\t}).forEach((user) => {\n\t\t\tconsole.log(`Adding: u.username ${ user.username } to all document`);\n\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\t'u._id': user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\t'u.username': user.username\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tby: user._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\tu: user\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\tuid: {\n\t\t\t\t\t$exists: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$unset: {\n\t\t\t\t\tuid: 1,\n\t\t\t\t\tby: 1\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 6,\n\tup() {\n\t\tconsole.log('Changing _id of #general channel room from XXX to GENERAL');\n\n\t\tconst room = RocketChat.models.Rooms.findOneByName('general');\n\n\t\tif (room && room._id !== 'GENERAL') {\n\t\t\tRocketChat.models.Subscriptions.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.update({\n\t\t\t\trid: room._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: 'GENERAL'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tmulti: 1\n\t\t\t});\n\n\t\t\tRocketChat.models.Rooms.removeById(room._id);\n\n\t\t\tdelete room._id;\n\n\t\t\tRocketChat.models.Rooms.upsert({\n\t\t\t\t_id: 'GENERAL'\n\t\t\t}, {\n\t\t\t\t$set: room\n\t\t\t});\n\t\t}\n\n\t\treturn console.log('End');\n\t}\n});\n","/* globals OEmbed */\nimport _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 7,\n\tup() {\n\t\tconsole.log('Populate urls in messages');\n\n\t\tconst query = RocketChat.models.Messages.find({\n\t\t\t'urls.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t});\n\n\t\tconst count = query.count();\n\n\t\tquery.forEach((message, index) => {\n\t\t\tconsole.log(`${ index + 1 } / ${ count }`);\n\n\t\t\tmessage.urls = message.urls.map((url) => {\n\t\t\t\tif (_.isString(url)) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\turl\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\treturn url;\n\t\t\t});\n\n\t\t\treturn OEmbed.rocketUrlParser(message);\n\t\t});\n\n\t\treturn console.log('End');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 8,\n\tup() {\n\t\tconsole.log('Load old settings record');\n\t\tconst settings = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'settings'\n\t\t});\n\n\t\tif (settings) {\n\t\t\tif (settings.CDN_PREFIX) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'CDN_PREFIX', value: settings.CDN_PREFIX, type: 'string', group: 'General'});\n\t\t\t}\n\n\t\t\tif (settings.ENV && settings.ENV.MAIL_URL) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'MAIL_URL', value: settings.ENV.MAIL_URL, type: 'string', group: 'SMTP'});\n\t\t\t}\n\n\t\t\tif (settings.denyUnverifiedEmails) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'Accounts_denyUnverifiedEmails', value: settings.denyUnverifiedEmails, type: 'boolean', group: 'Accounts'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.type) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_type', value: settings.public.avatarStore.type, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\tif (settings.public && settings.public.avatarStore && settings.public.avatarStore.path) {\n\t\t\t\tRocketChat.models.Settings.insert({_id: 'avatarStore_path', value: settings.public.avatarStore.path, type: 'string', group: 'API'});\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Settings.remove({\n\t\t\t\t_id: 'settings'\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 9,\n\tup() {\n\t\t// Migrate existing source collection data to target collection\n\t\t// target collection is defined in collections.coffee using the new collection name\n\t\t// source collection is dropped after data migration\n\t\tconst toMigrate = [\n\t\t\t{\n\t\t\t\tsource: new Mongo.Collection('data.ChatRoom'),\n\t\t\t\ttarget: RocketChat.models.Rooms.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatSubscription'),\n\t\t\t\ttarget: RocketChat.models.Subscriptions.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('data.ChatMessage'),\n\t\t\t\ttarget: RocketChat.models.Messages.model\n\t\t\t}, {\n\t\t\t\tsource: new Mongo.Collection('settings'),\n\t\t\t\ttarget: RocketChat.models.Settings.model\n\t\t\t}, {\n\t\t\t\t// this collection may not exit\n\t\t\t\tsource: new Mongo.Collection('oembed_cache'),\n\t\t\t\ttarget: RocketChat.models.OEmbedCache.model\n\t\t\t}\n\t\t];\n\n\t\treturn toMigrate.forEach((collection) => {\n\t\t\tconst {target, source} = collection;\n\n\t\t\t// rawCollection available as of Meteor 1.0.4\n\t\t\tconsole.log(`Migrating data from: ${ source.rawCollection().collectionName } to: ${ target.rawCollection().collectionName }`);\n\n\t\t\tsource.find().forEach((doc) => {\n\t\t\t\t// use upsert to account for GENERAL room created by initialData\n\t\t\t\treturn target.upsert({\n\t\t\t\t\t_id: doc._id\n\t\t\t\t}, doc);\n\t\t\t});\n\n\t\t\tconst rawSource = source.rawCollection();\n\n\t\t\treturn Meteor.wrapAsync(rawSource.drop, rawSource)(function(err/*, res*/) {\n\t\t\t\tif (err) {\n\t\t\t\t\treturn console.log(`Error dropping ${ rawSource.collectionName } collection due to: ${ err.errmsg }`);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// Note: the following would have been much easier, but didn't work.  The serverside\n\t\t\t// data was not published to the client for some reason.\n\t\t\t// newName = target.rawCollection().collectionName\n\t\t\t// Meteor.wrapAsync(rawSource.rename, rawSource )(newName, {dropTarget:true})\n\t\t});\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 10,\n\tup() {\n\t\t/*\n\t\t * Remove duplicated usernames from rooms\n\t\t */\n\t\tlet count = 0;\n\n\t\tRocketChat.models.Rooms.find({\n\t\t\t'usernames.0': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\tusernames: 1\n\t\t\t}\n\t\t}).forEach((room) => {\n\t\t\tconst newUsernames = _.uniq(room.usernames);\n\t\t\tif (newUsernames.length !== room.usernames.length) {\n\t\t\t\tcount++;\n\t\t\t\treturn RocketChat.models.Rooms.update({\n\t\t\t\t\t_id: room._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tusernames: newUsernames\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn console.log(`Removed duplicated usernames from ${ count } rooms`);\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 11,\n\tup() {\n\t\t/*\n\t\t * Set GENERAL room to be default\n\t\t */\n\t\tRocketChat.models.Rooms.update({\n\t\t\t_id: 'GENERAL'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'default': true\n\t\t\t}\n\t\t});\n\n\t\treturn console.log('Set GENERAL room to be default');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 12,\n\tup() {\n\t\t// Set oldest user as admin, if none exists yet\n\t\tconst admin = RocketChat.models.Users.findOneAdmin(true, {\n\t\t\tfields: {\n\t\t\t\t_id: 1\n\t\t\t}\n\t\t});\n\n\t\tif (!admin) {\n\t\t\t// get oldest user\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: oldestUser._id\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tadmin: true\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn console.log(`Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 13,\n\tup() {\n\t\t// Set all current users as active\n\t\tRocketChat.models.Users.setAllUsersActive(true);\n\t\treturn console.log('Set all users as active');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 14,\n\tup() {\n\t\t// Remove unused settings\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_URL'});\n\t\tRocketChat.models.Settings.remove({_id: 'API_Piwik_ID'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Edit'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_Delete'});\n\t\tRocketChat.models.Settings.remove({_id: 'Message_KeepStatusHistory'});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowEditedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: true\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({_id: 'Message_ShowDeletedStatus'}, {\n\t\t\t$set: {\n\t\t\t\ttype: 'boolean',\n\t\t\t\tvalue: false\n\t\t\t}\n\t\t});\n\n\t\tconst metaKeys = [\n\t\t\t{\n\t\t\t\told: 'Meta:language',\n\t\t\t\tnew: 'Meta_language'\n\t\t\t}, {\n\t\t\t\told: 'Meta:fb:app_id',\n\t\t\t\tnew: 'Meta_fb_app_id'\n\t\t\t}, {\n\t\t\t\told: 'Meta:robots',\n\t\t\t\tnew: 'Meta_robots'\n\t\t\t}, {\n\t\t\t\told: 'Meta:google-site-verification',\n\t\t\t\tnew: 'Meta_google-site-verification'\n\t\t\t}, {\n\t\t\t\told: 'Meta:msvalidate.01',\n\t\t\t\tnew: 'Meta_msvalidate01'\n\t\t\t}\n\t\t];\n\n\t\tfor (const oldAndNew of metaKeys) {\n\t\t\tconst oldSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.old});\n\t\t\tconst oldValue = oldSetting && oldSetting.value;\n\n\t\t\tconst newSetting = RocketChat.models.Settings.findOne({_id: oldAndNew.new});\n\t\t\tconst newValue = newSetting && newSetting.value;\n\n\t\t\tif (oldValue && newValue) {\n\t\t\t\tRocketChat.models.Settings.update({\n\t\t\t\t\t_id: oldAndNew.new\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: newValue\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: oldAndNew.old\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'SMTP_Security'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 15,\n\tup() {\n\t\tconsole.log('Starting file migration');\n\t\tconst oldFilesCollection = new Mongo.Collection('cfs.Files.filerecord');\n\t\tconst oldGridFSCollection = new Mongo.Collection('cfs_gridfs.files.files');\n\t\tconst oldChunkCollection = new Mongo.Collection('cfs_gridfs.files.chunks');\n\t\tconst newFilesCollection = RocketChat.models.Uploads;\n\t\tconst newGridFSCollection = new Mongo.Collection('rocketchat_uploads.files');\n\t\tconst newChunkCollection = new Mongo.Collection('rocketchat_uploads.chunks');\n\n\t\toldFilesCollection.find({\n\t\t\t'copies.files.key': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}).forEach((cfsRecord) => {\n\t\t\tconst nameParts = cfsRecord.original.name && cfsRecord.original.name.split('.');\n\t\t\tlet extension = '';\n\t\t\tlet url = `ufs/rocketchat_uploads/${ cfsRecord._id }`;\n\n\t\t\tconsole.log('migrating file', url);\n\n\t\t\tif (nameParts && nameParts.length > 1) {\n\t\t\t\textension = nameParts.pop();\n\t\t\t\turl = `${ url }.${ extension }`;\n\t\t\t}\n\n\t\t\tconst record = {\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tname: cfsRecord.original.name || '',\n\t\t\t\tsize: cfsRecord.original.size,\n\t\t\t\ttype: cfsRecord.original.type,\n\t\t\t\tcomplete: true,\n\t\t\t\tuploading: false,\n\t\t\t\tstore: 'rocketchat_uploads',\n\t\t\t\textension,\n\t\t\t\tuserId: cfsRecord.userId,\n\t\t\t\tuploadedAt: cfsRecord.updatedAt,\n\t\t\t\turl: Meteor.absoluteUrl() + url\n\t\t\t};\n\n\t\t\tnewFilesCollection.insert(record);\n\n\t\t\tconst oldGridFsFile = oldGridFSCollection.findOne({\n\t\t\t\t_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t});\n\n\t\t\tnewGridFSCollection.insert({\n\t\t\t\t_id: cfsRecord._id,\n\t\t\t\tfilename: cfsRecord._id,\n\t\t\t\tcontentType: oldGridFsFile.contentType,\n\t\t\t\tlength: oldGridFsFile.length,\n\t\t\t\tchunkSize: oldGridFsFile.chunkSize,\n\t\t\t\tuploadDate: oldGridFsFile.uploadDate,\n\t\t\t\taliases: null,\n\t\t\t\tmetadata: null,\n\t\t\t\tmd5: oldGridFsFile.md5\n\t\t\t});\n\n\t\t\toldChunkCollection.find({\n\t\t\t\tfiles_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)\n\t\t\t}).forEach((oldChunk) => {\n\t\t\t\tnewChunkCollection.insert({\n\t\t\t\t\t_id: oldChunk._id,\n\t\t\t\t\tfiles_id: cfsRecord._id,\n\t\t\t\t\tn: oldChunk.n,\n\t\t\t\t\tdata: oldChunk.data\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tRocketChat.models.Messages.find({\n\t\t\t\t$or: [{\n\t\t\t\t\t'urls.url': `https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}, {\n\t\t\t\t\t'urls.url': `https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`\n\t\t\t\t}]\n\t\t\t}).forEach((message) => {\n\t\t\t\tfor (const urlsItem of message.urls) {\n\t\t\t\t\tif (urlsItem.url === (`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`) || urlsItem.url === (`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`)) {\n\t\t\t\t\t\turlsItem.url = Meteor.absoluteUrl() + url;\n\t\t\t\t\t\tif (urlsItem.parsedUrl && urlsItem.parsedUrl.pathname) {\n\t\t\t\t\t\t\turlsItem.parsedUrl.pathname = `/${ url }`;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://open.rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t\tmessage.msg = message.msg.replace(`https://rocket.chat/cfs/files/Files/${ cfsRecord._id }`, Meteor.absoluteUrl() + url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tRocketChat.models.Messages.update({_id: message._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\turls: message.urls,\n\t\t\t\t\t\tmsg: message.msg\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\toldFilesCollection.remove({_id: cfsRecord._id});\n\t\t\toldGridFSCollection.remove({_id: oldGridFsFile._id});\n\t\t\toldChunkCollection.remove({files_id: new Mongo.Collection.ObjectID(cfsRecord.copies.files.key)});\n\t\t});\n\n\t\treturn console.log('End of file migration');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 16,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 17,\n\tup() {\n\t\treturn RocketChat.models.Messages.tryDropIndex({\n\t\t\t_hidden: 1\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 18,\n\tup() {\n\t\tconst changes = {\n\t\t\tAccounts_Facebook: 'Accounts_OAuth_Facebook',\n\t\t\tAccounts_Facebook_id: 'Accounts_OAuth_Facebook_id',\n\t\t\tAccounts_Facebook_secret: 'Accounts_OAuth_Facebook_secret',\n\t\t\tAccounts_Google: 'Accounts_OAuth_Google',\n\t\t\tAccounts_Google_id: 'Accounts_OAuth_Google_id',\n\t\t\tAccounts_Google_secret: 'Accounts_OAuth_Google_secret',\n\t\t\tAccounts_Github: 'Accounts_OAuth_Github',\n\t\t\tAccounts_Github_id: 'Accounts_OAuth_Github_id',\n\t\t\tAccounts_Github_secret: 'Accounts_OAuth_Github_secret',\n\t\t\tAccounts_Gitlab: 'Accounts_OAuth_Gitlab',\n\t\t\tAccounts_Gitlab_id: 'Accounts_OAuth_Gitlab_id',\n\t\t\tAccounts_Gitlab_secret: 'Accounts_OAuth_Gitlab_secret',\n\t\t\tAccounts_Linkedin: 'Accounts_OAuth_Linkedin',\n\t\t\tAccounts_Linkedin_id: 'Accounts_OAuth_Linkedin_id',\n\t\t\tAccounts_Linkedin_secret: 'Accounts_OAuth_Linkedin_secret',\n\t\t\tAccounts_Meteor: 'Accounts_OAuth_Meteor',\n\t\t\tAccounts_Meteor_id: 'Accounts_OAuth_Meteor_id',\n\t\t\tAccounts_Meteor_secret: 'Accounts_OAuth_Meteor_secret',\n\t\t\tAccounts_Twitter: 'Accounts_OAuth_Twitter',\n\t\t\tAccounts_Twitter_id: 'Accounts_OAuth_Twitter_id',\n\t\t\tAccounts_Twitter_secret: 'Accounts_OAuth_Twitter_secret'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\n\t\treturn ServiceConfiguration.configurations.remove({});\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 19,\n\tup() {\n\t\t/*\n\t\t * Migrate existing admin users to Role based admin functionality\n\t\t * 'admin' role applies to global scope\n\t\t */\n\n\t\tconst admins = Meteor.users.find({\n\t\t\tadmin: true\n\t\t}, {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tadmins.forEach((admin) => {\n\t\t\tRocketChat.authz.addUserRoles(admin._id, ['admin']);\n\t\t});\n\n\t\tMeteor.users.update({}, {\n\t\t\t$unset: {\n\t\t\t\tadmin: ''\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tlet usernames = _.pluck(admins, 'username').join(', ');\n\n\t\tconsole.log((`Migrate ${ usernames } from admin field to 'admin' role`).green);\n\n\t\t// Add 'user' role to all users\n\t\tconst users = Meteor.users.find().fetch();\n\t\tusers.forEach((user) => {\n\t\t\tRocketChat.authz.addUserRoles(user._id, ['user']);\n\t\t});\n\n\t\tusernames = _.pluck(users, 'username').join(', ');\n\t\tconsole.log((`Add ${ usernames } to 'user' role`).green);\n\n\t\t// Add 'moderator' role to channel/group creators\n\t\tconst rooms = RocketChat.models.Rooms.findByTypes(['c', 'p']).fetch();\n\t\treturn rooms.forEach((room) => {\n\t\t\tconst creator = room && room.u && room.u._id;\n\n\t\t\tif (creator) {\n\t\t\t\tif (Meteor.users.findOne({\n\t\t\t\t\t_id: creator\n\t\t\t\t})) {\n\t\t\t\t\treturn RocketChat.authz.addUserRoles(creator, ['moderator'], room._id);\n\t\t\t\t} else {\n\t\t\t\t\tRocketChat.models.Subscriptions.removeByRoomId(room._id);\n\t\t\t\t\tRocketChat.models.Messages.removeByRoomId(room._id);\n\t\t\t\t\treturn RocketChat.models.Rooms.removeById(room._id);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 20,\n\tup() {\n\t\t/*\n\t\t * Migrate existing `rocketchat_uploads` documents to include the room Id\n\t\t * where the file was uploaded to. The room Id is retrieved from the message\n\t\t * document created after the file upload.\n\t\t */\n\n\t\t// list of channel messages which were created after uploading a file\n\t\tconst msgQuery = {\n\t\t\trid: {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t};\n\n\t\tconst msgOptions = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\trid: 1,\n\t\t\t\t'file._id': 1\n\t\t\t}\n\t\t};\n\n\t\tconst cursorFileMessages = RocketChat.models.Messages.find(msgQuery, msgOptions);\n\t\tif (!cursorFileMessages.count()) {\n\t\t\treturn;\n\t\t}\n\n\t\tcursorFileMessages.fetch().forEach((msg) => {\n\t\t\treturn RocketChat.models.Uploads.update({\n\t\t\t\t_id: msg.file && msg.file._id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\trid: msg.rid\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t$multi: true\n\t\t\t});\n\t\t});\n\n\t\treturn console.log('Updated rocketchat_uploads documents to include the room Id in which they were sent.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 21,\n\tup() {\n\t\t/*\n\t\t * Remove any i18nLabel from rocketchat_settings\n\t\t * They will be added again where necessary on next restart\n\t\t */\n\t\tRocketChat.models.Settings.update({\n\t\t\ti18nLabel: {\n\t\t\t\t$exists: true\n\t\t\t}\n\t\t}, {\n\t\t\t$unset: {\n\t\t\t\ti18nLabel: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\treturn console.log('Removed i18nLabel from Settings. New labels will be added on next restart! Please restart your server.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 22,\n\tup() {\n\t\t/*\n\t\t * Update message edit field\n\t\t */\n\t\tRocketChat.models.Messages.upgradeEtsToEditAt();\n\n\t\treturn console.log('Updated old messages\\' ets edited timestamp to new editedAt timestamp.');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 23,\n\tup() {\n\t\tRocketChat.models.Settings.remove({\n\t\t\t_id: 'Accounts_denyUnverifiedEmails'\n\t\t});\n\n\t\treturn console.log('Deleting not used setting Accounts_denyUnverifiedEmails');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 24,\n\tup() {\n\t\treturn RocketChat.models.Permissions.remove({\n\t\t\t_id: 'access-rocket-permissions'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 25,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tpersistent: true\n\t\t\t},\n\t\t\t$unset: {\n\t\t\t\thidden: true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 26,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\tt: 'rm'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tmentions: []\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 27,\n\tup() {\n\n\t\tRocketChat.models.Users.update({}, {\n\t\t\t$rename: {\n\t\t\t\troles: '_roles'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tRocketChat.models.Users.find({\n\t\t\t_roles: {\n\t\t\t\t$exists: 1\n\t\t\t}\n\t\t}).forEach((user) => {\n\t\t\tfor (const scope of Object.keys(user._roles)) {\n\t\t\t\tconst roles = user._roles[scope];\n\t\t\t\tRocketChat.models.Roles.addUserRoles(user._id, roles, scope);\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Users.update({}, {\n\t\t\t$unset: {\n\t\t\t\t_roles: 1\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 28,\n\tup() {\n\t\treturn RocketChat.models.Permissions.addRole('view-c-room', 'bot');\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 29,\n\tup() {\n\t\tlet LDAP_Url = (RocketChat.models.Settings.findOne('LDAP_Url') || {}).value;\n\t\tconst LDAP_TLS = (RocketChat.models.Settings.findOne('LDAP_TLS') || {}).value;\n\t\tconst LDAP_DN = (RocketChat.models.Settings.findOne('LDAP_DN') || {}).value;\n\t\tconst LDAP_Bind_Search = (RocketChat.models.Settings.findOne('LDAP_Bind_Search') || {}).value;\n\n\t\tif (LDAP_Url && LDAP_Url.trim() !== '') {\n\t\t\tLDAP_Url = LDAP_Url.replace(/ldaps?:\\/\\//i, '');\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Host'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Url\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_TLS === true) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Encryption'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'tls'\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_DN && LDAP_DN.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Domain_Base'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_DN\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Username_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Unique_Identifier_Field'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: ''\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (LDAP_Bind_Search && LDAP_Bind_Search.trim() !== '') {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: LDAP_Bind_Search\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tRocketChat.models.Settings.upsert({_id: 'LDAP_Use_Custom_Domain_Search'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: true\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Url'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_TLS'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_DN'});\n\t\tRocketChat.models.Settings.remove({_id: 'LDAP_Bind_Search'});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 30,\n\tup() {\n\t\tconst WebRTC_STUN_Server = (RocketChat.models.Settings.findOne('WebRTC_STUN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Server = (RocketChat.models.Settings.findOne('WebRTC_TURN_Server') || {}).value;\n\t\tconst WebRTC_TURN_Username = (RocketChat.models.Settings.findOne('WebRTC_TURN_Username') || {}).value;\n\t\tconst WebRTC_TURN_Password = (RocketChat.models.Settings.findOne('WebRTC_TURN_Password') || {}).value;\n\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_STUN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Server'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Username'});\n\t\tRocketChat.models.Settings.remove({_id: 'WebRTC_TURN_Password'});\n\n\t\tif (WebRTC_STUN_Server === 'stun:stun.l.google.com:19302' && WebRTC_TURN_Server === 'turn:numb.viagenie.ca:3478' && WebRTC_TURN_Username === 'team@rocket.chat' && WebRTC_TURN_Password === 'demo') {\n\t\t\treturn;\n\t\t}\n\n\t\tlet servers = '';\n\t\tif (WebRTC_STUN_Server) {\n\t\t\tservers += WebRTC_STUN_Server;\n\t\t}\n\n\t\tif (WebRTC_TURN_Server) {\n\t\t\tservers += ', ';\n\t\t\tif (WebRTC_TURN_Username != null) {\n\t\t\t\tservers += `${ encodeURIComponent(WebRTC_TURN_Username) }:${ encodeURIComponent(WebRTC_TURN_Password) }@`;\n\t\t\t}\n\t\t\tservers += WebRTC_TURN_Server;\n\t\t}\n\n\t\tif (servers !== '') {\n\t\t\treturn RocketChat.models.Settings.upsert({_id: 'WebRTC_Servers'}, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: servers\n\t\t\t\t},\n\t\t\t\t$setOnInsert: {\n\t\t\t\t\tcreatedAt: new Date\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 31,\n\tup() {\n\t\tconst changes = {\n\t\t\tAPI_Analytics: 'GoogleTagManager_id'\n\t\t};\n\n\t\tfor (const from of Object.keys(changes)) {\n\t\t\tconst to = changes[from];\n\t\t\tconst record = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: from\n\t\t\t});\n\n\t\t\tif (record) {\n\t\t\t\tdelete record._id;\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: to\n\t\t\t\t}, record);\n\t\t\t}\n\n\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t_id: from\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 32,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: /Accounts_OAuth_Custom_/\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tgroup: 'OAuth'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 33,\n\tup() {\n\t\tconst scriptAlert = '/**\\n * This script is out-of-date, convert to the new format\\n * (https://rocket.chat/docs/administrator-guides/integrations)\\n**/\\n\\n';\n\n\t\tconst integrations = RocketChat.models.Integrations.find({\n\t\t\t$or: [\n\t\t\t\t{\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessIncomingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprepareOutgoingRequestScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}, {\n\t\t\t\t\tscript: {\n\t\t\t\t\t\t$exists: false\n\t\t\t\t\t},\n\t\t\t\t\tprocessOutgoingResponseScript: {\n\t\t\t\t\t\t$exists: true\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t}).fetch();\n\n\t\tintegrations.forEach(function(integration) {\n\t\t\tlet script = '';\n\t\t\tif (integration.processIncomingRequestScript) {\n\t\t\t\tscript += `${ integration.processIncomingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.prepareOutgoingRequestScript) {\n\t\t\t\tscript += `${ integration.prepareOutgoingRequestScript }\\n\\n`;\n\t\t\t}\n\t\t\tif (integration.processOutgoingResponseScript) {\n\t\t\t\tscript += `${ integration.processOutgoingResponseScript }\\n\\n`;\n\t\t\t}\n\n\t\t\treturn RocketChat.models.Integrations.update(integration._id, {\n\t\t\t\t$set: {\n\t\t\t\t\tscript: scriptAlert + script.replace(/^/gm, '// ')\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tlet update = {\n\t\t\t$unset: {\n\t\t\t\tprocessIncomingRequestScript: 1,\n\t\t\t\tprepareOutgoingRequestScript: 1,\n\t\t\t\tprocessOutgoingResponseScript: 1\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({}, update, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tupdate = {\n\t\t\t$set: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update({\n\t\t\tenabled: {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, update, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 34,\n\tup() {\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t_id: 'Layout_Login_Header',\n\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo/logo.svg?v=3\" /></a>'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<a class=\"logo\" href=\"/\"><img src=\"/assets/logo?v=3\" /></a>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 35,\n\tup() {\n\t\treturn RocketChat.models.Messages.update({\n\t\t\t'file._id': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link': {\n\t\t\t\t$exists: true\n\t\t\t},\n\t\t\t'attachments.title_link_download': {\n\t\t\t\t$exists: false\n\t\t\t}\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'attachments.$.title_link_download': true\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t}\n});\n","import url from 'url';\n\nRocketChat.Migrations.add({\n\tversion: 36,\n\tup() {\n\t\tconst loginHeader = RocketChat.models.Settings.findOne({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\n\t\tif (!loginHeader || !loginHeader.value) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = loginHeader.value.match(/<img\\ssrc=['\"]([^'\"]+)/);\n\n\t\tif (match && match.length === 2) {\n\t\t\tlet requestUrl = match[1];\n\t\t\tif (requestUrl[0] === '/') {\n\t\t\t\trequestUrl = url.resolve(Meteor.absoluteUrl(), requestUrl);\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tMeteor.startup(function() {\n\t\t\t\t\treturn Meteor.setTimeout(function() {\n\t\t\t\t\t\tconst result = HTTP.get(requestUrl, {\n\t\t\t\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\t\t\t\tencoding: 'binary'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t\tif (result.statusCode === 200) {\n\t\t\t\t\t\t\treturn RocketChat.Assets.setAsset(result.content, result.headers['content-type'], 'logo');\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 30000);\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\n\t\treturn RocketChat.models.Settings.remove({\n\t\t\t_id: 'Layout_Login_Header'\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 37,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Find permission add-user (changed it to create-user)\n\t\t\tconst addUserPermission = RocketChat.models.Permissions.findOne('add-user');\n\n\t\t\tif (addUserPermission) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'create-user' }, { $set: { roles: addUserPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 38,\n\tup() {\n\t\tif (RocketChat && RocketChat.settings && RocketChat.settings.get) {\n\t\t\tconst allowPinning = RocketChat.settings.get('Message_AllowPinningByAnyone');\n\n\t\t\t// If public pinning was allowed, add pinning permissions to 'users', else leave it to 'owners' and 'moderators'\n\t\t\tif (allowPinning) {\n\t\t\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\t\t\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'user' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 39,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst footer = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\n\t\t\t// Replace footer octicons with icons\n\t\t\tif (footer && footer.value !== '') {\n\t\t\t\tlet footerValue = footer.value.replace('octicon octicon-pencil', 'icon-pencil');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-heart', 'icon-heart');\n\t\t\t\tfooterValue = footerValue.replace('octicon octicon-mark-github', 'icon-github-circled');\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: footerValue, packageValue: footerValue } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 40,\n\tup() {\n\t\tRocketChat.models.Settings.find({ _id: /Accounts_OAuth_Custom_/, i18nLabel: 'Accounts_OAuth_Custom_Enable' }).forEach(function(customOauth) {\n\t\t\tconst parts = customOauth._id.split('_');\n\t\t\tconst name = parts[3];\n\t\t\tconst id = `Accounts_OAuth_Custom_${ name }_token_sent_via`;\n\t\t\tif (!RocketChat.models.Settings.findOne({ _id: id })) {\n\t\t\t\tRocketChat.models.Settings.insert({\n\t\t\t\t\t'_id': id,\n\t\t\t\t\t'type': 'select',\n\t\t\t\t\t'group': 'OAuth',\n\t\t\t\t\t'section': `Custom OAuth: ${ name }`,\n\t\t\t\t\t'i18nLabel': 'Accounts_OAuth_Custom_Token_Sent_Via',\n\t\t\t\t\t'persistent': true,\n\t\t\t\t\t'values': [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'header',\n\t\t\t\t\t\t\t'i18nLabel': 'Header'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t'key': 'payload',\n\t\t\t\t\t\t\t'i18nLabel': 'Payload'\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\t\t\t\t\t'packageValue': 'payload',\n\t\t\t\t\t'valueSource': 'packageValue',\n\t\t\t\t\t'ts': new Date(),\n\t\t\t\t\t'hidden': false,\n\t\t\t\t\t'blocked': false,\n\t\t\t\t\t'sorter': 255,\n\t\t\t\t\t'i18nDescription': `Accounts_OAuth_Custom_${ name }_token_sent_via_Description`,\n\t\t\t\t\t'createdAt': new Date(),\n\t\t\t\t\t'value': 'payload'\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 41,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ bot: true }, { $set: { type: 'bot' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'profile.guest': true }, { $set: { type: 'visitor' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 42,\n\tup() {\n\t\tconst files = RocketChat.__migration_assets_files = new Mongo.Collection('assets.files');\n\t\tconst chunks = RocketChat.__migration_assets_chunks = new Mongo.Collection('assets.chunks');\n\t\tconst list = {\n\t\t\t'favicon.ico': 'favicon_ico',\n\t\t\t'favicon.svg': 'favicon',\n\t\t\t'favicon_64.png': 'favicon_64',\n\t\t\t'favicon_96.png': 'favicon_96',\n\t\t\t'favicon_128.png': 'favicon_128',\n\t\t\t'favicon_192.png': 'favicon_192',\n\t\t\t'favicon_256.png': 'favicon_256'\n\t\t};\n\n\t\tfor (const from of Object.keys(list)) {\n\t\t\tconst to = list[from];\n\n\t\t\tconst query = {\n\t\t\t\t_id: to\n\t\t\t};\n\n\t\t\tif (!files.findOne(query)) {\n\t\t\t\tconst oldFile = files.findOne({\n\t\t\t\t\t_id: from\n\t\t\t\t});\n\n\t\t\t\tif (oldFile) {\n\t\t\t\t\tconst extension = RocketChat.Assets.mime.extension(oldFile.contentType);\n\t\t\t\t\tRocketChat.settings.removeById(`Assets_${ from }`);\n\t\t\t\t\tRocketChat.settings.updateById(`Assets_${ to }`, {\n\t\t\t\t\t\turl: `/assets/${ to }.${ extension }`,\n\t\t\t\t\t\tdefaultUrl: RocketChat.Assets.assets[to].defaultUrl\n\t\t\t\t\t});\n\n\t\t\t\t\toldFile._id = to;\n\t\t\t\t\toldFile.filename = to;\n\t\t\t\t\tfiles.insert(oldFile);\n\t\t\t\t\tfiles.remove({\n\t\t\t\t\t\t_id: from\n\t\t\t\t\t});\n\n\t\t\t\t\tchunks.update({\n\t\t\t\t\t\tfiles_id: from\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\tfiles_id: to\n\t\t\t\t\t\t}\n\t\t\t\t\t}, {\n\t\t\t\t\t\tmulti: true\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 43,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Permissions) {\n\t\t\tRocketChat.models.Permissions.update({ _id: 'pin-message' }, { $addToSet: { roles: 'admin' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 44,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.find({ $or: [ { 'settings.preferences.disableNewRoomNotification': { $exists: 1 } }, { 'settings.preferences.disableNewMessageNotification': { $exists: 1 } } ] }).forEach(function(user) {\n\t\t\t\tconst newRoomNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewRoomNotification);\n\t\t\t\tconst newMessageNotification = !(user && user.settings && user.settings.preferences && user.settings.preferences.disableNewMessageNotification);\n\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.disableNewRoomNotification': 1, 'settings.preferences.disableNewMessageNotification': 1 }, $set: { 'settings.preferences.newRoomNotification': newRoomNotification, 'settings.preferences.newMessageNotification': newMessageNotification } });\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst optOut = RocketChat.models.Settings.findOne({ _id: 'Statistics_opt_out' });\n\t\t\tif (optOut) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Statistics_opt_out' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Statistics_reporting' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !optOut.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Statistics_reporting_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Statistics_reporting'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst favoriteRooms = RocketChat.models.Settings.findOne({ _id: 'Disable_Favorite_Rooms' });\n\t\t\tif (favoriteRooms) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'Disable_Favorite_Rooms' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'Favorite_Rooms' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: !favoriteRooms.value ? true : false,\n\t\t\t\t\t\ti18nDescription: 'Favorite_Rooms_Description',\n\t\t\t\t\t\tpackageValue: true,\n\t\t\t\t\t\ti18nLabel: 'Favorite_Rooms'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 45,\n\tup() {\n\n\t\t// finds the latest created visitor\n\t\tconst lastVisitor = RocketChat.models.Users.find({ type: 'visitor' }, { fields: { username: 1 }, sort: { createdAt: -1 }, limit: 1 }).fetch();\n\n\t\tif (lastVisitor && lastVisitor.length > 0) {\n\t\t\tconst lastNumber = lastVisitor[0].username.replace(/^guest\\-/, '');\n\n\t\t\tRocketChat.settings.add('Livechat_guest_count', (parseInt(lastNumber) + 1), { type: 'int', group: 'Livechat' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 46,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ type: { $exists: false } }, { $set: { type: 'user' } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 47,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst autolinkerUrls = RocketChat.models.Settings.findOne({ _id: 'AutoLinker_Urls' });\n\t\t\tif (autolinkerUrls) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'AutoLinker_Urls' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_Scheme' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_Scheme'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_www' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_www'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'AutoLinker_Urls_TLD' }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: autolinkerUrls.value ? true : false,\n\t\t\t\t\t\ti18nLabel: 'AutoLinker_Urls_TLD'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 48,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\tconst RocketBot_Enabled = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t});\n\t\t\tif (RocketBot_Enabled) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Enabled'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Enabled'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Enabled.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst RocketBot_Name = RocketChat.models.Settings.findOne({\n\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t});\n\t\t\tif (RocketBot_Name) {\n\t\t\t\tRocketChat.models.Settings.remove({\n\t\t\t\t\t_id: 'RocketBot_Name'\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Settings.upsert({\n\t\t\t\t\t_id: 'InternalHubot_Username'\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tvalue: RocketBot_Name.value\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 49,\n\tup() {\n\n\t\tlet count = 1;\n\n\t\tRocketChat.models.Rooms.find({ t: 'l' }, { sort: { ts: 1 }, fields: { _id: 1 } }).forEach(function(room) {\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { code: count } });\n\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, { $set: { code: count } }, { multi: true });\n\t\t\tcount++;\n\t\t});\n\n\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_Room_Count' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: count,\n\t\t\t\ttype: 'int',\n\t\t\t\tgroup: 'Livechat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 50,\n\tup() {\n\t\tRocketChat.models.Subscriptions.tryDropIndex('u._id_1_name_1_t_1');\n\t\tRocketChat.models.Subscriptions.tryEnsureIndex({ 'u._id': 1, 'name': 1, 't': 1 });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 51,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ t: 'l', 'v.token': { $exists: true }, label: { $exists: false }}).forEach(function(room) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ 'profile.token': room.v.token });\n\t\t\tif (user) {\n\t\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tlabel: user.name || user.username,\n\t\t\t\t\t\t'v._id': user._id\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Subscriptions.update({ rid: room._id }, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tname: user.name || user.username\n\t\t\t\t\t}\n\t\t\t\t}, { multi: true });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 52,\n\tup() {\n\t\tRocketChat.models.Users.update({ _id: 'rocket.cat' }, { $addToSet: { roles: 'bot' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 53,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Header', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" bgcolor=\"#f3f3f3\" style=\"color:#4a4a4a;font-family: Helvetica,Arial,sans-serif;font-size:14px;line-height:20px;border-collapse:callapse;border-spacing:0;margin:0 auto\"><tr><td style=\"padding:1em\"><table border=\"0\" cellspacing=\"0\" cellpadding=\"0\" align=\"center\" width=\"100%\" style=\"width:100%;margin:0 auto;max-width:800px\"><tr><td bgcolor=\"#ffffff\" style=\"background-color:#ffffff; border: 1px solid #DDD; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\"><table width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\"><tr><td style=\"background-color: #04436a;\"><h1 style=\"font-family: Helvetica,Arial,sans-serif; padding: 0 1em; margin: 0; line-height: 70px; color: #FFF;\">[Site_Name]</h1></td></tr><tr><td style=\"padding: 1em; font-size: 10pt; font-family: Helvetica,Arial,sans-serif;\">'\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Settings.update({ _id: 'Email_Footer', value: '' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: '</td></tr></table></td></tr><tr><td border=\"0\" cellspacing=\"0\" cellpadding=\"0\" width=\"100%\" style=\"font-family: Helvetica,Arial,sans-serif; max-width: 800px; margin: 0 auto; padding: 1.5em; text-align: center; font-size: 8pt; color: #999;\">Powered by <a href=\"https://rocket.chat\" target=\"_blank\">Rocket.Chat</a></td></tr></table></td></tr></table>'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 54,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\t// Set default message viewMode to 'normal' or 'cozy' depending on the users' current settings and remove the field 'compactView'\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.compactView': true }, { $set: { 'settings.preferences.viewMode': 1 }, $unset: { 'settings.preferences.compactView': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.viewMode': { $ne: 1 } }, { $set: { 'settings.preferences.viewMode': 0 } }, { multi: true });\n\t\t}\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 55,\n\tup() {\n\t\tRocketChat.models.Rooms.find({ 'topic': { $exists: 1, $ne: '' } }, { topic: 1 }).forEach(function(room) {\n\t\t\tconst topic = s.escapeHTML(room.topic);\n\t\t\tRocketChat.models.Rooms.update({ _id: room._id }, { $set: { topic }});\n\t\t\tRocketChat.models.Messages.update({ t: 'room_changed_topic', rid: room._id }, { $set: { msg: topic }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 56,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.S?(.*)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 57,\n\tup() {\n\t\tRocketChat.models.Messages.find({ _id: /slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/slack-([a-zA-Z0-9]+)S([0-9]+-[0-9]+)/, 'slack-$1-$2');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /slack-slack/ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace('slack-slack', 'slack');\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\n\t\tRocketChat.models.Messages.find({ _id: /\\./ }).forEach(function(message) {\n\t\t\tconst oldId = message._id;\n\t\t\tmessage._id = message._id.replace(/(.*)\\.?S(.*)/, 'slack-$1-$2');\n\t\t\tmessage._id = message._id.replace(/\\./g, '-');\n\t\t\tRocketChat.models.Messages.remove({ _id: message._id });\n\t\t\tRocketChat.models.Messages.insert(message);\n\t\t\tRocketChat.models.Messages.remove({ _id: oldId });\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 58,\n\tup() {\n\t\tRocketChat.models.Settings.update({ _id: 'Push_gateway', value: 'https://rocket.chat' }, {\n\t\t\t$set: {\n\t\t\t\tvalue: 'https://gateway.rocket.chat',\n\t\t\t\tpackageValue: 'https://gateway.rocket.chat'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 59,\n\tup() {\n\t\tconst users = RocketChat.models.Users.find({}, { sort: { createdAt: 1 }, limit: 1 }).fetch();\n\t\tif (users && users.length > 0) {\n\t\t\tconst createdAt = users[0].createdAt;\n\t\t\tRocketChat.models.Settings.update({ createdAt: { $exists: 0 } }, { $set: { createdAt } }, { multi: true });\n\t\t\tRocketChat.models.Statistics.update({ installedAt: { $exists: 0 } }, { $set: { installedAt: createdAt } }, { multi: true });\n\t\t}\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.Migrations.add({\n\tversion: 60,\n\tup() {\n\t\tlet subscriptions = RocketChat.models.Subscriptions.find({ $or: [ { name: { $exists: 0 } }, { name: { $not: { $type: 2 } } } ] }).fetch();\n\t\tif (subscriptions && subscriptions.length > 0) {\n\t\t\tRocketChat.models.Subscriptions.remove({ _id: { $in: _.pluck(subscriptions, '_id') } });\n\t\t}\n\n\t\tsubscriptions = RocketChat.models.Subscriptions.find().forEach(function(subscription) {\n\t\t\tconst user = RocketChat.models.Users.findOne({ _id: subscription && subscription.u && subscription.u._id });\n\t\t\tif (!user) {\n\t\t\t\tRocketChat.models.Subscriptions.remove({ _id: subscription._id });\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 61,\n\tup() {\n\t\tRocketChat.models.Users.find({ active: false }).forEach(function(user) {\n\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, true);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 62,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Atlassian Crowd', type: 'group' });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 63,\n\tup() {\n\t\tconst forward = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats' });\n\t\tconst timeout = RocketChat.models.Settings.findOne({ _id:'Livechat_forward_open_chats_timeout' });\n\n\t\tif (forward && forward.value) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: 'forward',\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (timeout && timeout.value !== 60) {\n\t\t\tRocketChat.models.Settings.upsert({ _id: 'Livechat_agent_leave_action_timeout' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: timeout.value,\n\t\t\t\t\ttype: 'int',\n\t\t\t\t\tgroup: 'Livechat'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats' });\n\t\tRocketChat.models.Settings.remove({ _id: 'Livechat_forward_open_chats_timeout' });\n\t}\n});\n","import s from 'underscore.string';\n\nRocketChat.Migrations.add({\n\tversion: 64,\n\tup() {\n\t\tRocketChat.models.Messages.find({ 't': 'room_changed_topic', 'msg': /</ }, { msg: 1 }).forEach(function(message) {\n\t\t\tconst msg = s.escapeHTML(message.msg);\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { msg }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 65,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tconst replace2 = RocketChat.models.Settings.findOne({ _id: 'theme-color-input-font-color' });\n\t\t\tconst replace3 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-online' });\n\t\t\tconst replace4 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-away' });\n\t\t\tconst replace5 = RocketChat.models.Settings.findOne({ _id: 'theme-color-status-busy' });\n\t\t\tconst replace6 = RocketChat.models.Settings.findOne({ _id: 'theme-color-info-active-font-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-secondary-action-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t\tif (replace2) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace2.value } });\n\t\t\t}\n\t\t\tif (replace3) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-success-color' }, { $set: { value: replace3.value } });\n\t\t\t}\n\t\t\tif (replace4) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-pending-color' }, { $set: { value: replace4.value } });\n\t\t\t}\n\t\t\tif (replace5) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-error-color' }, { $set: { value: replace5.value } });\n\t\t\t}\n\t\t\tif (replace6) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-selection-color' }, { $set: { value: replace6.value } });\n\t\t\t}\n\n\t\t\t// Renamed color settings\n\t\t\tconst oldColor = RocketChat.models.Settings.findOne({ _id: 'theme-color-action-buttons-color' });\n\t\t\tif (oldColor) {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-action-buttons-color' });\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-primary-action-color' }, { $set: { value: oldColor.value } });\n\t\t\t}\n\n\t\t\t// Removed color settings\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-quaternary-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-active-channel-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-blockquote-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-clean-buttons-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-background' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-border' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-code-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-info-active-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-input-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-message-hover-background-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-font-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-smallprint-hover-color' });\n\t\t\tRocketChat.models.Settings.remove({ _id: 'theme-color-unread-notification-color' });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 66,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\n\t\t\t// New color settings - start with old settings as defaults\n\t\t\tconst replace1 = RocketChat.models.Settings.findOne({ _id: 'theme-color-tertiary-background-color' });\n\t\t\tif (replace1) {\n\t\t\t\tRocketChat.models.Settings.upsert({ _id: 'theme-color-component-color' }, { $set: { value: replace1.value } });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 67,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.LivechatDepartment) {\n\t\t\tRocketChat.models.LivechatDepartment.model.update({}, {\n\t\t\t\t$set: {\n\t\t\t\t\tshowOnRegistration: true\n\t\t\t\t}\n\t\t\t}, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 68,\n\tup() {\n\t\tconst GoogleSiteVerification_id = RocketChat.models.Settings.findOne({ _id: 'GoogleSiteVerification_id' });\n\n\t\tif (GoogleSiteVerification_id && GoogleSiteVerification_id.value) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'Meta_google-site-verification' }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvalue: GoogleSiteVerification_id.value\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'GoogleSiteVerification_id' });\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 69,\n\tup() {\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-custom-scrollbar-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.05)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-info-font-color',\n\t\t\t'value': '#aaaaaa'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@secondary-font-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-link-font-color',\n\t\t\t'value': '#008ce3'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@primary-action-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-away',\n\t\t\t'value': '#fcb316'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@pending-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-busy',\n\t\t\t'value': '#d30230'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@error-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-offline',\n\t\t\t'value': 'rgba(150, 150, 150, 0.50)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-darker'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-status-online',\n\t\t\t'value': '#35ac19'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@success-color'\n\t\t\t}\n\t\t});\n\t\tRocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-background-color',\n\t\t\t'value': '#eaeaea'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@component-color'\n\t\t\t}\n\t\t});\n\t\treturn RocketChat.models.Settings.update({\n\t\t\t'_id': 'theme-color-tertiary-font-color',\n\t\t\t'value': 'rgba(255, 255, 255, 0.6)'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\t'editor': 'expression',\n\t\t\t\t'value': '@transparent-lightest'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 70,\n\tup() {\n\t\tconst settings = RocketChat.models.Settings.find({ _id: /^Accounts_OAuth_Custom_.+/ }).fetch();\n\t\tfor (const setting of settings) {\n\t\t\tconst _id = setting._id;\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)_(.+)/, 'Accounts_OAuth_Custom-$1-$2');\n\t\t\tsetting._id = setting._id.replace(/Accounts_OAuth_Custom_([A-Za-z0-9]+)/, 'Accounts_OAuth_Custom-$1');\n\n\t\t\tRocketChat.models.Settings.remove({ _id });\n\t\t\tRocketChat.models.Settings.insert(setting);\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71,\n\tup() {\n\t\t//Removes the reactions on messages which are the system type \"rm\" ;)\n\t\tRocketChat.models.Messages.find({ 't': 'rm', 'reactions': { $exists: true, $not: {$size: 0} } }, { t: 1 }).forEach(function(message) {\n\t\t\tRocketChat.models.Messages.update({ _id: message._id }, { $set: { reactions: [] }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 72,\n\tup() {\n\t\tRocketChat.models.Users.find({ type: 'visitor', 'emails.address': { $exists: true } }, { emails: 1 }).forEach(function(visitor) {\n\t\t\tRocketChat.models.Users.update({ _id: visitor._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\tvisitorEmails: visitor.emails\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\temails: 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 73,\n\tup() {\n\t\tRocketChat.models.Users.find({ 'oauth.athorizedClients': { $exists: true } }, { oauth: 1 }).forEach(function(user) {\n\t\t\tRocketChat.models.Users.update({ _id: user._id }, {\n\t\t\t\t$set: {\n\t\t\t\t\t'oauth.authorizedClients': user.oauth.athorizedClients\n\t\t\t\t},\n\t\t\t\t$unset: {\n\t\t\t\t\t'oauth.athorizedClients': 1\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 74,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_64'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_96'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_128'});\n\t\t\tRocketChat.models.Settings.remove({_id: 'Assets_favicon_256'});\n\t\t\tRocketChat.models.Settings.update({_id: 'Assets_favicon_192'}, {\n\t\t\t\t$set: {\n\t\t\t\t\ti18nLabel: 'android-chrome 192x192 (png)'\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 71.1,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\nRocketChat.Migrations.add({\n\tversion: 75,\n\tup() {\n\t\tServiceConfiguration.configurations.remove({});\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 76,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.find({section: 'Colors (alphas)'}).forEach((setting) => {\n\t\t\t\tRocketChat.models.Settings.remove({ _id: setting._id });\n\t\t\t});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 77,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Rooms) {\n\t\t\tRocketChat.models.Rooms.find({\n\t\t\t\tt: 'l',\n\t\t\t\t'v._id': { $exists: true },\n\t\t\t\t'v.username': { $exists: false }\n\t\t\t}, { fields: { 'v._id': 1 } }).forEach(function(room) {\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ _id: room.v._id }, { username: 1 });\n\n\t\t\t\tif (user && user.username) {\n\t\t\t\t\tRocketChat.models.Rooms.update({\n\t\t\t\t\t\t_id: room._id\n\t\t\t\t\t}, {\n\t\t\t\t\t\t$set: {\n\t\t\t\t\t\t\t'v.username': user.username\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n});\n\n","RocketChat.Migrations.add({\n\tversion: 78,\n\tup() {\n\t\tRocketChat.models.Permissions.update({ _id: { $in: ['create-c', 'create-d', 'create-p'] }}, { $addToSet: { roles: 'bot' }}, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 79,\n\tup() {\n\t\tconst integrations = RocketChat.models.Integrations.find({type: 'webhook-incoming'}).fetch();\n\n\t\tfor (const integration of integrations) {\n\t\t\tif (typeof integration.channel === 'string') {\n\t\t\t\tRocketChat.models.Integrations.update({_id: integration._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tchannel: integration.channel.split(',').map(channel => channel.trim())\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 80,\n\tup() {\n\t\tconst query = {\n\t\t\ttype: 'webhook-outgoing',\n\t\t\t$or: [{\n\t\t\t\tchannel: []\n\t\t\t}, {\n\t\t\t\tchannel: ''\n\t\t\t}, {\n\t\t\t\tchannel: {\n\t\t\t\t\t$exists: false\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tconst update = {\n\t\t\t$set: {\n\t\t\t\tchannel: ['all_public_channels']\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Integrations.update(query, update, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 81,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tactive: true,\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/App32270API/'\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 82,\n\tup() {\n\t\tconst admins = RocketChat.authz.getUsersInRole('admin').fetch();\n\t\tif (admins.length === 1 && admins[0]._id === 'rocket.cat') {\n\t\t\tRocketChat.authz.removeUserFromRoles('rocket.cat', 'admin');\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 83,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings && RocketChat.models.Users) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'InternalHubot_Username' });\n\t\t\tif (setting && setting.value) {\n\t\t\t\tconst username = setting.value;\n\t\t\t\tconst user = RocketChat.models.Users.findOne({ username });\n\t\t\t\tif (!user && setting.value === 'Rocket.Cat') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_Username' }, { $set: { value: 'rocket.cat', packageValue: 'rocket.cat' } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 84,\n\tup() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Update permission name, copy values from old name\n\t\t\tconst oldPermission = RocketChat.models.Permissions.findOne('add-user-to-room');\n\t\t\tif (oldPermission && oldPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-joined-room' }, { $set: { roles: oldPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-room' });\n\t\t\t}\n\t\t}\n\t},\n\n\tdown() {\n\t\tif (RocketChat.models && RocketChat.models.Permissions) {\n\n\t\t\t// Revert permission name, copy values from updated name\n\t\t\tconst newPermission = RocketChat.models.Permissions.findOne('add-user-to-joined-room');\n\t\t\tif (newPermission && newPermission.roles.length) {\n\t\t\t\tRocketChat.models.Permissions.upsert({ _id: 'add-user-to-room' }, { $set: { roles: newPermission.roles } });\n\t\t\t\tRocketChat.models.Permissions.remove({ _id: 'add-user-to-joined-room' });\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 85,\n\tup() {\n\t\tconst query = {\n\t\t\tt: 'p',\n\t\t\tusernames: {$size: 2},\n\t\t\tu: {$exists: false},\n\t\t\tname: {$exists: false}\n\t\t};\n\n\t\tconst rooms = RocketChat.models.Rooms.find(query).fetch();\n\n\t\tif (rooms.length > 0) {\n\t\t\tconst rids = rooms.map(room => room._id);\n\t\t\tRocketChat.models.Rooms.update({_id: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t\tRocketChat.models.Subscriptions.update({rid: {$in: rids}}, {$set: {t: 'd'}}, {multi: true});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 86,\n\tup() {\n\t\t// Disabled this migration for it was not updating any user\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 87,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Users) {\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': false }, { $set: { 'settings.preferences.newMessageNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newMessageNotification': true }, { $unset: { 'settings.preferences.newMessageNotification': 1 } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': false }, { $set: { 'settings.preferences.newRoomNotification': 'none' } }, { multi: true });\n\t\t\tRocketChat.models.Users.update({ 'settings.preferences.newRoomNotification': true }, { $unset: { 'settings.preferences.newRoomNotification': 1 } }, { multi: true });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 88,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Layout_Sidenav_Footer' });\n\t\t\tif (setting && setting.value && setting.packageValue) {\n\t\t\t\tif (setting.value === '<img style=\"left: 10px; position: absolute;\" src=\"/assets/logo.png\" />') {\n\t\t\t\t\tRocketChat.models.Settings.update({ _id: 'Layout_Sidenav_Footer' }, { $set: { value: setting.packageValue } });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 89,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { event: 'sendMessage', retryFailedCalls: true, retryCount: 6, retryDelay: 'powers-of-ten' }});\n\t\t});\n\t},\n\tdown() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', event: { $ne: 'sendMessage' }}, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { enabled: false }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 90,\n\tup() {\n\t\tRocketChat.models.Settings.remove({ _id: 'Piwik', type: 'group' });\n\n\t\tconst settings = RocketChat.models.Settings.find({$or: [{_id: 'PiwikAnalytics_url', value: {$ne: null}}, {_id: 'PiwikAnalytics_siteId', value: {$ne: null}}]}).fetch();\n\n\t\tif (settings && settings.length === 2) {\n\t\t\tRocketChat.models.Settings.upsert({_id: 'PiwikAnalytics_enabled'}, {$set: {value: true}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 91,\n\tup() {\n\t\tconst query = {\n\t\t\t'services.linkedin': {\n\t\t\t\t$exists: 1\n\t\t\t},\n\t\t\t$or: [{\n\t\t\t\tname: {\n\t\t\t\t\t$exists: 0\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tname: null\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'services.linkedin.firstName': 1, username: 1}).forEach((user) => {\n\t\t\tconst name = `${ user.services.linkedin.firstName } ${ user.services.linkedin.lastName }`;\n\n\t\t\tRocketChat.models.Users.setName(user._id, name);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 92,\n\tup() {\n\t\tconst outgoingIntegrations = RocketChat.models.Integrations.find({ type: 'webhook-outgoing', 'event': 'sendMessage' }, { fields: { name: 1 }}).fetch();\n\n\t\toutgoingIntegrations.forEach((i) => {\n\t\t\tRocketChat.models.Integrations.update(i._id, { $set: { runOnEdits: true }});\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 93,\n\tup() {\n\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst setting = RocketChat.models.Settings.findOne({ _id: 'Accounts_AllowAnonymousAccess' });\n\t\t\tif (setting && setting.value === true) {\n\t\t\t\tRocketChat.models.Settings.update({ _id: 'Accounts_AllowAnonymousRead' }, { $set: { value: setting.value } });\n\t\t\t}\n\t\t}\n\n\t\tconst query = {\n\t\t\t_id: {\n\t\t\t\t$in: [\n\t\t\t\t\t'view-c-room',\n\t\t\t\t\t'view-history',\n\t\t\t\t\t'view-joined-room',\n\t\t\t\t\t'view-p-room',\n\t\t\t\t\t'preview-c-room'\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\n\t\tconst update = {\n\t\t\t$addToSet: {\n\t\t\t\troles: 'anonymous'\n\t\t\t}\n\t\t};\n\n\t\tRocketChat.models.Permissions.update(query, update, { multi: true });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 94,\n\tup() {\n\t\tconst query = {\n\t\t\t'emails.address.address': { $exists: true }\n\t\t};\n\n\t\tRocketChat.models.Users.find(query, {'emails.address.address': 1}).forEach((user) => {\n\t\t\tlet emailAddress;\n\t\t\tuser.emails.some(email => {\n\t\t\t\tif (email.address && email.address.address) {\n\t\t\t\t\temailAddress = email.address.address;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tconst existingUser = RocketChat.models.Users.findOne({ 'emails.address': emailAddress }, { fields: { _id: 1 } });\n\t\t\tif (existingUser) {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'emails.$': 1\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Users.update({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\t'emails.address.address': emailAddress\n\t\t\t\t}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'emails.$.address': emailAddress\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 95,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tconst emailHeader = RocketChat.models.Settings.findOne({ _id: 'Email_Header' });\n\t\t\tconst emailFooter = RocketChat.models.Settings.findOne({ _id: 'Email_Footer' });\n\t\t\tconst startWithHTML = emailHeader.value.match(/^<html>/);\n\t\t\tconst endsWithHTML = emailFooter.value.match(/<\\/html>$/);\n\n\t\t\tif (!startWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Header' },\n\t\t\t\t\t{ $set: { value: `<html>${ emailHeader.value }`} }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!endsWithHTML) {\n\t\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t\t{ _id: 'Email_Footer' },\n\t\t\t\t\t{ $set: { value: `${ emailFooter.value }</html>`} }\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 96,\n\tup() {\n\t\tif (RocketChat && RocketChat.models && RocketChat.models.Settings) {\n\t\t\tRocketChat.models.Settings.update({ _id: 'InternalHubot_ScriptsToLoad' }, { $set: { value: '' } });\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 97,\n\tup() {\n\t\t// Migration moved to 099.js to fix a bug\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 98,\n\tup() {\n\t\tRocketChat.models.OAuthApps.update({ _id: 'zapier' }, {\n\t\t\t$set: {\n\t\t\t\tredirectUri: 'https://zapier.com/dashboard/auth/oauth/return/RocketChatDevAPI/'\n\t\t\t}\n\t\t});\n\t}\n});\n","/* globals SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\n\nfunction log(...args) {\n\tconsole.log('[AVATAR]', ...args);\n}\n\nfunction logError(...args) {\n\tconsole.error('[AVATAR]', ...args);\n}\n\nfunction insertAvatar({ details, avatarsFileStore, stream, callback = () => {} }) {\n\treturn new Promise((resolve) => {\n\t\tMeteor.defer(() => {\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tavatarsFileStore.insert(details, stream, (err) => {\n\t\t\t\t\tif (err) {\n\t\t\t\t\t\tlogError({err});\n\t\t\t\t\t\tresolve();\n\t\t\t\t\t} else {\n\t\t\t\t\t\tMeteor.setTimeout(() => {\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}, 200);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction batch(arr, limit, fn) {\n\tif (!arr.length) {\n\t\treturn Promise.resolve();\n\t}\n\treturn Promise.all(arr.splice(0, limit).map((item) => {\n\t\treturn fn(item);\n\t})).then(() => { return batch(arr, limit, fn); });\n}\n\nRocketChat.Migrations.add({\n\tversion: 99,\n\tup() {\n\t\tlog('Migrating avatars. This might take a while.');\n\n\t\tconst query = {\n\t\t\t$or: [{\n\t\t\t\t's3.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\t'googleCloudStorage.path': {\n\t\t\t\t\t$exists: true\n\t\t\t\t}\n\t\t\t}]\n\t\t};\n\n\t\tRocketChat.models.Uploads.find(query).forEach((record) => {\n\t\t\tif (record.s3) {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\t'store': 'AmazonS3:Uploads',\n\t\t\t\t\t\tAmazonS3: {\n\t\t\t\t\t\t\tpath: record.s3.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\ts3: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t} else {\n\t\t\t\tRocketChat.models.Uploads.model.direct.update({_id: record._id}, {\n\t\t\t\t\t$set: {\n\t\t\t\t\t\tstore: 'GoogleCloudStorage:Uploads',\n\t\t\t\t\t\tGoogleStorage: {\n\t\t\t\t\t\t\tpath: record.googleCloudStorage.path + record._id\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\tgoogleCloudStorage: 1\n\t\t\t\t\t}\n\t\t\t\t}, {multi: true});\n\t\t\t}\n\t\t});\n\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'fileSystem'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'FileSystem:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\t\tRocketChat.models.Uploads.model.direct.update({\n\t\t\tstore: 'rocketchat_uploads'\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tstore: 'GridFS:Uploads'\n\t\t\t}\n\t\t}, {\n\t\t\tmulti: true\n\t\t});\n\n\t\tconst avatarOrigins = [\n\t\t\t'upload',\n\t\t\t'gravatar',\n\t\t\t'facebook',\n\t\t\t'twitter',\n\t\t\t'github',\n\t\t\t'google',\n\t\t\t'url',\n\t\t\t'gitlab',\n\t\t\t'linkedin'\n\t\t];\n\n\t\tconst avatarsPathRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStorePath'});\n\t\tconst avatarStoreTypeRecord = RocketChat.models.Settings.findOne({_id: 'Accounts_AvatarStoreType'});\n\n\t\tconst avatarsPath = avatarsPathRecord ? avatarsPathRecord.value : process.env.AVATARS_PATH;\n\t\tlet avatarStoreType = avatarStoreTypeRecord && avatarStoreTypeRecord.value;\n\n\t\tconst oldAvatarGridFS = new RocketChatFile.GridFS({\n\t\t\tname: 'avatars'\n\t\t});\n\n\t\tif (avatarStoreType == null) {\n\t\t\tconst count = oldAvatarGridFS.countSync();\n\t\t\tif (Match.test(count, Number) && count > 0) {\n\t\t\t\tavatarStoreType = 'GridFS';\n\t\t\t} else if (Match.test(avatarsPath, String) && avatarsPath.length > 0) {\n\t\t\t\tavatarStoreType = 'FileSystem';\n\t\t\t} else {\n\t\t\t\tSystemLogger.error_box('Can\\'t define the avatar\\'s storage type.\\nIf you have avatars missing and they was stored in your file system\\nrun the process including the following environment variables: \\n  AVATARS_PATH=\\'YOUR AVATAR\\'S DIRECTORY\\'\\n  MIGRATION_VERSION=99,rerun', 'WARNING');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tMeteor.startup(function() {\n\t\t\tMeteor.setTimeout(function() {\n\t\t\t\tconst avatarsFileStore = FileUpload.getStore('Avatars');\n\n\t\t\t\tconst users = RocketChat.models.Users.find({avatarOrigin: {$in: avatarOrigins}}, {avatarOrigin: 1, username: 1}).fetch();\n\n\t\t\t\tconst usersTotal = users.length;\n\n\t\t\t\tlog('Total users to migrate avatars ->', usersTotal);\n\n\t\t\t\tlet current = 0;\n\n\t\t\t\tbatch(users, 300, (user) => {\n\t\t\t\t\tconst id = `${ user.username }.jpg`;\n\n\t\t\t\t\tconst gridFSAvatar = oldAvatarGridFS.getFileWithReadStream(id);\n\n\t\t\t\t\tlog('Migrating', ++current, 'of', usersTotal);\n\n\t\t\t\t\tif (gridFSAvatar) {\n\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\ttype: gridFSAvatar.contentType,\n\t\t\t\t\t\t\tsize: gridFSAvatar.length\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\tstream: gridFSAvatar.readStream,\n\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\toldAvatarGridFS.deleteFile(id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\tif (avatarStoreType === 'FileSystem' && avatarsPath && avatarsPath.trim()) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tconst filePath = path.join(avatarsPath, id);\n\t\t\t\t\t\t\tconst stat = fs.statSync(filePath);\n\t\t\t\t\t\t\tif (stat && stat.isFile()) {\n\t\t\t\t\t\t\t\tconst details = {\n\t\t\t\t\t\t\t\t\tuserId: user._id,\n\t\t\t\t\t\t\t\t\ttype: 'image/jpeg',\n\t\t\t\t\t\t\t\t\tsize: stat.size\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\treturn insertAvatar({\n\t\t\t\t\t\t\t\t\tdetails,\n\t\t\t\t\t\t\t\t\tavatarsFileStore,\n\t\t\t\t\t\t\t\t\tstream: fs.createReadStream(filePath),\n\t\t\t\t\t\t\t\t\tcallback() {\n\t\t\t\t\t\t\t\t\t\tfs.unlinkSync(filePath);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tlogError('Error migrating old avatar', e);\n\t\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}).then(() => {\n\t\t\t\t\tconst avatarsFiles = new Mongo.Collection('avatars.files');\n\t\t\t\t\tconst avatarsChunks = new Mongo.Collection('avatars.chunks');\n\t\t\t\t\tavatarsFiles.rawCollection().drop();\n\t\t\t\t\tavatarsChunks.rawCollection().drop();\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStoreType'});\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: 'Accounts_AvatarStorePath'});\n\t\t\t\t});\n\t\t\t}, 1000);\n\t\t});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 100,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({audioNotification:{$exists:1}}, { $rename: { 'audioNotification': 'audioNotifications' } });\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 101,\n\tup() {\n\t\tRocketChat.models.Subscriptions.update({lastActivity:{$exists:1}}, { $unset: { 'lastActivity': '' } }, {multi: true});\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 102,\n\tup() {\n\t\tif (!RocketChat || !RocketChat.models || !RocketChat.models.Settings) {\n\t\t\treturn;\n\t\t}\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Connect_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tRocketChat.models.Settings.update(\n\t\t\t{ _id: 'LDAP_Idle_Timeout', value: 600000 },\n\t\t\t{ $set: { value: 1000 } }\n\t\t);\n\n\t\tconst LDAP_Domain_Base = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Base' });\n\t\tif (LDAP_Domain_Base) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_BaseDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Base.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Base' });\n\n\t\tconst LDAP_Domain_Search_User_ID = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User_ID' });\n\t\tif (LDAP_Domain_Search_User_ID) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Field' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User_ID.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User_ID' });\n\n\t\tconst LDAP_Use_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tconst LDAP_Custom_Domain_Search = RocketChat.models.Settings.findOne({ _id: 'LDAP_Custom_Domain_Search' });\n\n\t\tconst LDAP_Domain_Search_User = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_User' });\n\t\tconst LDAP_Domain_Search_Password = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Password' });\n\t\tconst LDAP_Domain_Search_Filter = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tconst LDAP_Domain_Search_Object_Class = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tconst LDAP_Domain_Search_Object_Category = RocketChat.models.Settings.findOne({ _id: 'LDAP_Domain_Search_Object_Category' });\n\n\t\tif (LDAP_Use_Custom_Domain_Search) {\n\t\t\tif (LDAP_Use_Custom_Domain_Search.value === true) {\n\t\t\t\tlet Custom_Domain_Search;\n\t\t\t\ttry {\n\t\t\t\t\tCustom_Domain_Search = JSON.parse(LDAP_Custom_Domain_Search.value);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow new Error('Invalid Custom Domain Search JSON');\n\t\t\t\t}\n\n\t\t\t\tLDAP_Domain_Search_User.value = Custom_Domain_Search.userDN || '';\n\t\t\t\tLDAP_Domain_Search_Password.value = Custom_Domain_Search.password || '';\n\t\t\t\tLDAP_Domain_Search_Filter.value = Custom_Domain_Search.filter;\n\t\t\t} else {\n\t\t\t\tconst filter = [];\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Category.value !== '') {\n\t\t\t\t\tfilter.push(`(objectCategory=${ LDAP_Domain_Search_Object_Category.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Object_Class.value !== '') {\n\t\t\t\t\tfilter.push(`(objectclass=${ LDAP_Domain_Search_Object_Class.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (LDAP_Domain_Search_Filter.value !== '') {\n\t\t\t\t\tfilter.push(`(${ LDAP_Domain_Search_Filter.value })`);\n\t\t\t\t}\n\n\t\t\t\tif (filter.length === 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = filter[0];\n\t\t\t\t} else if (filter.length > 1) {\n\t\t\t\t\tLDAP_Domain_Search_Filter.value = `(&${ filter.join('') })`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (LDAP_Domain_Search_Filter && LDAP_Domain_Search_Filter.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_User_Search_Filter' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Filter.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Filter' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_UserDN' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_User.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_User' });\n\n\n\t\tif (LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication_Password' },\n\t\t\t\t{ $set: { value: LDAP_Domain_Search_Password.value } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Password' });\n\n\t\tif (LDAP_Domain_Search_User && LDAP_Domain_Search_User.value && LDAP_Domain_Search_Password && LDAP_Domain_Search_Password.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Authentication' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Use_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Custom_Domain_Search' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Class' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Domain_Search_Object_Category' });\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Sync_Users' }); //Button\n\n\t\tconst LDAP_Sync_User_Data = RocketChat.models.Settings.findOne({ _id: 'LDAP_Sync_User_Data' });\n\t\tif (LDAP_Sync_User_Data && LDAP_Sync_User_Data.value) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync' },\n\t\t\t\t{ $set: { value: true } }\n\t\t\t);\n\t\t}\n\n\t\tconst LDAP_Import_Users = RocketChat.models.Settings.findOne({ _id: 'LDAP_Import_Users' });\n\t\tif (LDAP_Import_Users && LDAP_Import_Users.value === false) {\n\t\t\tRocketChat.models.Settings.update(\n\t\t\t\t{ _id: 'LDAP_Background_Sync_Import_New_Users' },\n\t\t\t\t{ $set: { value: false } }\n\t\t\t);\n\t\t}\n\t\tRocketChat.models.Settings.remove({ _id: 'LDAP_Import_Users' });\n\t}\n});\n","const majorColors = {\n\t'content-background-color': '#FFFFFF',\n\t'primary-background-color': '#04436A',\n\t'primary-font-color': '#444444',\n\t'primary-action-color': '#13679A', // was action-buttons-color\n\t'secondary-background-color': '#F4F4F4',\n\t'secondary-font-color': '#A0A0A0',\n\t'secondary-action-color': '#DDDDDD',\n\t'component-color': '#EAEAEA',\n\t'success-color': '#4dff4d',\n\t'pending-color': '#FCB316',\n\t'error-color': '#BC2031',\n\t'selection-color': '#02ACEC',\n\t'attention-color': '#9C27B0'\n};\n\n// Minor colours implement major colours by default, but can be overruled\n// const minorColors = {\n// \t'tertiary-background-color': '@component-color',\n// \t'tertiary-font-color': '@transparent-lightest',\n// \t'link-font-color': '@primary-action-color',\n// \t'info-font-color': '@secondary-font-color',\n// \t'custom-scrollbar-color': '@transparent-darker',\n// \t'status-online': '@success-color',\n// \t'status-away': '@pending-color',\n// \t'status-busy': '@error-color',\n// \t'status-offline': '@transparent-darker'\n// };\n\nconst newvariables = {\n\t'content-background-color': 'rc-color-primary-lightest',\n\t'primary-background-color': 'rc-color-primary',\n\t'success-color': 'rc-color-success',\n\t'pending-color': 'rc-color-alert',\n\t'error-color': 'rc-color-error',\n\t'status-online': 'rc-color-success',\n\t'status-away': 'rc-color-alert',\n\t'status-busy': 'rc-color-error',\n\t'status-offline': 'rc-color-primary-darkest'\n};\n\nfunction lightenDarkenColor(col, amt) {\n\tlet usePound = false;\n\tif (col[0] === '#') {\n\t\tcol = col.slice(1);\n\t\tusePound = true;\n\t}\n\n\tconst num = parseInt(col, 16);\n\tlet r = (num >> 16) + amt;\n\n\tif (r > 255) { r = 255; } else if (r < 0) { r = 0; }\n\n\tlet b = ((num >> 8) & 0x00FF) + amt;\n\n\tif (b > 255) { b = 255; } else if (b < 0) { b = 0; }\n\n\tlet g = (num & 0x0000FF) + amt;\n\n\tif (g > 255) { g = 255; } else if (g < 0) { g = 0; }\n\n\treturn (usePound ? '#' : '') + (g | (b << 8) | (r << 16)).toString(16);\n}\n\nRocketChat.Migrations.add({\n\tversion: 103,\n\tup() {\n\t\tObject.keys(majorColors).forEach(function(_id) {\n\t\t\tconst color = RocketChat.models.Settings.findOne({_id: `theme-color-${ _id }`});\n\t\t\tconst key = newvariables[_id];\n\t\t\tif (color && color.value !== majorColors[_id] && key) {\n\t\t\t\tif (/^@.+/.test(color.value)) {\n\t\t\t\t\tcolor.value = newvariables[color.value.replace('@', '')];\n\t\t\t\t}\n\t\t\t\tconst id = `theme-color-${ key }`;\n\t\t\t\tRocketChat.models.Settings.update({_id: id}, {$set: { value : color.value, editor: /^#.+/.test(color.value) ? 'color' : 'expression' }});\n\t\t\t\tif (key === 'rc-color-primary') {\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, -16)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 18)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 110)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 156)}});\n\t\t\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'color', value: lightenDarkenColor(color.value, 200)}});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n});\n","RocketChat.Migrations.add({\n\tversion: 104,\n\tup() {\n\t\tif ((RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary'}) || {}).value === '#04436A' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-darkest'}) || {}).value === '#335a' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-dark'}) || {}).value === '#16557c' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light'}) || {}).value === '#72b1d8' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-light-medium'}) || {}).value === '#a0dfff' &&\n\t\t\t(RocketChat.models.Settings.findOne({_id: 'theme-color-rc-color-primary-lightest'}) || {}).value === '#ccffff'\n\t\t) {\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary'}, {$set: {editor: 'expression', value: 'color-dark'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-darkest'}, {$set: {editor: 'expression', value: 'color-darkest'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-dark'}, {$set: {editor: 'expression', value: 'color-dark-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light'}, {$set: {editor: 'expression', value: 'color-gray'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-light-medium'}, {$set: {editor: 'expression', value: 'color-gray-medium'}});\n\t\t\tRocketChat.models.Settings.update({_id: 'theme-color-rc-color-primary-lightest'}, {$set: {editor: 'expression', value: 'color-gray-lightest'}});\n\t\t}\n\t}\n});\n","RocketChat.Migrations.add({\n\tversion: 105,\n\tup() {\n\t\tif (RocketChat && RocketChat.models) {\n\t\t\tif (RocketChat.models.Users) {\n\t\t\t\tRocketChat.models.Users.find({ 'settings.preferences.unreadRoomsMode': { $exists: 1 } }).forEach(function(user) {\n\t\t\t\t\tconst newPreference = user.settings.preferences.unreadRoomsMode ? 'unread' : 'category';\n\t\t\t\t\tRocketChat.models.Users.update({ _id: user._id }, { $unset: { 'settings.preferences.unreadRoomsMode': 1 }, $set: { 'settings.preferences.roomsListExhibitionMode': newPreference } });\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (RocketChat.models.Settings) {\n\t\t\t\tconst settingsMap = {\n\t\t\t\t\t'Desktop_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_desktopNotifications',\n\t\t\t\t\t'Mobile_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_mobileNotifications',\n\t\t\t\t\t'Audio_Notifications_Default_Alert': 'Accounts_Default_User_Preferences_audioNotifications',\n\t\t\t\t\t'Desktop_Notifications_Duration': 'Accounts_Default_User_Preferences_desktopNotificationDuration',\n\t\t\t\t\t'Audio_Notifications_Value': undefined\n\t\t\t\t};\n\t\t\t\tRocketChat.models.Settings.find({ _id: { $in: Object.keys(settingsMap) }}).forEach(oldSetting => {\n\t\t\t\t\tconst newSettingKey = settingsMap[oldSetting._id];\n\t\t\t\t\tconst newSetting = newSettingKey && RocketChat.models.Settings.findOne({ _id: newSettingKey });\n\n\t\t\t\t\tif (newSetting && newSetting.value !== oldSetting.value) {\n\t\t\t\t\t\tRocketChat.models.Settings.update({ _id: newSettingKey }, {\t$set: {\tvalue: oldSetting.value\t}\t});\n\t\t\t\t\t}\n\t\t\t\t\tRocketChat.models.Settings.remove({_id: oldSetting._id });\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n});\n","import _ from 'underscore';\n\nif (RocketChat.Migrations.getVersion() !== 0) {\n\tRocketChat.Migrations.migrateTo(process.env.MIGRATION_VERSION || 'latest');\n} else {\n\tconst control = RocketChat.Migrations._getControl();\n\tcontrol.version = _.last(RocketChat.Migrations._list).version;\n\tRocketChat.Migrations._setControl(control);\n}\n","if (Meteor.AppCache) {\n\tMeteor.AppCache.config({\n\t\tonlineOnly: ['/elements/', '/landing/', '/moment-locales/', '/scripts/']\n\t});\n}\n","/* globals FileUpload */\nimport _ from 'underscore';\n\nMeteor.startup(function() {\n\tWebApp.connectHandlers.use('/avatar/', Meteor.bindEnvironment(function(req, res/*, next*/) {\n\t\tconst params = {\n\t\t\tusername: decodeURIComponent(req.url.replace(/^\\//, '').replace(/\\?.*$/, ''))\n\t\t};\n\n\t\tif (_.isEmpty(params.username)) {\n\t\t\tres.writeHead(403);\n\t\t\tres.write('Forbidden');\n\t\t\tres.end();\n\t\t\treturn;\n\t\t}\n\n\t\tconst match = /^\\/([^?]*)/.exec(req.url);\n\n\t\tif (match[1]) {\n\t\t\tlet username = decodeURIComponent(match[1]);\n\t\t\tlet file;\n\n\t\t\tusername = username.replace(/\\.jpg$/, '');\n\n\t\t\tif (username[0] !== '@') {\n\t\t\t\tif (Meteor.settings && Meteor.settings.public && Meteor.settings.public.sandstorm) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username);\n\t\t\t\t\tif (user && user.services && user.services.sandstorm && user.services.sandstorm.picture) {\n\t\t\t\t\t\tres.setHeader('Location', user.services.sandstorm.picture);\n\t\t\t\t\t\tres.writeHead(302);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfile = RocketChat.models.Avatars.findOneByName(username);\n\t\t\t}\n\n\t\t\tif (file) {\n\t\t\t\tres.setHeader('Content-Security-Policy', 'default-src \\'none\\'');\n\n\t\t\t\treturn FileUpload.get(file, req, res);\n\t\t\t} else {\n\t\t\t\tres.setHeader('Content-Type', 'image/svg+xml');\n\t\t\t\tres.setHeader('Cache-Control', 'public, max-age=0');\n\t\t\t\tres.setHeader('Expires', '-1');\n\t\t\t\tres.setHeader('Last-Modified', 'Thu, 01 Jan 2015 00:00:00 GMT');\n\n\t\t\t\tconst reqModifiedHeader = req.headers['if-modified-since'];\n\n\t\t\t\tif (reqModifiedHeader) {\n\t\t\t\t\tif (reqModifiedHeader === 'Thu, 01 Jan 2015 00:00:00 GMT') {\n\t\t\t\t\t\tres.writeHead(304);\n\t\t\t\t\t\tres.end();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (RocketChat.settings.get('UI_Use_Name_Avatar')) {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneByUsername(username, {\n\t\t\t\t\t\tfields: {\n\t\t\t\t\t\t\tname: 1\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (user && user.name) {\n\t\t\t\t\t\tusername = user.name;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tlet color = '';\n\t\t\t\tlet initials = '';\n\n\t\t\t\tif (username === '?') {\n\t\t\t\t\tcolor = '#000';\n\t\t\t\t\tinitials = username;\n\t\t\t\t} else {\n\t\t\t\t\tcolor = RocketChat.getAvatarColor(username);\n\n\t\t\t\t\tinitials = username.replace(/[^A-Za-z0-9]/g, '').substr(0, 1).toUpperCase();\n\t\t\t\t}\n\n\t\t\t\tconst svg = `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\" standalone=\\\"no\\\"?>\\n<svg xmlns=\\\"http://www.w3.org/2000/svg\\\" pointer-events=\\\"none\\\" width=\\\"50\\\" height=\\\"50\\\">\\n<rect height=\"50\" width=\"50\" fill=\\\"${ color }\\\"/>\\n<text text-anchor=\\\"middle\\\" y=\\\"50%\\\" x=\\\"50%\\\" dy=\\\"0.36em\\\" pointer-events=\\\"auto\\\" fill=\\\"#ffffff\\\" font-family=\\\"Helvetica, Arial, Lucida Grande, sans-serif\\\" font-weight=\"400\" font-size=\"28\">\\n${ initials }\\n</text>\\n</svg>`;\n\n\t\t\t\tres.write(svg);\n\t\t\t\tres.end();\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tres.writeHead(404);\n\t\tres.end();\n\t\treturn;\n\t}));\n});\n","/* global SyncedCron */\n\nconst logger = new Logger('SyncedCron');\n\nSyncedCron.config({\n\tlogger(opts) {\n\t\treturn logger[opts.level].call(logger, opts.message);\n\t},\n\tcollectionName: 'rocketchat_cron_history'\n});\n\nfunction generateStatistics() {\n\tconst statistics = RocketChat.statistics.save();\n\n\tstatistics.host = Meteor.absoluteUrl();\n\n\tif (RocketChat.settings.get('Statistics_reporting')) {\n\t\ttry {\n\t\t\tHTTP.post('https://collector.rocket.chat/', {\n\t\t\t\tdata: statistics\n\t\t\t});\n\t\t} catch (error) {\n\t\t\t/*error*/\n\t\t\tlogger.warn('Failed to send usage report');\n\t\t}\n\t}\n}\n\nfunction cleanupOEmbedCache() {\n\treturn Meteor.call('OEmbedCacheCleanup');\n}\n\nMeteor.startup(function() {\n\treturn Meteor.defer(function() {\n\t\tgenerateStatistics();\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Generate and save statistics',\n\t\t\tschedule(parser) {\n\t\t\t\treturn parser.cron(`${ new Date().getMinutes() } * * * *`);\n\t\t\t},\n\t\t\tjob: generateStatistics\n\t\t});\n\n\t\tSyncedCron.add({\n\t\t\tname: 'Cleanup OEmbed cache',\n\t\t\tschedule(parser) {\n\t\t\t\tconst now = new Date();\n\t\t\t\treturn parser.cron(`${ now.getMinutes() } ${ now.getHours() } * * *`);\n\t\t\t},\n\t\t\tjob: cleanupOEmbedCache\n\t\t});\n\n\t\treturn SyncedCron.start();\n\t});\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nfunction flat(obj, newObj = {}, path = '') {\n\tfor (const key of Object.keys(obj)) {\n\t\tconst value = obj[key];\n\n\t\tif (_.isObject(value)) {\n\t\t\tflat(value, newObj, `${ key }.`);\n\t\t} else {\n\t\t\tnewObj[path + key] = value;\n\t\t}\n\t}\n\n\treturn newObj;\n}\n\nRocketChat.i18nValidation = function i18nValidation() {\n\tconst l = {};\n\tconst keys = {};\n\tconst errors = [];\n\tconst langs = Object.keys(TAPi18next.options.resStore);\n\n\tfor (const lang of Object.keys(TAPi18next.options.resStore)) {\n\t\tconst value = TAPi18next.options.resStore[lang];\n\n\t\tl[lang] = flat(value);\n\n\t\tfor (const key of Object.keys(l[lang])) {\n\t\t\tif (keys[key] == null) {\n\t\t\t\tkeys[key] = [];\n\t\t\t}\n\t\t\tkeys[key].push(lang);\n\t\t}\n\t}\n\n\tlet len = 0;\n\tfor (const key of Object.keys(keys)) {\n\t\tconst present = keys[key];\n\n\t\tif (!(present.length !== langs.length)) {\n\t\t\tcontinue;\n\t\t}\n\n\t\tconst error = (`${ _.difference(langs, present).join(',') }: missing translation for `).red + key.white + (`. Present in [${ present.join(',') }]`).red;\n\n\t\terrors.push(error);\n\n\t\tif (error.length > len) {\n\t\t\tlen = error.length;\n\t\t}\n\t}\n\n\tif (errors.length > 0) {\n\t\tconsole.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\n\t\tfor (const error of errors) {\n\t\t\tconsole.log('|'.red, s.rpad(`${ error }`, len).red, '|'.red);\n\t\t}\n\n\t\treturn console.log('+'.red + s.rpad('', len - 28, '-').red + '+'.red);\n\t}\n};\n\n// Meteor.startup(function() {\n// \tRocketChat.i18nValidation();\n// });\n","import _ from 'underscore';\n\nMeteor.startup(function() {\n\tMeteor.defer(function() {\n\t\tif (!RocketChat.models.Rooms.findOneById('GENERAL')) {\n\t\t\tRocketChat.models.Rooms.createWithIdTypeAndName('GENERAL', 'c', 'general', {\n\t\t\t\t'default': true\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.models.Users.db.findOneById('rocket.cat')) {\n\t\t\tRocketChat.models.Users.create({\n\t\t\t\t_id: 'rocket.cat',\n\t\t\t\tname: 'Rocket.Cat',\n\t\t\t\tusername: 'rocket.cat',\n\t\t\t\tstatus: 'online',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'bot'\n\t\t\t});\n\n\t\t\tRocketChat.authz.addUserRoles('rocket.cat', 'bot');\n\n\t\t\tconst rs = RocketChatFile.bufferToStream(new Buffer(Assets.getBinary('avatars/rocketcat.png'), 'utf8'));\n\t\t\tconst fileStore = FileUpload.getStore('Avatars');\n\t\t\tfileStore.deleteByName('rocket.cat');\n\n\t\t\tconst file = {\n\t\t\t\tuserId: 'rocket.cat',\n\t\t\t\ttype: 'image/png'\n\t\t\t};\n\n\t\t\tMeteor.runAsUser('rocket.cat', () => {\n\t\t\t\tfileStore.insert(file, rs, () => {\n\t\t\t\t\treturn RocketChat.models.Users.setAvatarOrigin('rocket.cat', 'local');\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tif (process.env.ADMIN_PASS) {\n\t\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\t\tconsole.log('Inserting admin user:'.green);\n\t\t\t\tconst adminUser = {\n\t\t\t\t\tname: 'Administrator',\n\t\t\t\t\tusername: 'admin',\n\t\t\t\t\tstatus: 'offline',\n\t\t\t\t\tstatusDefault: 'online',\n\t\t\t\t\tutcOffset: 0,\n\t\t\t\t\tactive: true\n\t\t\t\t};\n\n\t\t\t\tif (process.env.ADMIN_NAME) {\n\t\t\t\t\tadminUser.name = process.env.ADMIN_NAME;\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\n\t\t\t\tif (process.env.ADMIN_EMAIL) {\n\t\t\t\t\tconst re = /^[^@].*@[^@]+$/i;\n\n\t\t\t\t\tif (re.test(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\tif (!RocketChat.models.Users.findOneByEmailAddress(process.env.ADMIN_EMAIL)) {\n\t\t\t\t\t\t\tadminUser.emails = [{\n\t\t\t\t\t\t\t\taddress: process.env.ADMIN_EMAIL,\n\t\t\t\t\t\t\t\tverified: true\n\t\t\t\t\t\t\t}];\n\n\t\t\t\t\t\t\tconsole.log((`Email: ${ process.env.ADMIN_EMAIL }`).green);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Email provided already exists; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Email provided is invalid; Ignoring environment variables ADMIN_EMAIL'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (process.env.ADMIN_USERNAME) {\n\t\t\t\t\tlet nameValidation;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tnameValidation = new RegExp(`^${ RocketChat.settings.get('UTF8_Names_Validation') }$`);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\tnameValidation = new RegExp('^[0-9a-zA-Z-_.]+$');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nameValidation.test(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\tif (RocketChat.checkUsernameAvailability(process.env.ADMIN_USERNAME)) {\n\t\t\t\t\t\t\tadminUser.username = process.env.ADMIN_USERNAME;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconsole.log('Username provided already exists; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconsole.log('Username provided is invalid; Ignoring environment variables ADMIN_USERNAME'.red);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\n\t\t\t\tadminUser.type = 'user';\n\n\t\t\t\tconst id = RocketChat.models.Users.create(adminUser);\n\n\t\t\t\tAccounts.setPassword(id, process.env.ADMIN_PASS);\n\n\t\t\t\tconsole.log((`Password: ${ process.env.ADMIN_PASS }`).green);\n\n\t\t\t\tRocketChat.authz.addUserRoles(id, 'admin');\n\t\t\t} else {\n\t\t\t\tconsole.log('Users with admin role already exist; Ignoring environment variables ADMIN_PASS'.red);\n\t\t\t}\n\t\t}\n\n\t\tif (typeof process.env.INITIAL_USER === 'string' && process.env.INITIAL_USER.length > 0) {\n\t\t\ttry {\n\t\t\t\tconst initialUser = JSON.parse(process.env.INITIAL_USER);\n\n\t\t\t\tif (!initialUser._id) {\n\t\t\t\t\tconsole.log('No _id provided; Ignoring environment variable INITIAL_USER'.red);\n\t\t\t\t} else if (!RocketChat.models.Users.findOneById(initialUser._id)) {\n\t\t\t\t\tconsole.log('Inserting initial user:'.green);\n\t\t\t\t\tconsole.log(JSON.stringify(initialUser, null, 2).green);\n\t\t\t\t\tRocketChat.models.Users.create(initialUser);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log('Error processing environment variable INITIAL_USER'.red, e);\n\t\t\t}\n\t\t}\n\n\t\tif (_.isEmpty(RocketChat.authz.getUsersInRole('admin').fetch())) {\n\t\t\tconst oldestUser = RocketChat.models.Users.findOne({\n\t\t\t\t_id: {\n\t\t\t\t\t$ne: 'rocket.cat'\n\t\t\t\t}\n\t\t\t}, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t},\n\t\t\t\tsort: {\n\t\t\t\t\tcreatedAt: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (oldestUser) {\n\t\t\t\tRocketChat.authz.addUserRoles(oldestUser._id, 'admin');\n\t\t\t\tconsole.log(`No admins are found. Set ${ oldestUser.username } as admin for being the oldest user`);\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Users.removeById('rocketchat.internal.admin.test');\n\n\t\tif (process.env.TEST_MODE === 'true') {\n\t\t\tconsole.log('Inserting admin test user:'.green);\n\n\t\t\tconst adminUser = {\n\t\t\t\t_id: 'rocketchat.internal.admin.test',\n\t\t\t\tname: 'RocketChat Internal Admin Test',\n\t\t\t\tusername: 'rocketchat.internal.admin.test',\n\t\t\t\temails: [\n\t\t\t\t\t{\n\t\t\t\t\t\taddress: 'rocketchat.internal.admin.test@rocket.chat',\n\t\t\t\t\t\tverified: true\n\t\t\t\t\t}\n\t\t\t\t],\n\t\t\t\tstatus: 'offline',\n\t\t\t\tstatusDefault: 'online',\n\t\t\t\tutcOffset: 0,\n\t\t\t\tactive: true,\n\t\t\t\ttype: 'user'\n\t\t\t};\n\n\t\t\tconsole.log((`Name: ${ adminUser.name }`).green);\n\t\t\tconsole.log((`Email: ${ adminUser.emails[0].address }`).green);\n\t\t\tconsole.log((`Username: ${ adminUser.username }`).green);\n\t\t\tconsole.log((`Password: ${ adminUser._id }`).green);\n\n\t\t\tif (RocketChat.models.Users.db.findOneByEmailAddress(adminUser.emails[0].address)) {\n\t\t\t\tthrow new Meteor.Error(`Email ${ adminUser.emails[0].address } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tif (!RocketChat.checkUsernameAvailability(adminUser.username)) {\n\t\t\t\tthrow new Meteor.Error(`Username ${ adminUser.username } already exists`, 'Rocket.Chat can\\'t run in test mode');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.create(adminUser);\n\n\t\t\tAccounts.setPassword(adminUser._id, adminUser._id);\n\n\t\t\tRocketChat.authz.addUserRoles(adminUser._id, 'admin');\n\n\t\t\treturn RocketChat.addUserToDefaultChannels(adminUser, true);\n\t\t}\n\t});\n});\n","/* globals InstanceStatus, UserPresence, UserPresenceMonitor */\n\nMeteor.startup(function() {\n\tconst instance = {\n\t\thost: 'localhost',\n\t\tport: String(process.env.PORT).trim()\n\t};\n\n\tif (process.env.INSTANCE_IP) {\n\t\tinstance.host = String(process.env.INSTANCE_IP).trim();\n\t}\n\n\tInstanceStatus.registerInstance('rocket.chat', instance);\n\n\tUserPresence.start();\n\n\treturn UserPresenceMonitor.start();\n});\n","Meteor.startup(function() {\n\tRocketChat.roomTypes.setPublish('c', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\tjoinCodeRequired: 1\n\t\t\t}\n\t\t};\n\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeAndName('c', identifier, options);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\tconst roomId = RocketChat.models.Subscriptions.findByTypeNameAndUserId('c', identifier, this.userId).fetch();\n\t\t\tif (roomId.length > 0) {\n\t\t\t\treturn RocketChat.models.Rooms.findById(roomId[0].rid, options);\n\t\t\t}\n\t\t}\n\n\t\treturn this.ready();\n\t});\n\n\tRocketChat.roomTypes.setPublish('p', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tannouncement: 1,\n\t\t\t\tmuted: 1,\n\t\t\t\tarchived: 1,\n\t\t\t\tro: 1,\n\t\t\t\treactWhenReadOnly: 1,\n\t\t\t\tjitsiTimeout: 1,\n\t\t\t\tdescription: 1,\n\t\t\t\tsysMes: 1,\n\t\t\t\ttokenpass: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', identifier, user.username, options);\n\t});\n\n\treturn RocketChat.roomTypes.setPublish('d', function(identifier) {\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1,\n\t\t\t\tcl: 1,\n\t\t\t\tu: 1,\n\t\t\t\tusernames: 1,\n\t\t\t\ttopic: 1,\n\t\t\t\tjitsiTimeout: 1\n\t\t\t}\n\t\t};\n\n\t\tconst user = RocketChat.models.Users.findOneById(this.userId, {\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t});\n\n\t\tif (RocketChat.authz.hasAtLeastOnePermission(this.userId, ['view-d-room', 'view-joined-room'])) {\n\t\t\treturn RocketChat.models.Rooms.findByTypeContainingUsernames('d', [user.username, identifier], options);\n\t\t}\n\n\t\treturn this.ready();\n\t});\n});\n","/* globals MongoInternals, SystemLogger */\n\nimport fs from 'fs';\nimport path from 'path';\nimport semver from 'semver';\n\nMeteor.startup(function() {\n\tlet oplogState = 'Disabled';\n\tif (MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle && MongoInternals.defaultRemoteCollectionDriver().mongo._oplogHandle.onOplogEntry) {\n\t\toplogState = 'Enabled';\n\t\tif (RocketChat.settings.get('Force_Disable_OpLog_For_Cache') === true) {\n\t\t\toplogState += ' (Disabled for Cache Sync)';\n\t\t}\n\t}\n\n\tconst desiredNodeVersion = semver.clean(fs.readFileSync(path.join(process.cwd(), '../../.node_version.txt')).toString());\n\tconst desiredNodeVersionMajor = String(semver.parse(desiredNodeVersion).major);\n\n\treturn Meteor.setTimeout(function() {\n\t\tlet msg = [\n\t\t\t`Rocket.Chat Version: ${ RocketChat.Info.version }`,\n\t\t\t`     NodeJS Version: ${ process.versions.node } - ${ process.arch }`,\n\t\t\t`           Platform: ${ process.platform }`,\n\t\t\t`       Process Port: ${ process.env.PORT }`,\n\t\t\t`           Site URL: ${ RocketChat.settings.get('Site_Url') }`,\n\t\t\t`   ReplicaSet OpLog: ${ oplogState }`\n\t\t];\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.hash) {\n\t\t\tmsg.push(`        Commit Hash: ${ RocketChat.Info.commit.hash.substr(0, 10) }`);\n\t\t}\n\n\t\tif (RocketChat.Info.commit && RocketChat.Info.commit.branch) {\n\t\t\tmsg.push(`      Commit Branch: ${ RocketChat.Info.commit.branch }`);\n\t\t}\n\n\t\tmsg = msg.join('\\n');\n\n\t\tif (semver.satisfies(process.versions.node, desiredNodeVersionMajor)) {\n\t\t\treturn SystemLogger.startup_box(msg, 'SERVER RUNNING');\n\t\t}\n\n\t\tmsg += ['', '', 'YOUR CURRENT NODEJS VERSION IS NOT SUPPORTED,', `PLEASE UPGRADE / DOWNGRADE TO VERSION ${ desiredNodeVersionMajor }.X.X`].join('\\n');\n\n\t\tSystemLogger.error_box(msg, 'SERVER ERROR');\n\n\t\treturn process.exit();\n\t}, 100);\n});\n","import _ from 'underscore';\n\nconst orig_updateOrCreateUserFromExternalService = Accounts.updateOrCreateUserFromExternalService;\n\nAccounts.updateOrCreateUserFromExternalService = function(serviceName, serviceData = {} /*, options*/) {\n\tconst services = [\n\t\t'facebook',\n\t\t'github',\n\t\t'gitlab',\n\t\t'google',\n\t\t'meteor-developer',\n\t\t'linkedin',\n\t\t'twitter',\n\t\t'sandstorm'\n\t];\n\n\tif (services.includes(serviceName) === false && serviceData._OAuthCustom !== true) {\n\t\treturn;\n\t}\n\n\tif (serviceName === 'meteor-developer') {\n\t\tif (Array.isArray(serviceData.emails)) {\n\t\t\tconst primaryEmail = serviceData.emails.sort(a => a.primary !== true).filter(item => item.verified === true)[0];\n\t\t\tserviceData.email = primaryEmail && primaryEmail.address;\n\t\t}\n\t}\n\n\tif (serviceName === 'linkedin') {\n\t\tserviceData.email = serviceData.emailAddress;\n\t}\n\n\tif (serviceData.email) {\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(serviceData.email);\n\t\tif (user != null) {\n\t\t\tconst findQuery = {\n\t\t\t\taddress: serviceData.email,\n\t\t\t\tverified: true\n\t\t\t};\n\n\t\t\tif (!_.findWhere(user.emails, findQuery)) {\n\t\t\t\tRocketChat.models.Users.resetPasswordAndSetRequirePasswordChange(user._id, true, 'This_email_has_already_been_used_and_has_not_been_verified__Please_change_your_password');\n\t\t\t}\n\n\t\t\tRocketChat.models.Users.setServiceId(user._id, serviceName, serviceData.id);\n\t\t\tRocketChat.models.Users.setEmailVerified(user._id, serviceData.email);\n\t\t}\n\t}\n\n\treturn orig_updateOrCreateUserFromExternalService.apply(this, arguments);\n};\n","Meteor.methods({\n\tOEmbedCacheCleanup() {\n\t\tif (Meteor.userId() && !RocketChat.authz.hasRole(Meteor.userId(), 'admin')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'OEmbedCacheCleanup'\n\t\t\t});\n\t\t}\n\n\t\tconst date = new Date();\n\t\tconst expirationDays = RocketChat.settings.get('API_EmbedCacheExpirationDays');\n\t\tdate.setDate(date.getDate() - expirationDays);\n\t\tRocketChat.models.OEmbedCache.removeAfterDate(date);\n\t\treturn {\n\t\t\tmessage: 'cache_cleared'\n\t\t};\n\t}\n});\n","Meteor.methods({\n\taddAllUserToRoom(rid, activeUsersOnly = false) {\n\n\t\tcheck (rid, String);\n\t\tcheck (activeUsersOnly, Boolean);\n\n\t\tif (RocketChat.authz.hasRole(this.userId, 'admin') === true) {\n\t\t\tconst userCount = RocketChat.models.Users.find().count();\n\t\t\tif (userCount > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\t\tif (room == null) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst userFilter = {};\n\t\t\tif (activeUsersOnly === true) {\n\t\t\t\tuserFilter.active = true;\n\t\t\t}\n\n\t\t\tconst users = RocketChat.models.Users.find(userFilter).fetch();\n\t\t\tconst now = new Date();\n\t\t\tusers.forEach(function(user) {\n\t\t\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\t\t\t\tif (subscription != null) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tRocketChat.callbacks.run('beforeJoinRoom', user, room);\n\t\t\t\tRocketChat.models.Rooms.addUsernameById(rid, user.username);\n\t\t\t\tRocketChat.models.Subscriptions.createWithRoomAndUser(room, user, {\n\t\t\t\t\tts: now,\n\t\t\t\t\topen: true,\n\t\t\t\t\talert: true,\n\t\t\t\t\tunread: 1,\n\t\t\t\t\tuserMentions: 1,\n\t\t\t\t\tgroupMentions: 0\n\t\t\t\t});\n\t\t\t\tRocketChat.models.Messages.createUserJoinWithRoomIdAndUser(rid, user, {\n\t\t\t\t\tts: now\n\t\t\t\t});\n\t\t\t\tMeteor.defer(function() {});\n\t\t\t\treturn RocketChat.callbacks.run('afterJoinRoom', user, room);\n\t\t\t});\n\t\t\treturn true;\n\t\t} else {\n\t\t\tthrow (new Meteor.Error(403, 'Access to Method Forbidden', {\n\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t}));\n\t\t}\n\t}\n});\n","Meteor.methods({\n\taddRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-leader', 'User is already a leader', {\n\t\t\t\tmethod: 'addRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('moderator') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-moderator', 'User is already a moderator', {\n\t\t\t\tmethod: 'addRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: fromUser.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\taddRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('owner') === true) {\n\t\t\tthrow new Meteor.Error('error-user-already-owner', 'User is already an owner', {\n\t\t\t\tmethod: 'addRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.addRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleAddedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'added',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tafterVerifyEmail() {\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'afterVerifyEmail'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tconst verifiedEmail = _.find(user.emails, (email) => email.verified);\n\n\t\tif (verifiedEmail) {\n\t\t\tRocketChat.models.Roles.addUserRoles(user._id, 'user');\n\t\t\tRocketChat.models.Roles.removeUserRoles(user._id, 'anonymous');\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tcanAccessRoom(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, Match.Maybe(String));\n\n\t\tlet user;\n\n\t\tif (!userId && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (userId) {\n\t\t\tuser = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\tfields: {\n\t\t\t\t\tusername: 1\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (!user || !user.username) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (!rid) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\t\tif (room) {\n\t\t\tif (RocketChat.authz.canAccessRoom.call(this, room, user)) {\n\t\t\t\tif (user) {\n\t\t\t\t\troom.username = user.username;\n\t\t\t\t}\n\t\t\t\treturn room;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'canAccessRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nMeteor.methods({\n\tchannelsList(filter, channelType, limit, sort) {\n\t\tthis.unblock();\n\n\t\tcheck(filter, String);\n\t\tcheck(channelType, String);\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'channelsList'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: {\n\t\t\t\tname: 1,\n\t\t\t\tt: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tmsgs: -1\n\t\t\t}\n\t\t};\n\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\tif (s.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tname: 1\n\t\t\t\t\t};\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = {\n\t\t\t\t\t\tmsgs: -1\n\t\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tconst roomTypes = [];\n\n\t\tif (channelType !== 'private') {\n\t\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room')) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c'\n\t\t\t\t});\n\t\t\t} else if (RocketChat.authz.hasPermission(Meteor.userId(), 'view-joined-room')) {\n\t\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', Meteor.userId()).fetch(), 'rid');\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'c',\n\t\t\t\t\tids: roomIds\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (channelType !== 'public' && RocketChat.authz.hasPermission(Meteor.userId(), 'view-p-room')) {\n\t\t\tconst user = Meteor.user();\n\t\t\tconst userPref = RocketChat.getUserPreference(user, 'mergeChannels') && RocketChat.getUserPreference(user, 'roomsListExhibitionMode') === 'category';\n\t\t\tconst globalPref = RocketChat.settings.get('UI_Merge_Channels_Groups');\n\t\t\tconst mergeChannels = userPref !== undefined ? userPref : globalPref;\n\n\t\t\tif (mergeChannels) {\n\t\t\t\troomTypes.push({\n\t\t\t\t\ttype: 'p',\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (roomTypes.length) {\n\t\t\tif (filter) {\n\t\t\t\treturn {\n\t\t\t\t\tchannels: RocketChat.models.Rooms.findByNameContainingTypesWithUsername(filter, roomTypes, options).fetch()\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tchannels: RocketChat.models.Rooms.findContainingTypesWithUsername(roomTypes, options).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\tchannels: []\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tcreateDirectMessage(username) {\n\t\tcheck(username, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst me = Meteor.user();\n\n\t\tif (!me.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.settings.get('Message_AllowDirectMessagesToYourself') === false && me.username === username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'create-d')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst to = RocketChat.models.Users.findOneByUsername(username);\n\n\t\tif (!to) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'createDirectMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst rid = [me._id, to._id].sort().join('');\n\n\t\tconst now = new Date();\n\n\t\t// Make sure we have a room\n\t\tRocketChat.models.Rooms.upsert({\n\t\t\t_id: rid\n\t\t}, {\n\t\t\t$set: {\n\t\t\t\tusernames: [me.username, to.username]\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tt: 'd',\n\t\t\t\tmsgs: 0,\n\t\t\t\tts: now\n\t\t\t}\n\t\t});\n\n\t\t// Make user I have a subcription to this room\n\t\tconst upsertSubscription = {\n\t\t\t$set: {\n\t\t\t\tts: now,\n\t\t\t\tls: now,\n\t\t\t\topen: true\n\t\t\t},\n\t\t\t$setOnInsert: {\n\t\t\t\tname: to.username,\n\t\t\t\tt: 'd',\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: me._id,\n\t\t\t\t\tusername: me.username\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (to.active === false) {\n\t\t\tupsertSubscription.$set.archived = true;\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': me._id}] // work around to solve problems with upsert and dot\n\t\t}, upsertSubscription);\n\n\t\tRocketChat.models.Subscriptions.upsert({\n\t\t\trid,\n\t\t\t$and: [{'u._id': to._id}] // work around to solve problems with upsert and dot\n\t\t}, {\n\t\t\t$setOnInsert: {\n\t\t\t\tname: me.username,\n\t\t\t\tt: 'd',\n\t\t\t\topen: false,\n\t\t\t\talert: false,\n\t\t\t\tunread: 0,\n\t\t\t\tuserMentions: 0,\n\t\t\t\tgroupMentions: 0,\n\t\t\t\tu: {\n\t\t\t\t\t_id: to._id,\n\t\t\t\t\tusername: to.username\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn {\n\t\t\trid\n\t\t};\n\t}\n});\n\nRocketChat.RateLimiter.limitMethod('createDirectMessage', 10, 60000, {\n\tuserId(userId) {\n\t\treturn !RocketChat.authz.hasPermission(userId, 'send-many-messages');\n\t}\n});\n","/* global FileUpload */\nMeteor.methods({\n\tdeleteFileMessage(fileID) {\n\t\tcheck(fileID, String);\n\n\t\tconst msg = RocketChat.models.Messages.getMessageByFileId(fileID);\n\n\t\tif (msg) {\n\t\t\treturn Meteor.call('deleteMessage', msg);\n\t\t}\n\n\t\treturn FileUpload.getStore('Uploads').deleteById(fileID);\n\t}\n});\n","Meteor.methods({\n\tdeleteUser(userId) {\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'delete-user') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'deleteUser'\n\t\t\t});\n\t\t}\n\n\t\tconst adminCount = Meteor.users.find({roles: 'admin'}).count();\n\n\t\tconst userIsAdmin = user.roles.indexOf('admin') > -1;\n\n\t\tif (adminCount === 1 && userIsAdmin) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'Leaving the app without admins is not allowed', {\n\t\t\t\tmethod: 'deleteUser',\n\t\t\t\taction: 'Remove_last_admin'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.deleteUser(userId);\n\n\t\treturn true;\n\t}\n});\n","/* globals RocketChat */\n\nMeteor.methods({\n\teraseRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.roomTypes.roomTypes[room.t].canBeDeleted(room)) {\n\t\t\tRocketChat.models.Messages.removeByRoomId(rid);\n\t\t\tRocketChat.models.Subscriptions.removeByRoomId(rid);\n\t\t\treturn RocketChat.models.Rooms.removeById(rid);\n\t\t} else {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'eraseRoom'\n\t\t\t});\n\t\t}\n\t}\n});\n","/* global Gravatar */\n\nfunction getAvatarSuggestionForUser(user) {\n\tcheck(user, Object);\n\n\tconst avatars = [];\n\n\tif (user.services.facebook && user.services.facebook.id && RocketChat.settings.get('Accounts_OAuth_Facebook')) {\n\t\tavatars.push({\n\t\t\tservice: 'facebook',\n\t\t\turl: `https://graph.facebook.com/${ user.services.facebook.id }/picture?type=large`\n\t\t});\n\t}\n\n\tif (user.services.google && user.services.google.picture && user.services.google.picture !== 'https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg' && RocketChat.settings.get('Accounts_OAuth_Google')) {\n\t\tavatars.push({\n\t\t\tservice: 'google',\n\t\t\turl: user.services.google.picture\n\t\t});\n\t}\n\n\tif (user.services.github && user.services.github.username && RocketChat.settings.get('Accounts_OAuth_Github')) {\n\t\tavatars.push({\n\t\t\tservice: 'github',\n\t\t\turl: `https://avatars.githubusercontent.com/${ user.services.github.username }?s=200`\n\t\t});\n\t}\n\n\tif (user.services.linkedin && user.services.linkedin.pictureUrl && RocketChat.settings.get('Accounts_OAuth_Linkedin')) {\n\t\tavatars.push({\n\t\t\tservice: 'linkedin',\n\t\t\turl: user.services.linkedin.pictureUrl\n\t\t});\n\t}\n\n\tif (user.services.twitter && user.services.twitter.profile_image_url_https && RocketChat.settings.get('Accounts_OAuth_Twitter')) {\n\t\tavatars.push({\n\t\t\tservice: 'twitter',\n\t\t\turl: user.services.twitter.profile_image_url_https.replace(/_normal|_bigger/, '')\n\t\t});\n\t}\n\n\tif (user.services.gitlab && user.services.gitlab.avatar_url && RocketChat.settings.get('Accounts_OAuth_Gitlab')) {\n\t\tavatars.push({\n\t\t\tservice: 'gitlab',\n\t\t\turl: user.services.gitlab.avatar_url\n\t\t});\n\t}\n\n\tif (user.services.sandstorm && user.services.sandstorm.picture && Meteor.settings['public'].sandstorm) {\n\t\tavatars.push({\n\t\t\tservice: 'sandstorm',\n\t\t\turl: user.services.sandstorm.picture\n\t\t});\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.verified === true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (email.verified !== true) {\n\t\t\t\tavatars.push({\n\t\t\t\t\tservice: 'gravatar',\n\t\t\t\t\turl: Gravatar.imageUrl(email.address, {\n\t\t\t\t\t\t'default': '404',\n\t\t\t\t\t\tsize: 200,\n\t\t\t\t\t\tsecure: true\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tconst validAvatars = {};\n\tfor (const avatar of avatars) {\n\t\ttry {\n\t\t\tconst result = HTTP.get(avatar.url, {\n\t\t\t\tnpmRequestOptions: {\n\t\t\t\t\tencoding: 'binary'\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (result.statusCode === 200) {\n\t\t\t\tlet blob = `data:${ result.headers['content-type'] };base64,`;\n\t\t\t\tblob += Buffer.from(result.content, 'binary').toString('base64');\n\t\t\t\tavatar.blob = blob;\n\t\t\t\tavatar.contentType = result.headers['content-type'];\n\t\t\t\tvalidAvatars[avatar.service] = avatar;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\t// error;\n\t\t}\n\t}\n\treturn validAvatars;\n}\n\nthis.getAvatarSuggestionForUser = getAvatarSuggestionForUser;\n\nMeteor.methods({\n\tgetAvatarSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getAvatarSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst user = Meteor.user();\n\n\t\treturn getAvatarSuggestionForUser(user);\n\t}\n});\n","Meteor.methods({\n\tgetRoomIdByNameOrId(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid) || RocketChat.models.Rooms.findOneByName(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room._id;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomIdByNameOrId'\n\t\t\t});\n\t\t}\n\n\t\treturn room._id;\n\t}\n});\n","Meteor.methods({\n\tgetRoomNameById(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(rid);\n\n\t\tif (room == null) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tif (user && user.username && room.usernames.indexOf(user.username) !== -1) {\n\t\t\treturn room.name;\n\t\t}\n\n\t\tif (room.t !== 'c' || RocketChat.authz.hasPermission(Meteor.userId(), 'view-c-room') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'getRoomNameById'\n\t\t\t});\n\t\t}\n\n\t\treturn room.name;\n\t}\n});\n","Meteor.methods({\n\tgetTotalChannels() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getTotalChannels'\n\t\t\t});\n\t\t}\n\n\t\tconst query = {\n\t\t\tt: 'c'\n\t\t};\n\t\treturn RocketChat.models.Rooms.find(query).count();\n\t}\n});\n","/* global slugify */\nimport _ from 'underscore';\n\nfunction slug(text) {\n\ttext = slugify(text, '.');\n\treturn text.replace(/[^0-9a-z-_.]/g, '');\n}\n\nfunction usernameIsAvaliable(username) {\n\tif (username.length < 1) {\n\t\treturn false;\n\t}\n\n\tif (username === 'all') {\n\t\treturn false;\n\t}\n\n\treturn !RocketChat.models.Users.findOneByUsername(username);\n}\n\nfunction generateSuggestion(user) {\n\tlet usernames = [];\n\tlet username = undefined;\n\n\tif (Meteor.settings['public'].sandstorm) {\n\t\tusernames.push(user.services.sandstorm.preferredHandle);\n\t}\n\n\tif (Match.test(user && user.name, String)) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.name));\n\t\t} else {\n\t\t\tusernames.push(user.name);\n\t\t}\n\n\t\tconst nameParts = user.name.split(' ');\n\n\t\tif (nameParts.length > 1) {\n\t\t\tconst first = nameParts[0];\n\t\t\tconst last = nameParts[nameParts.length - 1];\n\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(first[0] + last));\n\t\t\t\tusernames.push(slug(first + last[0]));\n\t\t\t} else {\n\t\t\t\tusernames.push(first[0] + last);\n\t\t\t\tusernames.push(first + last[0]);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.profile && user.profile.name) {\n\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\tusernames.push(slug(user.profile.name));\n\t\t} else {\n\t\t\tusernames.push(user.profile.name);\n\t\t}\n\t}\n\n\tif (Array.isArray(user.services)) {\n\t\tlet services = user.services.map((service) => {\n\t\t\treturn _.values(_.pick(service, 'name', 'username', 'firstName', 'lastName'));\n\t\t});\n\n\t\tservices = _.uniq(_.flatten(services));\n\n\t\tfor (const service of services) {\n\t\t\tif (RocketChat.settings.get('UTF8_Names_Slugify')) {\n\t\t\t\tusernames.push(slug(service));\n\t\t\t} else {\n\t\t\t\tusernames.push(service);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (user.emails && user.emails.length > 0) {\n\t\tfor (const email of user.emails) {\n\t\t\tif (email.address && email.verified === true) {\n\t\t\t\tusernames.push(slug(email.address.replace(/@.+$/, '')));\n\t\t\t\tusernames.push(slug(email.address.replace(/(.+)@(\\w+).+/, '$1.$2')));\n\t\t\t}\n\t\t}\n\t}\n\n\tusernames = _.compact(usernames);\n\n\tfor (const item of usernames) {\n\t\tif (usernameIsAvaliable(item)) {\n\t\t\treturn item;\n\t\t}\n\t}\n\n\tif (usernames.length === 0 || usernames[0].length === 0) {\n\t\tusernames.push(RocketChat.settings.get('Accounts_DefaultUsernamePrefixSuggestion'));\n\t}\n\n\tlet index = 0;\n\twhile (!username) {\n\t\tindex++;\n\t\tif (usernameIsAvaliable(`${ usernames[0] }-${ index }`)) {\n\t\t\tusername = `${ usernames[0] }-${ index }`;\n\t\t}\n\t}\n\n\tif (usernameIsAvaliable(username)) {\n\t\treturn username;\n\t}\n}\n\nRocketChat.generateUsernameSuggestion = generateSuggestion;\n\nMeteor.methods({\n\tgetUsernameSuggestion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getUsernameSuggestion'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn generateSuggestion(user);\n\t}\n});\n","Meteor.methods({\n\tgetUsersOfRoom(roomId, showAll) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst room = Meteor.call('canAccessRoom', roomId, Meteor.userId());\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getUsersOfRoom' });\n\t\t}\n\n\t\tconst filter = (record) => {\n\t\t\tif (!record._user) {\n\t\t\t\tconsole.log('Subscription without user', record._id);\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (showAll === true) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\treturn record._user.status !== 'offline';\n\t\t};\n\n\t\tconst map = (record) => {\n\t\t\treturn {\n\t\t\t\t_id: record._user._id,\n\t\t\t\tusername: record._user.username,\n\t\t\t\tname: record._user.name\n\t\t\t};\n\t\t};\n\n\t\tconst records = RocketChat.models.Subscriptions.findByRoomId(roomId).fetch();\n\n\t\treturn {\n\t\t\ttotal: records.length,\n\t\t\trecords: records.filter(filter).map(map)\n\t\t};\n\t}\n});\n","import _ from 'underscore';\nimport s from 'underscore.string';\n\nMeteor.methods({\n\tgroupsList(nameFilter, limit, sort) {\n\n\t\tcheck(nameFilter, Match.Optional(String));\n\t\tcheck(limit, Match.Optional(Number));\n\t\tcheck(sort, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'groupsList' });\n\t\t}\n\n\t\tconst options = {\n\t\t\tfields: { name: 1 },\n\t\t\tsort: { name: 1 }\n\t\t};\n\n\t\t//Verify the limit param is a number\n\t\tif (_.isNumber(limit)) {\n\t\t\toptions.limit = limit;\n\t\t}\n\n\t\t//Verify there is a sort option and it's a string\n\t\tif (s.trim(sort)) {\n\t\t\tswitch (sort) {\n\t\t\t\tcase 'name':\n\t\t\t\t\toptions.sort = { name: 1 };\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'msgs':\n\t\t\t\t\toptions.sort = { msgs: -1 };\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t//Determine if they are searching or not, base it upon the name field\n\t\tif (nameFilter) {\n\t\t\treturn { groups: RocketChat.models.Rooms.findByTypeAndNameContainingUsername('p', new RegExp(s.trim(s.escapeRegExp(nameFilter)), 'i'), Meteor.user().username, options).fetch() };\n\t\t} else {\n\t\t\tconst roomIds = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', Meteor.userId()).fetch(), 'rid');\n\t\t\treturn { groups: RocketChat.models.Rooms.findByIds(roomIds, options).fetch() };\n\t\t}\n\t}\n});\n","Meteor.methods({\n\thideRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'hideRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.hideByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","import _ from 'underscore';\n\nconst hideMessagesOfType = [];\n\nRocketChat.settings.get(/Message_HideType_.+/, function(key, value) {\n\tconst type = key.replace('Message_HideType_', '');\n\tconst types = type === 'mute_unmute' ? ['user-muted', 'user-unmuted'] : [type];\n\n\treturn types.forEach((type) => {\n\t\tconst index = hideMessagesOfType.indexOf(type);\n\n\t\tif (value === true && index === -1) {\n\t\t\treturn hideMessagesOfType.push(type);\n\t\t}\n\n\t\tif (index > -1) {\n\t\t\treturn hideMessagesOfType.splice(index, 1);\n\t\t}\n\t});\n});\n\nMeteor.methods({\n\tloadHistory(rid, end, limit = 20, ls) {\n\t\tthis.unblock();\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadHistory'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tconst room = Meteor.call('canAccessRoom', rid, fromId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst canAnonymous = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst canPreview = RocketChat.authz.hasPermission(fromId, 'preview-c-room');\n\t\tif (room.t === 'c' && !canAnonymous && !canPreview && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end != null) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestampNotContainingTypes(rid, end, hideMessagesOfType, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdNotContainingTypes(rid, hideMessagesOfType, options).fetch();\n\t\t}\n\n\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\tif (message.u && message.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(message.u._id);\n\t\t\t\tmessage.u.name = user && user.name;\n\t\t\t}\n\t\t\tif (message.mentions && message.mentions.length && UI_Use_Real_Name) {\n\t\t\t\tmessage.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn message;\n\t\t});\n\n\t\tlet unreadNotLoaded = 0;\n\t\tlet firstUnread;\n\n\t\tif (ls != null) {\n\t\t\tconst firstMessage = messages[messages.length - 1];\n\n\t\t\tif ((firstMessage != null ? firstMessage.ts : undefined) > ls) {\n\t\t\t\tdelete options.limit;\n\n\t\t\t\tconst unreadMessages = RocketChat.models.Messages.findVisibleByRoomIdBetweenTimestampsNotContainingTypes(rid, ls, firstMessage.ts, hideMessagesOfType, {\n\t\t\t\t\tlimit: 1,\n\t\t\t\t\tsort: {\n\t\t\t\t\t\tts: 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tfirstUnread = unreadMessages.fetch()[0];\n\t\t\t\tunreadNotLoaded = unreadMessages.count();\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tmessages,\n\t\t\tfirstUnread,\n\t\t\tunreadNotLoaded\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tloadLocale(locale) {\n\t\tcheck(locale, String);\n\n\t\ttry {\n\t\t\treturn Assets.getText(`moment-locales/${ locale.toLowerCase() }.js`);\n\t\t} catch (error) {\n\t\t\ttry {\n\t\t\t\treturn Assets.getText(`moment-locales/${ locale.split('-').shift().toLowerCase() }.js`);\n\t\t\t} catch (error) {\n\t\t\t\treturn console.log(error);\n\t\t\t}\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tloadMissedMessages(rid, start) {\n\t\tcheck(rid, String);\n\t\tcheck(start, Date);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadMissedMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\t'editedAt': 0\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, start, options).fetch();\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadNextMessages(rid, end, limit = 20) {\n\t\tcheck(rid, String);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadNextMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: 1\n\t\t\t},\n\t\t\tlimit\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tlet records;\n\t\tif (end) {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(rid, end, options).fetch();\n\t\t} else {\n\t\t\trecords = RocketChat.models.Messages.findVisibleByRoomId(rid, options).fetch();\n\t\t}\n\n\t\tconst messages = records.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\treturn {\n\t\t\tmessages\n\t\t};\n\t}\n});\n","import _ from 'underscore';\n\nMeteor.methods({\n\tloadSurroundingMessages(message, limit = 50) {\n\t\tcheck(message, Object);\n\t\tcheck(limit, Number);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'loadSurroundingMessages'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!message._id) {\n\t\t\treturn false;\n\t\t}\n\n\t\tmessage = RocketChat.models.Messages.findOneById(message._id);\n\n\t\tif (!message || !message.rid) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', message.rid, fromId)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlimit = limit - 1;\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: Math.ceil(limit / 2)\n\t\t};\n\n\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\toptions.fields = {\n\t\t\t\teditedAt: 0\n\t\t\t};\n\t\t}\n\n\t\tconst recordsBefore = RocketChat.models.Messages.findVisibleByRoomIdBeforeTimestamp(message.rid, message.ts, options).fetch();\n\n\t\tconst messages = recordsBefore.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreBefore = messages.length === options.limit;\n\n\t\tmessages.push(message);\n\n\t\toptions.sort = {\n\t\t\tts: 1\n\t\t};\n\n\t\toptions.limit = Math.floor(limit / 2);\n\n\t\tconst recordsAfter = RocketChat.models.Messages.findVisibleByRoomIdAfterTimestamp(message.rid, message.ts, options).fetch();\n\t\tconst afterMessages = recordsAfter.map((message) => {\n\t\t\tmessage.starred = _.findWhere(message.starred, {\n\t\t\t\t_id: fromId\n\t\t\t});\n\t\t\treturn message;\n\t\t});\n\n\t\tconst moreAfter = afterMessages.length === options.limit;\n\n\t\treturn {\n\t\t\tmessages: messages.concat(afterMessages),\n\t\t\tmoreBefore,\n\t\t\tmoreAfter\n\t\t};\n\t}\n});\n","Meteor.methods({\n\tlogoutCleanUp(user) {\n\t\tcheck(user, Object);\n\n\t\tMeteor.defer(function() {\n\t\t\tRocketChat.callbacks.run('afterLogoutCleanUp', user);\n\t\t});\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tmessageSearch(text, rid, limit) {\n\t\tcheck(text, String);\n\t\tcheck(rid, String);\n\t\tcheck(limit, Match.Optional(Number));\n\n\t\t// TODO: Evaluate why we are returning `users` and `channels`, as the only thing that gets set is the `messages`.\n\t\tconst result = {\n\t\t\tmessages: [],\n\t\t\tusers: [],\n\t\t\tchannels: []\n\t\t};\n\n\t\tconst currentUserId = Meteor.userId();\n\t\tif (!currentUserId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messageSearch'\n\t\t\t});\n\t\t}\n\n\t\t// Don't process anything else if the user can't access the room\n\t\tif (!Meteor.call('canAccessRoom', rid, currentUserId)) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst currentUserName = Meteor.user().username;\n\t\tconst currentUserTimezoneOffset = Meteor.user().utcOffset;\n\n\t\tconst query = {};\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t},\n\t\t\tlimit: limit || 20\n\t\t};\n\n\t\t// I would place these methods at the bottom of the file for clarity but travis doesn't appreciate that.\n\t\t// (no-use-before-define)\n\n\t\tfunction filterStarred() {\n\t\t\tquery['starred._id'] = currentUserId;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterUrl() {\n\t\t\tquery['urls.0'] = {\n\t\t\t\t$exists: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterPinned() {\n\t\t\tquery.pinned = true;\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLocation() {\n\t\t\tquery.location = {\n\t\t\t\t$exist: true\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterBeforeDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst beforeDate = new Date(year, month, day);\n\t\t\tbeforeDate.setHours(beforeDate.getUTCHours() + beforeDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tquery.ts = {\n\t\t\t\t$lte: beforeDate\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterAfterDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tday++;\n\t\t\tconst afterDate = new Date(year, month, day);\n\t\t\tafterDate.setUTCHours(afterDate.getUTCHours() + afterDate.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tif (query.ts) {\n\t\t\t\tquery.ts.$gte = afterDate;\n\t\t\t} else {\n\t\t\t\tquery.ts = {\n\t\t\t\t\t$gte: afterDate\n\t\t\t\t};\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterOnDate(_, day, month, year) {\n\t\t\tmonth--;\n\t\t\tconst date = new Date(year, month, day);\n\t\t\tdate.setUTCHours(date.getUTCHours() + date.getTimezoneOffset()/60 + currentUserTimezoneOffset);\n\t\t\tconst dayAfter = new Date(date);\n\t\t\tdayAfter.setDate(dayAfter.getDate() + 1);\n\t\t\tdelete query.ts;\n\t\t\tquery.ts = {\n\t\t\t\t$gte: date,\n\t\t\t\t$lt: dayAfter\n\t\t\t};\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction filterLabel(_, tag) {\n\t\t\tquery['attachments.0.labels'] = new RegExp(s.escapeRegExp(tag), 'i');\n\t\t\treturn '';\n\t\t}\n\n\t\tfunction sortByTimestamp(_, direction) {\n\t\t\tif (direction.startsWith('asc')) {\n\t\t\t\toptions.sort.ts = 1;\n\t\t\t} else if (direction.startsWith('desc')) {\n\t\t\t\toptions.sort.ts = -1;\n\t\t\t}\n\t\t\treturn '';\n\t\t}\n\n\t\t/*\n\t\t text = 'from:rodrigo mention:gabriel chat'\n\t\t */\n\n\t\t// Query for senders\n\t\tconst from = [];\n\t\ttext = text.replace(/from:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tif (username === 'me' && !from.includes(currentUserName)) {\n\t\t\t\tusername = currentUserName;\n\t\t\t}\n\t\t\tfrom.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (from.length > 0) {\n\t\t\tquery['u.username'] = {\n\t\t\t\t$regex: from.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\n\t\t// Query for senders\n\t\tconst mention = [];\n\t\ttext = text.replace(/mention:([a-z0-9.-_]+)/ig, function(match, username) {\n\t\t\tmention.push(username);\n\t\t\treturn '';\n\t\t});\n\n\t\tif (mention.length > 0) {\n\t\t\tquery['mentions.username'] = {\n\t\t\t\t$regex: mention.join('|'),\n\t\t\t\t$options: 'i'\n\t\t\t};\n\t\t}\n\n\t\t// Filter on messages that are starred by the current user.\n\t\ttext = text.replace(/has:star/g, filterStarred);\n\t\t// Filter on messages that have an url.\n\t\ttext = text.replace(/has:url|has:link/g, filterUrl);\n\t\t// Filter on pinned messages.\n\t\ttext = text.replace(/is:pinned|has:pin/g, filterPinned);\n\t\t// Filter on messages which have a location attached.\n\t\ttext = text.replace(/has:location|has:map/g, filterLocation);\n\t\t// Filter image tags\n\t\ttext = text.replace(/label:(\\w+)/g, filterLabel);\n\t\t// Filtering before/after/on a date\n\t\t// matches dd-MM-yyyy, dd/MM/yyyy, dd-MM-yyyy, prefixed by before:, after: and on: respectively.\n\t\t// Example: before:15/09/2016 after: 10-08-2016\n\t\t// if \"on:\" is set, \"before:\" and \"after:\" are ignored.\n\t\ttext = text.replace(/before:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterBeforeDate);\n\t\ttext = text.replace(/after:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterAfterDate);\n\t\ttext = text.replace(/on:(\\d{1,2})[\\/\\.-](\\d{1,2})[\\/\\.-](\\d{4})/g, filterOnDate);\n\t\t// Sort order\n\t\ttext = text.replace(/(?:order|sort):(asc|ascend|ascending|desc|descend|descending)/g, sortByTimestamp);\n\n\t\t// Query in message text\n\t\ttext = text.trim().replace(/\\s\\s/g, ' ');\n\t\tif (text !== '') {\n\t\t\tif (/^\\/.+\\/[imxs]*$/.test(text)) {\n\t\t\t\tconst r = text.split('/');\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: r[1],\n\t\t\t\t\t$options: r[2]\n\t\t\t\t};\n\t\t\t} else if (RocketChat.settings.get('Message_AlwaysSearchRegExp')) {\n\t\t\t\tquery.msg = {\n\t\t\t\t\t$regex: text,\n\t\t\t\t\t$options: 'i'\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tquery.$text = {\n\t\t\t\t\t$search: text\n\t\t\t\t};\n\t\t\t\toptions.fields = {\n\t\t\t\t\tscore: {\n\t\t\t\t\t\t$meta: 'textScore'\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(query).length > 0) {\n\t\t\tquery.t = {\n\t\t\t\t$ne: 'rm' //hide removed messages (useful when searching for user messages)\n\t\t\t};\n\t\t\tquery._hidden = {\n\t\t\t\t$ne: true // don't return _hidden messages\n\t\t\t};\n\t\t\tquery.rid = rid;\n\n\t\t\tif (!RocketChat.settings.get('Message_ShowEditedStatus')) {\n\t\t\t\toptions.fields = {\n\t\t\t\t\t'editedAt': 0\n\t\t\t\t};\n\t\t\t}\n\t\t\tresult.messages = RocketChat.models.Messages.find(query, options).fetch();\n\t\t}\n\n\t\treturn result;\n\t}\n});\n","Meteor.methods({\n\tmigrateTo(version) {\n\t\tcheck(version, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\tif (!user || RocketChat.authz.hasPermission(user._id, 'run-migration') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'migrateTo'\n\t\t\t});\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tRocketChat.Migrations.migrateTo(version);\n\n\t\treturn version;\n\t},\n\n\tgetMigrationVersion() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'getMigrationVersion'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.Migrations.getVersion();\n\t}\n});\n","Meteor.methods({\n\tmuteUserInRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'muteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'muteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst mutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.muteUsernameByRoomId(data.rid, mutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserMutedWithRoomIdAndUser(data.rid, mutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\topenRoom(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'openRoom'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.openByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\treadMessages(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'readMessages'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setAsReadByRoomIdAndUserId(rid, Meteor.userId());\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tregisterUser(formData) {\n\t\tconst AllowAnonymousRead = RocketChat.settings.get('Accounts_AllowAnonymousRead');\n\t\tconst AllowAnonymousWrite = RocketChat.settings.get('Accounts_AllowAnonymousWrite');\n\t\tif (AllowAnonymousRead === true && AllowAnonymousWrite === true && formData.email == null) {\n\t\t\tconst userId = Accounts.insertUserDoc({}, {\n\t\t\t\tglobalRoles: [\n\t\t\t\t\t'anonymous'\n\t\t\t\t]\n\t\t\t});\n\n\t\t\tconst { id, token } = Accounts._loginUser(this, userId);\n\n\t\t\treturn { id, token };\n\t\t} else {\n\t\t\tcheck(formData, Match.ObjectIncluding({\n\t\t\t\temail: String,\n\t\t\t\tpass: String,\n\t\t\t\tname: String,\n\t\t\t\tsecretURL: Match.Optional(String)\n\t\t\t}));\n\t\t}\n\n\t\tif (RocketChat.settings.get('Accounts_RegistrationForm') === 'Disabled') {\n\t\t\tthrow new Meteor.Error('error-user-registration-disabled', 'User registration is disabled', { method: 'registerUser' });\n\t\t} else if (RocketChat.settings.get('Accounts_RegistrationForm') === 'Secret URL' && (!formData.secretURL || formData.secretURL !== RocketChat.settings.get('Accounts_RegistrationForm_SecretURL'))) {\n\t\t\tthrow new Meteor.Error ('error-user-registration-secret', 'User registration is only allowed via Secret URL', { method: 'registerUser' });\n\t\t}\n\n\t\tRocketChat.validateEmailDomain(formData.email);\n\n\t\tconst userData = {\n\t\t\temail: s.trim(formData.email.toLowerCase()),\n\t\t\tpassword: formData.pass\n\t\t};\n\n\t\t// Check if user has already been imported and never logged in. If so, set password and let it through\n\t\tconst importedUser = RocketChat.models.Users.findOneByEmailAddress(s.trim(formData.email.toLowerCase()));\n\t\tlet userId;\n\t\tif (importedUser && importedUser.importIds && importedUser.importIds.length && !importedUser.lastLogin) {\n\t\t\tAccounts.setPassword(importedUser._id, userData.password);\n\t\t\tuserId = importedUser._id;\n\t\t} else {\n\t\t\tuserId = Accounts.createUser(userData);\n\t\t}\n\n\t\tRocketChat.models.Users.setName(userId, s.trim(formData.name));\n\n\t\tRocketChat.saveCustomFields(userId, formData);\n\n\t\ttry {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = () => subject;\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = (userModel, url) => html.replace(/\\[Verification_Url]/g, url);\n\t\t\t}\n\n\t\t\tAccounts.sendVerificationEmail(userId, userData.email);\n\t\t} catch (error) {\n\t\t\t// throw new Meteor.Error 'error-email-send-failed', 'Error trying to send email: ' + error.message, { method: 'registerUser', message: error.message }\n\t\t}\n\n\t\treturn userId;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomLeader(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-leader', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === true && subscription.roles.includes('leader') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-leader', 'User is not a leader', {\n\t\t\t\tmethod: 'removeRoomLeader'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'leader');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'leader'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'leader',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomModerator(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-moderator', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('moderator') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-moderator', 'User is not a moderator', {\n\t\t\t\tmethod: 'removeRoomModerator'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'moderator');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'moderator'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'moderator',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveRoomOwner(rid, userId) {\n\t\tcheck(rid, String);\n\t\tcheck(userId, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'set-owner', rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\t\tif (!user || !user.username) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(rid, user._id);\n\n\t\tif (!subscription) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(subscription.roles) === false || subscription.roles.includes('owner') === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-owner', 'User is not an owner', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', rid).count();\n\n\t\tif (numOwners === 1) {\n\t\t\tthrow new Meteor.Error('error-remove-last-owner', 'This is the last owner. Please set a new owner before removing this one.', {\n\t\t\t\tmethod: 'removeRoomOwner'\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Subscriptions.removeRoleById(subscription._id, 'owner');\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tRocketChat.models.Messages.createSubscriptionRoleRemovedWithRoomIdAndUser(rid, user, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t},\n\t\t\trole: 'owner'\n\t\t});\n\n\t\tif (RocketChat.settings.get('UI_DisplayRoles')) {\n\t\t\tRocketChat.Notifications.notifyLogged('roles-change', {\n\t\t\t\ttype: 'removed',\n\t\t\t\t_id: 'owner',\n\t\t\t\tu: {\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username,\n\t\t\t\t\tname: user.name\n\t\t\t\t},\n\t\t\t\tscope: rid\n\t\t\t});\n\t\t}\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tremoveUserFromRoom(data) {\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'remove-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room || room.t === 'd') {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst removedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tif (RocketChat.authz.hasRole(removedUser._id, 'owner', room._id)) {\n\t\t\tconst numOwners = RocketChat.authz.getUsersInRole('owner', room._id).fetch().length;\n\n\t\t\tif (numOwners === 1) {\n\t\t\t\tthrow new Meteor.Error('error-you-are-last-owner', 'You are the last owner. Please set new owner before leaving the room.', {\n\t\t\t\t\tmethod: 'removeUserFromRoom'\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tRocketChat.models.Rooms.removeUsernameById(data.rid, data.username);\n\n\t\tRocketChat.models.Subscriptions.removeByRoomIdAndUserId(data.rid, removedUser._id);\n\n\t\tif (['c', 'p'].includes(room.t) === true) {\n\t\t\tRocketChat.authz.removeUserFromRoles(removedUser._id, ['moderator', 'owner'], data.rid);\n\t\t}\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserRemovedWithRoomIdAndUser(data.rid, removedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\treportMessage(messageId, description) {\n\t\tcheck(messageId, String);\n\t\tcheck(description, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tif ((description == null) || description.trim() === '') {\n\t\t\tthrow new Meteor.Error('error-invalid-description', 'Invalid description', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOneById(messageId);\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message_id', 'Invalid message id', {\n\t\t\t\tmethod: 'reportMessage'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Reports.createWithMessageDescriptionAndUserId(message, description, Meteor.userId());\n\t}\n});\n","Meteor.methods({\n\tresetAvatar() {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'resetAvatar'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\t\tFileUpload.getStore('Avatars').deleteByName(user.username);\n\t\tRocketChat.models.Users.unsetAvatarOrigin(user._id);\n\t\tRocketChat.Notifications.notifyLogged('updateAvatar', {\n\t\t\tusername: user.username\n\t\t});\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'resetAvatar',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.methods({\n\troomNameExists(rid) {\n\t\tcheck(rid, String);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'roomExists'\n\t\t\t});\n\t\t}\n\t\tconst room = RocketChat.models.Rooms.findOneByName(rid);\n\t\treturn !!room;\n\t}\n});\n","Meteor.methods({\n\tsaveUserPreferences(settings) {\n\t\tcheck(settings, Object);\n\n\t\tif (Meteor.userId()) {\n\t\t\tconst preferences = {};\n\n\t\t\tif (settings.language != null) {\n\t\t\t\tRocketChat.models.Users.setLanguage(Meteor.userId(), settings.language);\n\t\t\t}\n\n\t\t\tif (settings.newRoomNotification) {\n\t\t\t\tpreferences.newRoomNotification = settings.newRoomNotification;\n\t\t\t}\n\n\t\t\tif (settings.newMessageNotification) {\n\t\t\t\tpreferences.newMessageNotification = settings.newMessageNotification;\n\t\t\t}\n\n\t\t\tif (settings.useEmojis) {\n\t\t\t\tpreferences.useEmojis = settings.useEmojis === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.convertAsciiEmoji) {\n\t\t\t\tpreferences.convertAsciiEmoji = settings.convertAsciiEmoji === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.saveMobileBandwidth) {\n\t\t\t\tpreferences.saveMobileBandwidth = settings.saveMobileBandwidth === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.collapseMediaByDefault) {\n\t\t\t\tpreferences.collapseMediaByDefault = settings.collapseMediaByDefault === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.autoImageLoad) {\n\t\t\t\tpreferences.autoImageLoad = settings.autoImageLoad === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.emailNotificationMode) {\n\t\t\t\tpreferences.emailNotificationMode = settings.emailNotificationMode;\n\t\t\t}\n\n\t\t\tif (settings.mergeChannels !== '-1') {\n\t\t\t\tpreferences.mergeChannels = settings.mergeChannels === '1';\n\t\t\t} else {\n\t\t\t\tdelete preferences.mergeChannels;\n\t\t\t}\n\n\t\t\tpreferences.roomsListExhibitionMode = ['category', 'unread', 'activity'].includes(settings.roomsListExhibitionMode) ? settings.roomsListExhibitionMode : 'category';\n\n\t\t\tif (settings.unreadAlert) {\n\t\t\t\tpreferences.unreadAlert = settings.unreadAlert === '1' ? true : false;\n\t\t\t}\n\n\t\t\tif (settings.notificationsSoundVolume) {\n\t\t\t\tpreferences.notificationsSoundVolume = settings.notificationsSoundVolume;\n\t\t\t}\n\n\t\t\tif (settings.audioNotifications) {\n\t\t\t\tpreferences.audioNotifications = settings.audioNotifications;\n\t\t\t}\n\n\t\t\tif (settings.desktopNotifications) {\n\t\t\t\tpreferences.desktopNotifications = settings.desktopNotifications;\n\t\t\t}\n\n\t\t\tif (settings.mobileNotifications) {\n\t\t\t\tpreferences.mobileNotifications = settings.mobileNotifications;\n\t\t\t}\n\t\t\tif (settings.idleTimeLimit) {\n\t\t\t\tpreferences.idleTimeLimit = settings.idleTimeLimit;\n\t\t\t}\n\n\t\t\tpreferences.enableAutoAway = settings.enableAutoAway === '1';\n\n\t\t\tif (settings.highlights) {\n\t\t\t\tpreferences.highlights = settings.highlights;\n\t\t\t}\n\n\t\t\tpreferences.desktopNotificationDuration = settings.desktopNotificationDuration - 0;\n\t\t\tpreferences.viewMode = settings.viewMode || 0;\n\t\t\tpreferences.hideUsernames = settings.hideUsernames === '1';\n\t\t\tpreferences.hideRoles = settings.hideRoles === '1';\n\t\t\tpreferences.hideAvatars = settings.hideAvatars === '1';\n\t\t\tpreferences.hideFlexTab = settings.hideFlexTab === '1';\n\t\t\tpreferences.sendOnEnter = settings.sendOnEnter;\n\t\t\tpreferences.roomCounterSidebar = settings.roomCounterSidebar === '1';\n\n\t\t\tRocketChat.models.Users.setPreferences(Meteor.userId(), preferences);\n\n\t\t\treturn true;\n\t\t}\n\t}\n});\n","Meteor.methods({\n\tsaveUserProfile(settings, customFields) {\n\t\tcheck(settings, Object);\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserProfileChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(Meteor.userId());\n\n\t\tfunction checkPassword(user = {}, typedPassword) {\n\t\t\tif (!(user.services && user.services.password && user.services.password.bcrypt && user.services.password.bcrypt.trim())) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst passCheck = Accounts._checkPassword(user, {\n\t\t\t\tdigest: typedPassword,\n\t\t\t\talgorithm: 'sha-256'\n\t\t\t});\n\n\t\t\tif (passCheck.error) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\treturn true;\n\t\t}\n\n\t\tif (settings.realname) {\n\t\t\tRocketChat.setRealName(Meteor.userId(), settings.realname);\n\t\t}\n\n\t\tif (settings.username) {\n\t\t\tMeteor.call('setUsername', settings.username);\n\t\t}\n\n\t\tif (settings.email) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tMeteor.call('setEmail', settings.email);\n\t\t}\n\n\t\t// Should be the last check to prevent error when trying to check password for users without password\n\t\tif ((settings.newPassword) && RocketChat.settings.get('Accounts_AllowPasswordChange') === true) {\n\t\t\tif (!checkPassword(user, settings.typedPassword)) {\n\t\t\t\tthrow new Meteor.Error('error-invalid-password', 'Invalid password', {\n\t\t\t\t\tmethod: 'saveUserProfile'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tAccounts.setPassword(Meteor.userId(), settings.newPassword, {\n\t\t\t\tlogout: false\n\t\t\t});\n\t\t}\n\n\t\tRocketChat.models.Users.setProfile(Meteor.userId(), {});\n\n\t\tRocketChat.saveCustomFields(Meteor.userId(), customFields);\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tsendConfirmationEmail(email) {\n\t\tcheck(email, String);\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tif (RocketChat.settings.get('Verification_Customized')) {\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email_Subject') || '');\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Verification_Email') || '');\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.verifyEmail.html = function(userModel, url) {\n\t\t\t\t\treturn html.replace(/\\[Verification_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendVerificationEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","import s from 'underscore.string';\n\nMeteor.methods({\n\tsendForgotPasswordEmail(email) {\n\t\tcheck(email, String);\n\n\t\temail = email.trim();\n\n\t\tconst user = RocketChat.models.Users.findOneByEmailAddress(email);\n\n\t\tif (user) {\n\t\t\tconst regex = new RegExp(`^${ s.escapeRegExp(email) }$`, 'i');\n\t\t\temail = (user.emails || []).map(item => item.address).find(userEmail => regex.test(userEmail));\n\n\t\t\tif (RocketChat.settings.get('Forgot_Password_Customized')) {\n\t\t\t\tconst data = { name: user.name, email };\n\t\t\t\tconst subject = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email_Subject') || '', data);\n\t\t\t\tconst html = RocketChat.placeholders.replace(RocketChat.settings.get('Forgot_Password_Email') || '', data);\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.subject = function(/*userModel*/) {\n\t\t\t\t\treturn subject;\n\t\t\t\t};\n\n\t\t\t\tAccounts.emailTemplates.resetPassword.html = function(userModel, url) {\n\t\t\t\t\turl = url.replace('/#/', '/');\n\t\t\t\t\treturn html.replace(/\\[Forgot_Password_Url]/g, url);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tAccounts.sendResetPasswordEmail(user._id, email);\n\t\t\t} catch (error) {\n\t\t\t\tthrow new Meteor.Error('error-email-send-failed', `Error trying to send email: ${ error.message }`, {\n\t\t\t\t\tmethod: 'registerUser',\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetAvatarFromService(dataURI, contentType, service) {\n\t\tcheck(dataURI, String);\n\t\tcheck(contentType, Match.Optional(String));\n\t\tcheck(service, Match.Optional(String));\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tif (!RocketChat.settings.get('Accounts_AllowUserAvatarChange')) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setAvatarFromService'\n\t\t\t});\n\t\t}\n\n\t\tconst user = Meteor.user();\n\n\t\treturn RocketChat.setUserAvatar(user, dataURI, contentType, service);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'setAvatarFromService',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 5000);\n","Meteor.methods({\n\tsetUserActiveStatus(userId, active) {\n\t\tcheck(userId, String);\n\t\tcheck(active, Boolean);\n\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(Meteor.userId(), 'edit-other-user-active-status') !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserActiveStatus'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user) {\n\t\t\tRocketChat.models.Users.setUserActive(userId, active);\n\n\t\t\tif (user.username) {\n\t\t\t\tRocketChat.models.Subscriptions.setArchivedByUsername(user.username, !active);\n\t\t\t}\n\n\t\t\tif (active === false) {\n\t\t\t\tRocketChat.models.Users.unsetLoginTokens(userId);\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n});\n","Meteor.methods({\n\tsetUserPassword(password) {\n\t\tcheck(password, String);\n\n\t\tconst userId = Meteor.userId();\n\n\t\tif (!userId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tconst user = RocketChat.models.Users.findOneById(userId);\n\n\t\tif (user && user.requirePasswordChange !== true) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'setUserPassword'\n\t\t\t});\n\t\t}\n\n\t\tAccounts.setPassword(userId, password, {\n\t\t\tlogout: false\n\t\t});\n\n\t\treturn RocketChat.models.Users.unsetRequirePasswordChange(userId);\n\t}\n});\n","Meteor.methods({\n\ttoggleFavorite(rid, f) {\n\t\tcheck(rid, String);\n\n\t\tcheck(f, Match.Optional(Boolean));\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'toggleFavorite'\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.models.Subscriptions.setFavoriteByRoomIdAndUserId(rid, Meteor.userId(), f);\n\t}\n});\n","Meteor.methods({\n\tunmuteUserInRoom(data) {\n\t\tconst fromId = Meteor.userId();\n\n\t\tcheck(data, Match.ObjectIncluding({\n\t\t\trid: String,\n\t\t\tusername: String\n\t\t}));\n\n\t\tif (!RocketChat.authz.hasPermission(fromId, 'mute-user', data.rid)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(data.rid);\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tif (['c', 'p'].includes(room.t) === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-room-type', `${ room.t } is not a valid room type`, {\n\t\t\t\tmethod: 'unmuteUserInRoom',\n\t\t\t\ttype: room.t\n\t\t\t});\n\t\t}\n\n\t\tif (Array.isArray(room.usernames) === false || room.usernames.includes(data.username) === false) {\n\t\t\tthrow new Meteor.Error('error-user-not-in-room', 'User is not in this room', {\n\t\t\t\tmethod: 'unmuteUserInRoom'\n\t\t\t});\n\t\t}\n\n\t\tconst unmutedUser = RocketChat.models.Users.findOneByUsername(data.username);\n\n\t\tRocketChat.models.Rooms.unmuteUsernameByRoomId(data.rid, unmutedUser.username);\n\n\t\tconst fromUser = RocketChat.models.Users.findOneById(fromId);\n\n\t\tRocketChat.models.Messages.createUserUnmutedWithRoomIdAndUser(data.rid, unmutedUser, {\n\t\t\tu: {\n\t\t\t\t_id: fromUser._id,\n\t\t\t\tusername: fromUser.username\n\t\t\t}\n\t\t});\n\n\t\treturn true;\n\t}\n});\n","Meteor.methods({\n\tuserSetUtcOffset(utcOffset) {\n\t\tcheck(utcOffset, Number);\n\n\t\tif (this.userId == null) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.unblock();\n\n\t\treturn RocketChat.models.Users.setUtcOffset(this.userId, utcOffset);\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'userSetUtcOffset',\n\tuserId() {\n\t\treturn true;\n\t}\n}, 1, 60000);\n","Meteor.publish('activeUsers', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.findUsersNotOffline({\n\t\tfields: {\n\t\t\tusername: 1,\n\t\t\tname: 1,\n\t\t\tstatus: 1,\n\t\t\tutcOffset: 1\n\t\t}\n\t});\n});\n","Meteor.publish('channelAndPrivateAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\tconst options = {\n\t\tfields: {\n\t\t\t_id: 1,\n\t\t\tname: 1\n\t\t},\n\t\tlimit: 10,\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t};\n\n\tconst cursorHandle = RocketChat.models.Rooms.findByNameStartingAndTypes(selector.name, ['c', 'p'], options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('fullUserData', function(filter, limit) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst result = RocketChat.getFullUserData({\n\t\tuserId: this.userId,\n\t\tfilter,\n\t\tlimit\n\t});\n\n\tif (!result) {\n\t\treturn this.ready();\n\t}\n\n\treturn result;\n});\n","import _ from 'underscore';\n\nMeteor.publish('messages', function(rid/*, start*/) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst publication = this;\n\n\tif (typeof rid !== 'string') {\n\t\treturn this.ready();\n\t}\n\n\tif (!Meteor.call('canAccessRoom', rid, this.userId)) {\n\t\treturn this.ready();\n\t}\n\n\tconst cursor = RocketChat.models.Messages.findVisibleByRoomId(rid, {\n\t\tsort: {\n\t\t\tts: -1\n\t\t},\n\t\tlimit: 50\n\t});\n\n\tconst cursorHandle = cursor.observeChanges({\n\t\tadded(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.added('rocketchat_message', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\trecord.starred = _.findWhere(record.starred, {\n\t\t\t\t_id: publication.userId\n\t\t\t});\n\t\t\treturn publication.changed('rocketchat_message', _id, record);\n\t\t}\n\t});\n\n\tconst cursorDelete = RocketChat.models.Messages.findInvisibleByRoomId(rid, {\n\t\tfields: {\n\t\t\t_id: 1\n\t\t}\n\t});\n\n\tconst cursorDeleteHandle = cursorDelete.observeChanges({\n\t\tadded(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t},\n\t\tchanged(_id/*, record*/) {\n\t\t\treturn publication.added('rocketchat_message', _id, {\n\t\t\t\t_hidden: true\n\t\t\t});\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\tcursorHandle.stop();\n\t\treturn cursorDeleteHandle.stop();\n\t});\n});\n\nMeteor.methods({\n\t'messages/get'(rid, {lastUpdate, latestDate = new Date(), oldestDate, inclusive = false, count = 20, unreads= false}) {\n\t\tcheck(rid, String);\n\n\t\tconst fromId = Meteor.userId();\n\n\t\tif (!fromId) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', {\n\t\t\t\tmethod: 'messages/get'\n\t\t\t});\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', rid, fromId)) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', {\n\t\t\t\tmethod: 'messages/get'\n\t\t\t});\n\t\t}\n\n\t\tconst options = {\n\t\t\tsort: {\n\t\t\t\tts: -1\n\t\t\t}\n\t\t};\n\n\t\tif (lastUpdate instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdated: RocketChat.models.Messages.findForUpdates(rid, lastUpdate, options).fetch(),\n\t\t\t\tdeleted: RocketChat.models.Messages.trashFindDeletedAfter(lastUpdate, {rid}, { ...options, fields: { _id: 1, _deletedAt: 1 }}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn Meteor.call('getChannelHistory', { rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\n\t}\n});\n","Meteor.publish('privateHistory', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Rooms.findByContainingUsername(RocketChat.models.Users.findOneById(this.userId).username, {\n\t\tfields: {\n\t\t\tt: 1,\n\t\t\tname: 1,\n\t\t\tmsgs: 1,\n\t\t\tts: 1,\n\t\t\tlm: 1,\n\t\t\tcl: 1\n\t\t}\n\t});\n});\n","import _ from 'underscore';\n\nconst fields = {\n\t_id: 1,\n\tname: 1,\n\tfname: 1,\n\tt: 1,\n\tcl: 1,\n\tu: 1,\n\t// usernames: 1,\n\ttopic: 1,\n\tannouncement: 1,\n\tmuted: 1,\n\t_updatedAt: 1,\n\tarchived: 1,\n\tjitsiTimeout: 1,\n\tdescription: 1,\n\tdefault: 1,\n\tcustomFields: 1,\n\tlastMessage: 1,\n\n\t// @TODO create an API to register this fields based on room type\n\tlivechatData: 1,\n\ttags: 1,\n\tsms: 1,\n\tfacebook: 1,\n\tcode: 1,\n\tjoinCodeRequired: 1,\n\topen: 1,\n\tv: 1,\n\tlabel: 1,\n\tro: 1,\n\treactWhenReadOnly: 1,\n\tsentiment: 1,\n\ttokenpass: 1\n};\n\nconst roomMap = (record) => {\n\tif (record._room) {\n\t\treturn _.pick(record._room, ...Object.keys(fields));\n\t}\n\tconsole.log('Empty Room for Subscription', record);\n\treturn {};\n};\n\nMeteor.methods({\n\t'rooms/get'(updatedAt) {\n\t\tlet options = {fields};\n\n\t\tif (!Meteor.userId()) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\treturn RocketChat.models.Rooms.findByDefaultAndTypes(true, ['c'], options).fetch();\n\t\t\t}\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\toptions = {\n\t\t\tfields\n\t\t};\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: RocketChat.models.Rooms.findBySubscriptionUserIdUpdatedAfter(Meteor.userId(), updatedAt, options).fetch(),\n\t\t\t\tremove: RocketChat.models.Rooms.trashFindDeletedAfter(updatedAt, {}, {fields: {_id: 1, _deletedAt: 1}}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.models.Rooms.findBySubscriptionUserId(Meteor.userId(), options).fetch();\n\t},\n\n\tgetRoomByTypeAndName(type, name) {\n\t\tif (!Meteor.userId() && RocketChat.settings.get('Accounts_AllowAnonymousRead') === false) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tconst roomFind = RocketChat.roomTypes.getRoomFind(type);\n\n\t\tlet room;\n\n\t\tif (roomFind) {\n\t\t\troom = roomFind.call(this, name);\n\t\t} else {\n\t\t\troom = RocketChat.models.Rooms.findByTypeAndName(type, name).fetch();\n\t\t}\n\n\t\tif (!room) {\n\t\t\tthrow new Meteor.Error('error-invalid-room', 'Invalid room', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (!Meteor.call('canAccessRoom', room._id, Meteor.userId())) {\n\t\t\tthrow new Meteor.Error('error-no-permission', 'No permission', { method: 'getRoomByTypeAndName' });\n\t\t}\n\n\t\tif (RocketChat.settings.get('Store_Last_Message') && !RocketChat.authz.hasPermission(Meteor.userId(), 'preview-c-room')) {\n\t\t\tdelete room.lastMessage;\n\t\t}\n\n\t\treturn roomMap({ _room: room });\n\t}\n});\n\nRocketChat.models.Rooms.cache.on('sync', (type, room/*, diff*/) => {\n\tconst records = RocketChat.models.Subscriptions.findByRoomId(room._id).fetch();\n\n\tconst _room = roomMap({_room: room});\n\tfor (const record of records) {\n\t\tRocketChat.Notifications.notifyUserInThisInstance(record.u._id, 'rooms-changed', type, _room);\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', (type, subscription/*, diff*/) => {\n\tif (type === 'inserted' || type === 'removed') {\n\t\tconst room = RocketChat.models.Rooms.findOneById(subscription.rid);\n\t\tif (room) {\n\t\t\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'rooms-changed', type, roomMap({_room: room}));\n\t\t}\n\t}\n});\n","Meteor.publish('roomFiles', function(rid, limit = 50) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tconst pub = this;\n\n\tconst cursorFileListHandle = RocketChat.models.Uploads.findNotHiddenFilesOfRoom(rid, limit).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('room_files', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('room_files', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('room_files', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\treturn this.onStop(function() {\n\t\treturn cursorFileListHandle.stop();\n\t});\n});\n","Meteor.publish('roomSubscriptionsByRole', function(rid, role) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByRoomIdAndRoles(rid, role, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\troles: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","import s from 'underscore.string';\n\nfunction fetchRooms(userId, rooms) {\n\tif (!RocketChat.settings.get('Store_Last_Message') || RocketChat.authz.hasPermission(userId, 'preview-c-room')) {\n\t\treturn rooms;\n\t}\n\n\treturn rooms.map(room => {\n\t\tdelete room.lastMessage;\n\t\treturn room;\n\t});\n}\n\nMeteor.methods({\n\tspotlight(text, usernames, type = {users: true, rooms: true}, rid) {\n\t\tconst regex = new RegExp(s.trim(s.escapeRegExp(text)), 'i');\n\t\tconst result = {\n\t\t\tusers: [],\n\t\t\trooms: []\n\t\t};\n\t\tconst roomOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tt: 1,\n\t\t\t\tname: 1,\n\t\t\t\tlastMessage: 1\n\t\t\t},\n\t\t\tsort: {\n\t\t\t\tname: 1\n\t\t\t}\n\t\t};\n\t\tconst userId = this.userId;\n\t\tif (userId == null) {\n\t\t\tif (RocketChat.settings.get('Accounts_AllowAnonymousRead') === true) {\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypeNotDefault(regex, 'c', roomOptions).fetch());\n\t\t\t}\n\t\t\treturn result;\n\t\t}\n\t\tconst userOptions = {\n\t\t\tlimit: 5,\n\t\t\tfields: {\n\t\t\t\tusername: 1,\n\t\t\t\tname: 1,\n\t\t\t\tstatus: 1\n\t\t\t},\n\t\t\tsort: {}\n\t\t};\n\t\tif (RocketChat.settings.get('UI_Use_Real_Name')) {\n\t\t\tuserOptions.sort.name = 1;\n\t\t} else {\n\t\t\tuserOptions.sort.username = 1;\n\t\t}\n\n\t\tif (RocketChat.authz.hasPermission(userId, 'view-outside-room')) {\n\t\t\tif (type.users === true && RocketChat.authz.hasPermission(userId, 'view-d-room')) {\n\t\t\t\tresult.users = RocketChat.models.Users.findByActiveUsersExcept(text, usernames, userOptions).fetch();\n\t\t\t}\n\n\t\t\tif (type.rooms === true && RocketChat.authz.hasPermission(userId, 'view-c-room')) {\n\t\t\t\tconst username = RocketChat.models.Users.findOneById(userId, {\n\t\t\t\t\tusername: 1\n\t\t\t\t}).username;\n\n\t\t\t\tconst searchableRoomTypes = Object.entries(RocketChat.roomTypes.roomTypes)\n\t\t\t\t\t.filter((roomType)=>roomType[1].includeInRoomSearch())\n\t\t\t\t\t.map((roomType)=>roomType[0]);\n\n\t\t\t\tresult.rooms = fetchRooms(userId, RocketChat.models.Rooms.findByNameAndTypesNotContainingUsername(regex, searchableRoomTypes, username, roomOptions).fetch());\n\t\t\t}\n\t\t} else if (type.users === true && rid) {\n\t\t\tconst subscriptions = RocketChat.models.Subscriptions.find({\n\t\t\t\trid, 'u.username': {\n\t\t\t\t\t$regex: regex,\n\t\t\t\t\t$nin: [...usernames, Meteor.user().username]\n\t\t\t\t}\n\t\t\t}, {limit: userOptions.limit}).fetch().map(({u}) => u._id);\n\t\t\tresult.users = RocketChat.models.Users.find({_id: {$in: subscriptions}}, {\n\t\t\t\tfields: userOptions.fields,\n\t\t\t\tsort: userOptions.sort\n\t\t\t}).fetch();\n\t\t}\n\n\t\treturn result;\n\t}\n});\n\nDDPRateLimiter.addRule({\n\ttype: 'method',\n\tname: 'spotlight',\n\tuserId(/*userId*/) {\n\t\treturn true;\n\t}\n}, 100, 100000);\n","const fields = {\n\tt: 1,\n\tts: 1,\n\tls: 1,\n\tname: 1,\n\tfname: 1,\n\trid: 1,\n\tcode: 1,\n\tf: 1,\n\tu: 1,\n\topen: 1,\n\talert: 1,\n\troles: 1,\n\tunread: 1,\n\tuserMentions: 1,\n\tgroupMentions: 1,\n\tarchived: 1,\n\taudioNotifications: 1,\n\taudioNotificationValue: 1,\n\tdesktopNotifications: 1,\n\tdesktopNotificationDuration: 1,\n\tmobilePushNotifications: 1,\n\temailNotifications: 1,\n\tunreadAlert: 1,\n\t_updatedAt: 1,\n\tblocked: 1,\n\tblocker: 1,\n\tautoTranslate: 1,\n\tautoTranslateLanguage: 1,\n\tdisableNotifications: 1,\n\thideUnreadStatus: 1\n};\n\nMeteor.methods({\n\t'subscriptions/get'(updatedAt) {\n\t\tif (!Meteor.userId()) {\n\t\t\treturn [];\n\t\t}\n\n\t\tthis.unblock();\n\n\t\tconst options = { fields };\n\n\t\tconst records = RocketChat.models.Subscriptions.findByUserId(Meteor.userId(), options).fetch();\n\n\t\tif (updatedAt instanceof Date) {\n\t\t\treturn {\n\t\t\t\tupdate: records.filter(function(record) {\n\t\t\t\t\treturn record._updatedAt > updatedAt;\n\t\t\t\t}),\n\t\t\t\tremove: RocketChat.models.Subscriptions.trashFindDeletedAfter(updatedAt, {\n\t\t\t\t\t'u._id': Meteor.userId()\n\t\t\t\t}, {\n\t\t\t\t\tfields: {\n\t\t\t\t\t\t_id: 1,\n\t\t\t\t\t\t_deletedAt: 1\n\t\t\t\t\t}\n\t\t\t\t}).fetch()\n\t\t\t};\n\t\t}\n\n\t\treturn records;\n\t}\n});\n\nRocketChat.models.Subscriptions.on('changed', function(type, subscription) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', type, RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n\n// TODO needs improvement\n// We are sending the record again cuz any update on subscription will send the record without the fname (join)\n// Then we need to sent it again listening to the join event.\nRocketChat.models.Subscriptions.on('join:fname:inserted', function(subscription/*, user*/) {\n\tRocketChat.Notifications.notifyUserInThisInstance(subscription.u._id, 'subscriptions-changed', 'changed', RocketChat.models.Subscriptions.processQueryOptionsOnResult(subscription, {\n\t\tfields\n\t}));\n});\n","import _ from 'underscore';\n\nMeteor.publish('userAutocomplete', function(selector) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (!_.isObject(selector)) {\n\t\treturn this.ready();\n\t}\n\n\tconst options = {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1\n\t\t},\n\t\tsort: {\n\t\t\tusername: 1\n\t\t},\n\t\tlimit: 10\n\t};\n\n\tconst pub = this;\n\tconst exceptions = selector.exceptions || [];\n\n\tconst cursorHandle = RocketChat.models.Users.findActiveByUsernameOrNameRegexWithExceptions(selector.term, exceptions, options).observeChanges({\n\t\tadded(_id, record) {\n\t\t\treturn pub.added('autocompleteRecords', _id, record);\n\t\t},\n\t\tchanged(_id, record) {\n\t\t\treturn pub.changed('autocompleteRecords', _id, record);\n\t\t},\n\t\tremoved(_id, record) {\n\t\t\treturn pub.removed('autocompleteRecords', _id, record);\n\t\t}\n\t});\n\n\tthis.ready();\n\n\tthis.onStop(function() {\n\t\treturn cursorHandle.stop();\n\t});\n});\n","Meteor.publish('userChannels', function(userId) {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\tif (RocketChat.authz.hasPermission(this.userId, 'view-other-user-channels') !== true) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Subscriptions.findByUserId(userId, {\n\t\tfields: {\n\t\t\trid: 1,\n\t\t\tname: 1,\n\t\t\tt: 1,\n\t\t\tu: 1\n\t\t},\n\t\tsort: {\n\t\t\tt: 1,\n\t\t\tname: 1\n\t\t}\n\t});\n});\n","Meteor.publish('userData', function() {\n\tif (!this.userId) {\n\t\treturn this.ready();\n\t}\n\n\treturn RocketChat.models.Users.find(this.userId, {\n\t\tfields: {\n\t\t\tname: 1,\n\t\t\tusername: 1,\n\t\t\tstatus: 1,\n\t\t\tstatusDefault: 1,\n\t\t\tstatusConnection: 1,\n\t\t\tavatarOrigin: 1,\n\t\t\tutcOffset: 1,\n\t\t\tlanguage: 1,\n\t\t\tsettings: 1,\n\t\t\tenableAutoAway: 1,\n\t\t\tidleTimeLimit: 1,\n\t\t\troles: 1,\n\t\t\tactive: 1,\n\t\t\tdefaultRoom: 1,\n\t\t\tcustomFields: 1,\n\t\t\t'services.github': 1,\n\t\t\t'services.gitlab': 1,\n\t\t\t'services.tokenpass': 1,\n\t\t\trequirePasswordChange: 1,\n\t\t\trequirePasswordChangeReason: 1,\n\t\t\t'services.password.bcrypt': 1,\n\t\t\t'services.totp.enabled': 1,\n\t\t\tstatusLivechat: 1\n\t\t}\n\t});\n});\n","const msgStream = new Meteor.Streamer('room-messages');\nthis.msgStream = msgStream;\n\nmsgStream.allowWrite('none');\n\nmsgStream.allowRead(function(eventName) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', eventName, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (room.t === 'c' && !RocketChat.authz.hasPermission(this.userId, 'preview-c-room') && room.usernames.indexOf(room.username) === -1) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nmsgStream.allowRead('__my_messages__', 'all');\n\nmsgStream.allowEmit('__my_messages__', function(eventName, msg, options) {\n\ttry {\n\t\tconst room = Meteor.call('canAccessRoom', msg.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn false;\n\t\t}\n\n\t\toptions.roomParticipant = room.usernames.indexOf(room.username) > -1;\n\t\toptions.roomType = room.t;\n\n\t\treturn true;\n\t} catch (error) {\n\t\t/*error*/\n\t\treturn false;\n\t}\n});\n\nMeteor.startup(function() {\n\tfunction publishMessage(type, record) {\n\t\tif (record._hidden !== true && (record.imported == null)) {\n\t\t\tconst UI_Use_Real_Name = RocketChat.settings.get('UI_Use_Real_Name') === true;\n\n\t\t\tif (record.u && record.u._id && UI_Use_Real_Name) {\n\t\t\t\tconst user = RocketChat.models.Users.findOneById(record.u._id);\n\t\t\t\trecord.u.name = user && user.name;\n\t\t\t}\n\n\t\t\tif (record.mentions && record.mentions.length && UI_Use_Real_Name) {\n\t\t\t\trecord.mentions.forEach((mention) => {\n\t\t\t\t\tconst user = RocketChat.models.Users.findOneById(mention._id);\n\t\t\t\t\tmention.name = user && user.name;\n\t\t\t\t});\n\t\t\t}\n\t\t\tmsgStream.emitWithoutBroadcast('__my_messages__', record, {});\n\t\t\treturn msgStream.emitWithoutBroadcast(record.rid, record);\n\t\t}\n\t}\n\n\treturn RocketChat.models.Messages._db.on('change', function({action, id, data/*, oplog*/}) {\n\t\tswitch (action) {\n\t\t\tcase 'insert':\n\t\t\t\tdata._id = id;\n\t\t\t\tpublishMessage('inserted', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:record':\n\t\t\t\tpublishMessage('updated', data);\n\t\t\t\tbreak;\n\t\t\tcase 'update:diff':\n\t\t\t\tpublishMessage('updated', RocketChat.models.Messages.findOne({\n\t\t\t\t\t_id: id\n\t\t\t\t}));\n\t\t\t\tbreak;\n\t\t}\n\t});\n});\n","/* global InstanceStatus, DDP, LoggerManager */\n\nimport _ from 'underscore';\nimport {DDPCommon} from 'meteor/ddp-common';\n\nprocess.env.PORT = String(process.env.PORT).trim();\nprocess.env.INSTANCE_IP = String(process.env.INSTANCE_IP).trim();\n\nconst connections = {};\nthis.connections = connections;\n\nconst logger = new Logger('StreamBroadcast', {\n\tsections: {\n\t\tconnection: 'Connection',\n\t\tauth: 'Auth',\n\t\tstream: 'Stream'\n\t}\n});\n\nfunction _authorizeConnection(instance) {\n\tlogger.auth.info(`Authorizing with ${ instance }`);\n\n\treturn connections[instance].call('broadcastAuth', InstanceStatus.id(), connections[instance].instanceId, function(err, ok) {\n\t\tif (err != null) {\n\t\t\treturn logger.auth.error(`broadcastAuth error ${ instance } ${ InstanceStatus.id() } ${ connections[instance].instanceId }`, err);\n\t\t}\n\n\t\tconnections[instance].broadcastAuth = ok;\n\t\treturn logger.auth.info(`broadcastAuth with ${ instance }`, ok);\n\t});\n}\n\nfunction authorizeConnection(instance) {\n\tconst query = {\n\t\t_id: InstanceStatus.id()\n\t};\n\n\tif (!InstanceStatus.getCollection().findOne(query)) {\n\t\treturn Meteor.setTimeout(function() {\n\t\t\treturn authorizeConnection(instance);\n\t\t}, 500);\n\t}\n\n\treturn _authorizeConnection(instance);\n}\n\nfunction startMatrixBroadcast() {\n\tconst query = {\n\t\t'extraInformation.port': {\n\t\t\t$exists: true\n\t\t}\n\t};\n\n\tconst options = {\n\t\tsort: {\n\t\t\t_createdAt: -1\n\t\t}\n\t};\n\n\treturn InstanceStatus.getCollection().find(query, options).observe({\n\t\tadded(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.port === process.env.PORT && record.extraInformation.host === process.env.INSTANCE_IP) {\n\t\t\t\tlogger.auth.info('prevent self connect', instance);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tif (connections[instance] && connections[instance].instanceRecord) {\n\t\t\t\tif (connections[instance].instanceRecord._createdAt < record._createdAt) {\n\t\t\t\t\tconnections[instance].disconnect();\n\t\t\t\t\tdelete connections[instance];\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlogger.connection.info('connecting in', instance);\n\n\t\t\tconnections[instance] = DDP.connect(instance, {\n\t\t\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t\t\t});\n\n\t\t\tconnections[instance].instanceRecord = record;\n\t\t\tconnections[instance].instanceId = record._id;\n\n\t\t\treturn connections[instance].onReconnect = function() {\n\t\t\t\treturn authorizeConnection(instance);\n\t\t\t};\n\t\t},\n\n\t\tremoved(record) {\n\t\t\tlet instance = `${ record.extraInformation.host }:${ record.extraInformation.port }`;\n\n\t\t\tif (record.extraInformation.host === process.env.INSTANCE_IP && RocketChat.isDocker() === false) {\n\t\t\t\tinstance = `localhost:${ record.extraInformation.port }`;\n\t\t\t}\n\n\t\t\tconst query = {\n\t\t\t\t'extraInformation.host': record.extraInformation.host,\n\t\t\t\t'extraInformation.port': record.extraInformation.port\n\t\t\t};\n\n\t\t\tif (connections[instance] && !InstanceStatus.getCollection().findOne(query)) {\n\t\t\t\tlogger.connection.info('disconnecting from', instance);\n\t\t\t\tconnections[instance].disconnect();\n\t\t\t\treturn delete connections[instance];\n\t\t\t}\n\t\t}\n\t});\n}\n\nMeteor.methods({\n\tbroadcastAuth(remoteId, selfId) {\n\t\tcheck(selfId, String);\n\t\tcheck(remoteId, String);\n\n\t\tthis.unblock();\n\n\t\tconst query = {\n\t\t\t_id: remoteId\n\t\t};\n\n\t\tif (selfId === InstanceStatus.id() && remoteId !== InstanceStatus.id() && (InstanceStatus.getCollection().findOne(query))) {\n\t\t\tthis.connection.broadcastAuth = true;\n\t\t}\n\n\t\treturn this.connection.broadcastAuth === true;\n\t},\n\n\tstream(streamName, eventName, args) {\n\t\tif (!this.connection) {\n\t\t\treturn 'self-not-authorized';\n\t\t}\n\n\t\tif (this.connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\tMeteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t}\n});\n\nfunction startStreamCastBroadcast(value) {\n\tconst instance = 'StreamCast';\n\n\tlogger.connection.info('connecting in', instance, value);\n\n\tconst connection = DDP.connect(value, {\n\t\t_dontPrintErrors: LoggerManager.logLevel < 2\n\t});\n\n\tconnections[instance] = connection;\n\tconnection.instanceId = instance;\n\tconnection.onReconnect = function() {\n\t\treturn authorizeConnection(instance);\n\t};\n\n\tconnection._stream.on('message', function(raw_msg) {\n\t\tconst msg = DDPCommon.parseDDP(raw_msg);\n\t\tif (!msg || msg.msg !== 'changed' || !msg.collection || !msg.fields) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst {streamName, eventName, args} = msg.fields;\n\n\t\tif (!streamName || !eventName || !args) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (connection.broadcastAuth !== true) {\n\t\t\treturn 'not-authorized';\n\t\t}\n\n\t\tif (!Meteor.StreamerCentral.instances[streamName]) {\n\t\t\treturn 'stream-not-exists';\n\t\t}\n\n\t\treturn Meteor.StreamerCentral.instances[streamName]._emit(eventName, args);\n\t});\n\n\treturn connection.subscribe('stream');\n}\n\nfunction startStreamBroadcast() {\n\tif (!process.env.INSTANCE_IP) {\n\t\tprocess.env.INSTANCE_IP = 'localhost';\n\t}\n\n\tlogger.info('startStreamBroadcast');\n\n\tRocketChat.settings.get('Stream_Cast_Address', function(key, value) {\n\t\t// var connection, fn, instance;\n\t\tconst fn = function(instance, connection) {\n\t\t\tconnection.disconnect();\n\t\t\treturn delete connections[instance];\n\t\t};\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\t\t\tfn(instance, connection);\n\t\t}\n\n\t\tif (value && value.trim() !== '') {\n\t\t\treturn startStreamCastBroadcast(value);\n\t\t} else {\n\t\t\treturn startMatrixBroadcast();\n\t\t}\n\t});\n\n\tfunction broadcast(streamName, eventName, args/*, userId*/) {\n\t\tconst fromInstance = `${ process.env.INSTANCE_IP }:${ process.env.PORT }`;\n\t\tconst results = [];\n\n\t\tfor (const instance of Object.keys(connections)) {\n\t\t\tconst connection = connections[instance];\n\n\t\t\tif (connection.status().connected === true) {\n\t\t\t\tconnection.call('stream', streamName, eventName, args, function(error, response) {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tlogger.error('Stream broadcast error', error);\n\t\t\t\t\t}\n\n\t\t\t\t\tswitch (response) {\n\t\t\t\t\t\tcase 'self-not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } to self is not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\tcase 'not-authorized':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } not authorized`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\tlogger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t\t\treturn authorizeConnection(instance);\n\t\t\t\t\t\tcase 'stream-not-exists':\n\t\t\t\t\t\t\tlogger.stream.error((`Stream broadcast from '${ fromInstance }' to '${ connection._stream.endpoint }' with name ${ streamName } does not exist`).red);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection authorized'.red, connection.broadcastAuth);\n\t\t\t\t\t\t\tlogger.stream.debug('    -> connection status'.red, connection.status());\n\t\t\t\t\t\t\treturn logger.stream.debug('    -> arguments'.red, eventName, args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn results;\n\t}\n\n\treturn Meteor.StreamerCentral.on('broadcast', function(streamName, eventName, args) {\n\t\treturn broadcast(streamName, eventName, args);\n\t});\n}\n\nMeteor.startup(function() {\n\treturn startStreamBroadcast();\n});\n\nMeteor.methods({\n\t'instances/get'() {\n\t\tif (!RocketChat.authz.hasPermission(Meteor.userId(), 'view-statistics')) {\n\t\t\tthrow new Meteor.Error('error-action-not-allowed', 'List instances is not allowed', {\n\t\t\t\tmethod: 'instances/get'\n\t\t\t});\n\t\t}\n\n\t\treturn Object.keys(connections).map(address => {\n\t\t\tconst conn = connections[address];\n\t\t\treturn Object.assign({ address, currentStatus: conn._stream.currentStatus }, _.pick(conn, 'instanceRecord', 'broadcastAuth'));\n\t\t});\n\t}\n});\n","RegExp.escape = function(s) {\n\treturn s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n};\n","this.i18n_status_func = function(key, options) {\n\treturn TAPi18n.__(key, options);\n};\n"]}