{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:streamer/lib/ev.js","meteor://ðŸ’»app/packages/rocketchat:streamer/server/server.js"],"names":["EV","constructor","handlers","emit","event","args","forEach","handler","apply","emitWithScope","scope","on","callback","push","once","self","onetimeCallback","arguments","removeListener","index","indexOf","splice","removeAllListeners","undefined","StreamerCentral","instances","Meteor","Streamer","name","retransmit","retransmitToSelf","console","warn","subscriptions","subscriptionsByEventName","transformers","iniPublication","initMethod","_allowRead","_allowEmit","_allowWrite","allowRead","allowEmit","allowWrite","_name","check","String","subscriptionName","_retransmit","Boolean","_retransmitToSelf","eventName","fn","error","userId","isReadAllowed","call","isEmitAllowed","isWriteAllowed","addSubscription","subscription","removeSubscription","transform","applyTransformers","methodScope","tranformed","Array","isArray","stream","publish","options","useCollection","length","stop","onStop","_session","sendAdded","ready","method","unblock","connection","originalParams","_emit","methods","e","origin","broadcast","sendChanged","emitWithoutBroadcast"],"mappings":"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","file":"/packages/rocketchat_streamer.js","sourcesContent":["/* globals EV:true */\n/* exported EV */\n\nEV = class EV {\n\tconstructor() {\n\t\tthis.handlers = {};\n\t}\n\n\temit(event, ...args) {\n\t\tif (this.handlers[event]) {\n\t\t\tthis.handlers[event].forEach((handler) => handler.apply(this, args));\n\t\t}\n\t}\n\n\temitWithScope(event, scope, ...args) {\n\t\tif (this.handlers[event]) {\n\t\t\tthis.handlers[event].forEach((handler) => handler.apply(scope, args));\n\t\t}\n\t}\n\n\ton(event, callback) {\n\t\tif (!this.handlers[event]) {\n\t\t\tthis.handlers[event] = [];\n\t\t}\n\t\tthis.handlers[event].push(callback);\n\t}\n\n\tonce(event, callback) {\n\t\tself = this;\n\t\tself.on(event, function onetimeCallback() {\n\t\t\tcallback.apply(this, arguments);\n\t\t\tself.removeListener(event, onetimeCallback);\n\t\t});\n\t}\n\n\tremoveListener(event, callback) {\n\t\tif(this.handlers[event]) {\n\t\t\tconst index = this.handlers[event].indexOf(callback);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.handlers[event].splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\tremoveAllListeners(event) {\n\t\tthis.handlers[event] = undefined;\n\t}\n};\n","/* globals EV */\n/* eslint new-cap: false */\n\nclass StreamerCentral extends EV {\n\tconstructor() {\n\t\tsuper();\n\n\t\tthis.instances = {};\n\t}\n}\n\nMeteor.StreamerCentral = new StreamerCentral;\n\n\nMeteor.Streamer = class Streamer extends EV {\n\tconstructor(name, {retransmit = true, retransmitToSelf = false} = {}) {\n\t\tif (Meteor.StreamerCentral.instances[name]) {\n\t\t\tconsole.warn('Streamer instance already exists:', name);\n\t\t\treturn Meteor.StreamerCentral.instances[name];\n\t\t}\n\n\t\tsuper();\n\n\t\tMeteor.StreamerCentral.instances[name] = this;\n\n\t\tthis.name = name;\n\t\tthis.retransmit = retransmit;\n\t\tthis.retransmitToSelf = retransmitToSelf;\n\n\t\tthis.subscriptions = [];\n\t\tthis.subscriptionsByEventName = {};\n\t\tthis.transformers = {};\n\n\t\tthis.iniPublication();\n\t\tthis.initMethod();\n\n\t\tthis._allowRead = {};\n\t\tthis._allowEmit = {};\n\t\tthis._allowWrite = {};\n\n\t\tthis.allowRead('none');\n\t\tthis.allowEmit('all');\n\t\tthis.allowWrite('none');\n\t}\n\n\tget name() {\n\t\treturn this._name;\n\t}\n\n\tset name(name) {\n\t\tcheck(name, String);\n\t\tthis._name = name;\n\t}\n\n\tget subscriptionName() {\n\t\treturn `stream-${this.name}`;\n\t}\n\n\tget retransmit() {\n\t\treturn this._retransmit;\n\t}\n\n\tset retransmit(retransmit) {\n\t\tcheck(retransmit, Boolean);\n\t\tthis._retransmit = retransmit;\n\t}\n\n\tget retransmitToSelf() {\n\t\treturn this._retransmitToSelf;\n\t}\n\n\tset retransmitToSelf(retransmitToSelf) {\n\t\tcheck(retransmitToSelf, Boolean);\n\t\tthis._retransmitToSelf = retransmitToSelf;\n\t}\n\n\tallowRead(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowRead[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowRead[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowEmit(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowEmit[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowRead shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowEmit[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tallowWrite(eventName, fn) {\n\t\tif (fn === undefined) {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (typeof fn === 'function') {\n\t\t\treturn this._allowWrite[eventName] = fn;\n\t\t}\n\n\t\tif (typeof fn === 'string' && ['all', 'none', 'logged'].indexOf(fn) === -1) {\n\t\t\tconsole.error(`allowWrite shortcut '${fn}' is invalid`);\n\t\t}\n\n\t\tif (fn === 'all' || fn === true) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn true;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'none' || fn === false) {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\n\t\tif (fn === 'logged') {\n\t\t\treturn this._allowWrite[eventName] = function() {\n\t\t\t\treturn Boolean(this.userId);\n\t\t\t};\n\t\t}\n\t}\n\n\tisReadAllowed(scope, eventName, args) {\n\t\tif (this._allowRead[eventName]) {\n\t\t\treturn this._allowRead[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowRead['__all__'].call(scope, eventName, ...args);\n\t}\n\n\tisEmitAllowed(scope, eventName, ...args) {\n\t\tif (this._allowEmit[eventName]) {\n\t\t\treturn this._allowEmit[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowEmit['__all__'].call(scope, eventName, ...args);\n\t}\n\n\tisWriteAllowed(scope, eventName, args) {\n\t\tif (this._allowWrite[eventName]) {\n\t\t\treturn this._allowWrite[eventName].call(scope, eventName, ...args);\n\t\t}\n\n\t\treturn this._allowWrite['__all__'].call(scope, eventName, ...args);\n\t}\n\n\taddSubscription(subscription, eventName) {\n\t\tthis.subscriptions.push(subscription);\n\n\t\tif (!this.subscriptionsByEventName[eventName]) {\n\t\t\tthis.subscriptionsByEventName[eventName] = [];\n\t\t}\n\n\t\tthis.subscriptionsByEventName[eventName].push(subscription);\n\t}\n\n\tremoveSubscription(subscription, eventName) {\n\t\tconst index = this.subscriptions.indexOf(subscription);\n\t\tif (index > -1) {\n\t\t\tthis.subscriptions.splice(index, 1);\n\t\t}\n\n\t\tif (this.subscriptionsByEventName[eventName]) {\n\t\t\tconst index = this.subscriptionsByEventName[eventName].indexOf(subscription);\n\t\t\tif (index > -1) {\n\t\t\t\tthis.subscriptionsByEventName[eventName].splice(index, 1);\n\t\t\t}\n\t\t}\n\t}\n\n\ttransform(eventName, fn) {\n\t\tif (typeof eventName === 'function') {\n\t\t\tfn = eventName;\n\t\t\teventName = '__all__';\n\t\t}\n\n\t\tif (!this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName] = [];\n\t\t}\n\n\t\tthis.transformers[eventName].push(fn);\n\t}\n\n\tapplyTransformers(methodScope, eventName, args) {\n\t\tif (this.transformers['__all__']) {\n\t\t\tthis.transformers['__all__'].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, eventName, args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (this.transformers[eventName]) {\n\t\t\tthis.transformers[eventName].forEach((transform) => {\n\t\t\t\targs = transform.call(methodScope, ...args);\n\t\t\t\tmethodScope.tranformed = true;\n\t\t\t\tif (!Array.isArray(args)) {\n\t\t\t\t\targs = [args];\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn args;\n\t}\n\n\tiniPublication() {\n\t\tconst stream = this;\n\t\tMeteor.publish(this.subscriptionName, function(eventName, options) {\n\t\t\tcheck(eventName, String);\n\n\t\t\tlet useCollection, args = [];\n\n\t\t\tif (typeof options === 'boolean') {\n\t\t\t\tuseCollection = options;\n\t\t\t} else {\n\t\t\t\tif (options.useCollection) {\n\t\t\t\t\tuseCollection = options.useCollection;\n\t\t\t\t}\n\n\t\t\t\tif (options.args) {\n\t\t\t\t\targs = options.args;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (eventName.length === 0) {\n\t\t\t\tthis.stop();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (stream.isReadAllowed(this, eventName, args) !== true) {\n\t\t\t\tthis.stop();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst subscription = {\n\t\t\t\tsubscription: this,\n\t\t\t\teventName: eventName\n\t\t\t};\n\n\t\t\tstream.addSubscription(subscription, eventName);\n\n\t\t\tthis.onStop(() => {\n\t\t\t\tstream.removeSubscription(subscription, eventName);\n\t\t\t});\n\n\t\t\tif (useCollection === true) {\n\t\t\t\t// Collection compatibility\n\t\t\t\tthis._session.sendAdded(stream.subscriptionName, 'id', {\n\t\t\t\t\teventName: eventName\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.ready();\n\t\t});\n\t}\n\n\tinitMethod() {\n\t\tconst stream = this;\n\t\tconst method = {};\n\n\t\tmethod[this.subscriptionName] = function(eventName, ...args) {\n\t\t\tcheck(eventName, String);\n\t\t\tcheck(args, Array);\n\n\t\t\tthis.unblock();\n\n\t\t\tif (stream.isWriteAllowed(this, eventName, args) !== true) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst methodScope = {\n\t\t\t\tuserId: this.userId,\n\t\t\t\tconnection: this.connection,\n\t\t\t\toriginalParams: args,\n\t\t\t\ttranformed: false\n\t\t\t};\n\n\t\t\targs = stream.applyTransformers(methodScope, eventName, args);\n\n\t\t\tstream.emitWithScope(eventName, methodScope, ...args);\n\n\t\t\tif (stream.retransmit === true) {\n\t\t\t\tstream._emit(eventName, args, this.connection, true);\n\t\t\t}\n\t\t};\n\n\t\ttry {\n\t\t\tMeteor.methods(method);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t}\n\t}\n\n\t_emit(eventName, args, origin, broadcast) {\n\t\tif (broadcast === true) {\n\t\t\tMeteor.StreamerCentral.emit('broadcast', this.name, eventName, args);\n\t\t}\n\n\t\tconst subscriptions = this.subscriptionsByEventName[eventName];\n\t\tif (!Array.isArray(subscriptions)) {\n\t\t\treturn;\n\t\t}\n\n\t\tsubscriptions.forEach((subscription) => {\n\t\t\tif (this.retransmitToSelf === false && origin && origin === subscription.subscription.connection) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isEmitAllowed(subscription.subscription, eventName, ...args)) {\n\t\t\t\tsubscription.subscription._session.sendChanged(this.subscriptionName, 'id', {\n\t\t\t\t\teventName: eventName,\n\t\t\t\t\targs: args\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\temit(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, true);\n\t}\n\n\temitWithoutBroadcast(eventName, ...args) {\n\t\tthis._emit(eventName, args, undefined, false);\n\t}\n};\n"]}