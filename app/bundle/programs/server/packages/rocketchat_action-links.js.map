{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:action-links/both/lib/actionLinks.js","meteor://ðŸ’»app/packages/rocketchat:action-links/server/actionLinkHandler.js"],"names":["RocketChat","actionLinks","actions","register","name","funct","getMessage","messageId","Meteor","userId","Error","function","message","models","Messages","findOne","_id","room","Rooms","rid","Array","isArray","usernames","indexOf","user","username","methods","actionLinkHandler","method","actionLink","method_id","params"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AACAA,WAAWC,WAAX,GAAyB;AACxBC,UAAS,EADe;;AAExBC,UAASC,IAAT,EAAeC,KAAf,EAAsB;AACrBL,aAAWC,WAAX,CAAuBC,OAAvB,CAA+BE,IAA/B,IAAuCC,KAAvC;AACA,EAJuB;;AAKxBC,YAAWF,IAAX,EAAiBG,SAAjB,EAA4B;AAC3B,MAAI,CAACC,OAAOC,MAAP,EAAL,EAAsB;AACrB,SAAM,IAAID,OAAOE,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEC,cAAU;AAAZ,IAAvD,CAAN;AACA;;AAED,QAAMC,UAAUZ,WAAWa,MAAX,CAAkBC,QAAlB,CAA2BC,OAA3B,CAAmC;AAAEC,QAAKT;AAAP,GAAnC,CAAhB;;AACA,MAAI,CAACK,OAAL,EAAc;AACb,SAAM,IAAIJ,OAAOE,KAAX,CAAiB,uBAAjB,EAA0C,iBAA1C,EAA6D;AAAEC,cAAU;AAAZ,IAA7D,CAAN;AACA;;AAED,QAAMM,OAAOjB,WAAWa,MAAX,CAAkBK,KAAlB,CAAwBH,OAAxB,CAAgC;AAAEC,QAAKJ,QAAQO;AAAf,GAAhC,CAAb;;AACA,MAAIC,MAAMC,OAAN,CAAcJ,KAAKK,SAAnB,KAAiCL,KAAKK,SAAL,CAAeC,OAAf,CAAuBf,OAAOgB,IAAP,GAAcC,QAArC,MAAmD,CAAC,CAAzF,EAA4F;AAC3F,SAAM,IAAIjB,OAAOE,KAAX,CAAiB,mBAAjB,EAAsC,aAAtC,EAAqD;AAAEC,cAAU;AAAZ,IAArD,CAAN;AACA;;AAED,MAAI,CAACC,QAAQX,WAAT,IAAwB,CAACW,QAAQX,WAAR,CAAoBG,IAApB,CAA7B,EAAwD;AACvD,SAAM,IAAII,OAAOE,KAAX,CAAiB,0BAAjB,EAA6C,qBAA7C,EAAoE;AAAEC,cAAU;AAAZ,IAApE,CAAN;AACA;;AAED,SAAOC,OAAP;AACA;;AAzBuB,CAAzB,C;;;;;;;;;;;ACDA;AAEAJ,OAAOkB,OAAP,CAAe;AACdC,mBAAkBvB,IAAlB,EAAwBG,SAAxB,EAAmC;AAClC,MAAI,CAACC,OAAOC,MAAP,EAAL,EAAsB;AACrB,SAAM,IAAID,OAAOE,KAAX,CAAiB,oBAAjB,EAAuC,cAAvC,EAAuD;AAAEkB,YAAQ;AAAV,IAAvD,CAAN;AACA;;AAED,QAAMhB,UAAUZ,WAAWC,WAAX,CAAuBK,UAAvB,CAAkCF,IAAlC,EAAwCG,SAAxC,CAAhB;AAEA,QAAMsB,aAAajB,QAAQX,WAAR,CAAoBG,IAApB,CAAnB;AAEAJ,aAAWC,WAAX,CAAuBC,OAAvB,CAA+B2B,WAAWC,SAA1C,EAAqDlB,OAArD,EAA8DiB,WAAWE,MAAzE;AACA;;AAXa,CAAf,E","file":"/packages/rocketchat_action-links.js","sourcesContent":["//Action Links namespace creation.\nRocketChat.actionLinks = {\n\tactions: {},\n\tregister(name, funct) {\n\t\tRocketChat.actionLinks.actions[name] = funct;\n\t},\n\tgetMessage(name, messageId) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tconst message = RocketChat.models.Messages.findOne({ _id: messageId });\n\t\tif (!message) {\n\t\t\tthrow new Meteor.Error('error-invalid-message', 'Invalid message', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOne({ _id: message.rid });\n\t\tif (Array.isArray(room.usernames) && room.usernames.indexOf(Meteor.user().username) === -1) {\n\t\t\tthrow new Meteor.Error('error-not-allowed', 'Not allowed', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\tif (!message.actionLinks || !message.actionLinks[name]) {\n\t\t\tthrow new Meteor.Error('error-invalid-actionlink', 'Invalid action link', { function: 'actionLinks.getMessage' });\n\t\t}\n\n\t\treturn message;\n\t}\n};\n","//Action Links Handler. This method will be called off the client.\n\nMeteor.methods({\n\tactionLinkHandler(name, messageId) {\n\t\tif (!Meteor.userId()) {\n\t\t\tthrow new Meteor.Error('error-invalid-user', 'Invalid user', { method: 'actionLinkHandler' });\n\t\t}\n\n\t\tconst message = RocketChat.actionLinks.getMessage(name, messageId);\n\n\t\tconst actionLink = message.actionLinks[name];\n\n\t\tRocketChat.actionLinks.actions[actionLink.method_id](message, actionLink.params);\n\t}\n});\n"]}