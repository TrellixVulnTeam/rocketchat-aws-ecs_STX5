{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:markdown/settings.js","meteor://ðŸ’»app/packages/rocketchat:markdown/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/marked/marked.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/code.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/markdown.js","meteor://ðŸ’»app/packages/rocketchat:markdown/parser/original/original.js"],"names":["Meteor","module","watch","require","v","RocketChat","startup","settings","add","type","values","key","i18nLabel","group","section","public","enableQueryOriginal","_id","value","enableQuery","i18nDescription","enableQueryMarked","s","default","Blaze","marked","original","parsers","MarkdownClass","parse","text","message","html","escapeHTML","mountTokensBack","parseMessageNotEscaped","parseNotEscaped","parser","get","tokens","length","token","replace","Markdown","MarkdownMessage","trim","undefined","callbacks","priority","HIGH","isClient","registerHelper","export","Random","_","hljs","_marked","renderer","Renderer","msg","code","lang","escaped","options","highlight","out","escape","isString","id","push","codespan","blockquote","quote","e","gfm","tables","breaks","pedantic","smartLists","smartypants","unescapeHTML","sanitize","inlinecode","match","p1","p2","p3","noHtml","codeblocks","count","msgParts","split","index","part","codeMatch","singleLine","indexOf","Array","from","listLanguages","includes","result","highlightAuto","language","stripTags","join","markdown","addAsToken","schemes","RegExp","title","url","target","absoluteUrl"],"mappings":"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","file":"/packages/rocketchat_markdown.js","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nMeteor.startup(() => {\n\tRocketChat.settings.add('Markdown_Parser', 'original', {\n\t\ttype: 'select',\n\t\tvalues: [{\n\t\t\tkey: 'disabled',\n\t\t\ti18nLabel: 'Disabled'\n\t\t}, {\n\t\t\tkey: 'original',\n\t\t\ti18nLabel: 'Original'\n\t\t}, {\n\t\t\tkey: 'marked',\n\t\t\ti18nLabel: 'Marked'\n\t\t}],\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true\n\t});\n\n\tconst enableQueryOriginal = {_id: 'Markdown_Parser', value: 'original'};\n\tRocketChat.settings.add('Markdown_Headers', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryOriginal\n\t});\n\tRocketChat.settings.add('Markdown_SupportSchemesForLink', 'http,https', {\n\t\ttype: 'string',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\ti18nDescription: 'Markdown_SupportSchemesForLink_Description',\n\t\tenableQuery: enableQueryOriginal\n\t});\n\n\tconst enableQueryMarked = {_id: 'Markdown_Parser', value: 'marked'};\n\tRocketChat.settings.add('Markdown_Marked_GFM', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Tables', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Breaks', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Pedantic', false, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: [{\n\t\t\t_id: 'Markdown_Parser',\n\t\t\tvalue: 'marked'\n\t\t}, {\n\t\t\t_id: 'Markdown_Marked_GFM',\n\t\t\tvalue: false\n\t\t}]\n\t});\n\tRocketChat.settings.add('Markdown_Marked_SmartLists', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n\tRocketChat.settings.add('Markdown_Marked_Smartypants', true, {\n\t\ttype: 'boolean',\n\t\tgroup: 'Message',\n\t\tsection: 'Markdown',\n\t\tpublic: true,\n\t\tenableQuery: enableQueryMarked\n\t});\n});\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport s from 'underscore.string';\nimport { Meteor } from 'meteor/meteor';\nimport { Blaze } from 'meteor/blaze';\nimport { RocketChat } from 'meteor/rocketchat:lib';\n\nimport { marked } from './parser/marked/marked.js';\nimport { original } from './parser/original/original.js';\n\nconst parsers = {\n\toriginal,\n\tmarked\n};\n\nclass MarkdownClass {\n\tparse(text) {\n\t\tconst message = {\n\t\t\thtml: s.escapeHTML(text)\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseNotEscaped(text) {\n\t\tconst message = {\n\t\t\thtml: text\n\t\t};\n\t\treturn this.mountTokensBack(this.parseMessageNotEscaped(message)).html;\n\t}\n\n\tparseMessageNotEscaped(message) {\n\t\tconst parser = RocketChat.settings.get('Markdown_Parser');\n\n\t\tif (parser === 'disabled') {\n\t\t\treturn message;\n\t\t}\n\n\t\tif (typeof parsers[parser] === 'function') {\n\t\t\treturn parsers[parser](message);\n\t\t}\n\t\treturn parsers['original'](message);\n\t}\n\n\tmountTokensBack(message) {\n\t\tif (message.tokens && message.tokens.length > 0) {\n\t\t\tfor (const {token, text} of message.tokens) {\n\t\t\t\tmessage.html = message.html.replace(token, () => text); // Uses lambda so doesn't need to escape $\n\t\t\t}\n\t\t}\n\n\t\treturn message;\n\t}\n}\n\nconst Markdown = new MarkdownClass;\nRocketChat.Markdown = Markdown;\n\n// renderMessage already did html escape\nconst MarkdownMessage = (message) => {\n\tif (s.trim(message != null ? message.html : undefined)) {\n\t\tmessage = Markdown.parseMessageNotEscaped(message);\n\t}\n\n\treturn message;\n};\n\nRocketChat.callbacks.add('renderMessage', MarkdownMessage, RocketChat.callbacks.priority.HIGH, 'markdown');\n\nif (Meteor.isClient) {\n\tBlaze.registerHelper('RocketChatMarkdown', text => Markdown.parse(text));\n\tBlaze.registerHelper('RocketChatMarkdownUnescape', text => Markdown.parseNotEscaped(text));\n}\n","import { RocketChat } from 'meteor/rocketchat:lib';\nimport { Random } from 'meteor/random';\nimport _ from 'underscore';\nimport s from 'underscore.string';\nimport hljs from 'highlight.js';\nimport _marked from 'marked';\n\nconst renderer = new _marked.Renderer();\n\nlet msg = null;\n\nrenderer.code = function(code, lang, escaped) {\n\tif (this.options.highlight) {\n\t\tconst out = this.options.highlight(code, lang);\n\t\tif (out != null && out !== code) {\n\t\t\tescaped = true;\n\t\t\tcode = out;\n\t\t}\n\t}\n\n\tlet text = null;\n\n\tif (!lang) {\n\t\ttext = `<pre><code class=\"code-colors hljs\">${ (escaped ? code : s.escapeHTML(code, true)) }</code></pre>`;\n\t} else {\n\t\ttext = `<pre><code class=\"code-colors hljs ${ escape(lang, true) }\">${ (escaped ? code : s.escapeHTML(code, true)) }</code></pre>`;\n\t}\n\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\thighlight: true,\n\t\ttoken,\n\t\ttext\n\t});\n\n\treturn token;\n};\n\nrenderer.codespan = function(text) {\n\ttext = `<code class=\"code-colors inline\">${ text }</code>`;\n\tif (_.isString(msg)) {\n\t\treturn text;\n\t}\n\n\tconst token = `=!=${ Random.id() }=!=`;\n\tmsg.tokens.push({\n\t\ttoken,\n\t\ttext\n\t});\n\n\treturn token;\n};\n\nrenderer.blockquote = function(quote) {\n\treturn `<blockquote class=\"background-transparent-darker-before\">${ quote }</blockquote>`;\n};\n\nconst highlight = function(code, lang) {\n\tif (!lang) {\n\t\treturn code;\n\t}\n\ttry {\n\t\treturn hljs.highlight(lang, code).value;\n\t} catch (e) {\n\t\t// Unknown language\n\t\treturn code;\n\t}\n};\n\nlet gfm = null;\nlet tables = null;\nlet breaks = null;\nlet pedantic = null;\nlet smartLists = null;\nlet smartypants = null;\n\nexport const marked = (message) => {\n\tmsg = message;\n\n\tif (!msg.tokens) {\n\t\tmsg.tokens = [];\n\t}\n\n\tif (gfm == null) { gfm = RocketChat.settings.get('Markdown_Marked_GFM'); }\n\tif (tables == null) { tables = RocketChat.settings.get('Markdown_Marked_Tables'); }\n\tif (breaks == null) { breaks = RocketChat.settings.get('Markdown_Marked_Breaks'); }\n\tif (pedantic == null) { pedantic = RocketChat.settings.get('Markdown_Marked_Pedantic'); }\n\tif (smartLists == null) { smartLists = RocketChat.settings.get('Markdown_Marked_SmartLists'); }\n\tif (smartypants == null) { smartypants = RocketChat.settings.get('Markdown_Marked_Smartypants'); }\n\n\tmsg.html = _marked(s.unescapeHTML(msg.html), {\n\t\tgfm,\n\t\ttables,\n\t\tbreaks,\n\t\tpedantic,\n\t\tsmartLists,\n\t\tsmartypants,\n\t\trenderer,\n\t\tsanitize: true,\n\t\thighlight\n\t});\n\n\treturn msg;\n};\n","/*\n * code() is a named function that will parse `inline code` and ```codeblock``` syntaxes\n * @param {Object} message - The message object\n */\nimport { Random } from 'meteor/random';\nimport s from 'underscore.string';\nimport hljs from 'highlight.js';\n\nconst inlinecode = (message) => {\n\t// Support `text`\n\treturn message.html = message.html.replace(/(^|&gt;|[ >_*~])\\`([^`\\r\\n]+)\\`([<_*~]|\\B|\\b|$)/gm, (match, p1, p2, p3) => {\n\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: `${ p1 }<span class=\\\"copyonly\\\">\\`</span><span><code class=\\\"code-colors inline\\\">${ p2 }</code></span><span class=\\\"copyonly\\\">\\`</span>${ p3 }`,\n\t\t\tnoHtml: match\n\t\t});\n\n\t\treturn token;\n\t});\n};\n\nconst codeblocks = (message) => {\n\t// Count occurencies of ```\n\tconst count = (message.html.match(/```/g) || []).length;\n\n\tif (count) {\n\n\t\t// Check if we need to add a final ```\n\t\tif ((count % 2) > 0) {\n\t\t\tmessage.html = `${ message.html }\\n\\`\\`\\``;\n\t\t\tmessage.msg = `${ message.msg }\\n\\`\\`\\``;\n\t\t}\n\n\t\t// Separate text in code blocks and non code blocks\n\t\tconst msgParts = message.html.split(/(^.*)(```(?:[a-zA-Z]+)?(?:(?:.|\\r|\\n)*?)```)(.*\\n?)$/gm);\n\n\t\tfor (let index = 0; index < msgParts.length; index++) {\n\t\t\t// Verify if this part is code\n\t\t\tconst part = msgParts[index];\n\t\t\tconst codeMatch = part.match(/^```(.*[\\r\\n\\ ]?)([\\s\\S]*?)```+?$/);\n\n\t\t\tif (codeMatch != null) {\n\t\t\t\t// Process highlight if this part is code\n\t\t\t\tconst singleLine = codeMatch[0].indexOf('\\n') === -1;\n\t\t\t\tconst lang = !singleLine && Array.from(hljs.listLanguages()).includes(s.trim(codeMatch[1])) ? s.trim(codeMatch[1]) : '';\n\t\t\t\tconst code =\n\t\t\t\t\tsingleLine ?\n\t\t\t\t\t\ts.unescapeHTML(codeMatch[1]) :\n\t\t\t\t\t\tlang === '' ?\n\t\t\t\t\t\t\ts.unescapeHTML(codeMatch[1] + codeMatch[2]) :\n\t\t\t\t\t\t\ts.unescapeHTML(codeMatch[2]);\n\n\t\t\t\tconst result = lang === '' ? hljs.highlightAuto((lang + code)) : hljs.highlight(lang, code);\n\t\t\t\tconst token = `=!=${ Random.id() }=!=`;\n\n\t\t\t\tmessage.tokens.push({\n\t\t\t\t\thighlight: true,\n\t\t\t\t\ttoken,\n\t\t\t\t\ttext: `<pre><code class='code-colors hljs ${ result.language }'><span class='copyonly'>\\`\\`\\`<br></span>${ result.value }<span class='copyonly'><br>\\`\\`\\`</span></code></pre>`,\n\t\t\t\t\tnoHtml: `\\`\\`\\`\\n${ s.stripTags(result.value) }\\n\\`\\`\\``\n\t\t\t\t});\n\n\t\t\t\tmsgParts[index] = token;\n\t\t\t} else {\n\t\t\t\tmsgParts[index] = part;\n\t\t\t}\n\t\t}\n\n\t\t// Re-mount message\n\t\treturn message.html = msgParts.join('');\n\t}\n};\n\nexport const code = (message) => {\n\tif (s.trim(message.html)) {\n\t\tif (message.tokens == null) {\n\t\t\tmessage.tokens = [];\n\t\t}\n\n\t\tcodeblocks(message);\n\t\tinlinecode(message);\n\t}\n\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {String} msg - The message html\n */\nimport { Meteor } from 'meteor/meteor';\nimport { Random } from 'meteor/random';\nimport { RocketChat } from 'meteor/rocketchat:lib';\nimport s from 'underscore.string';\n\nconst parseNotEscaped = function(msg, message) {\n\tif (message && message.tokens == null) {\n\t\tmessage.tokens = [];\n\t}\n\n\tconst addAsToken = function(html) {\n\t\tconst token = `=!=${ Random.id() }=!=`;\n\t\tmessage.tokens.push({\n\t\t\ttoken,\n\t\t\ttext: html\n\t\t});\n\n\t\treturn token;\n\t};\n\n\tconst schemes = RocketChat.settings.get('Markdown_SupportSchemesForLink').split(',').join('|');\n\n\tif (RocketChat.settings.get('Markdown_Headers')) {\n\t\t// Support # Text for h1\n\t\tmsg = msg.replace(/^# (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h1>$1</h1>');\n\n\t\t// Support # Text for h2\n\t\tmsg = msg.replace(/^## (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h2>$1</h2>');\n\n\t\t// Support # Text for h3\n\t\tmsg = msg.replace(/^### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h3>$1</h3>');\n\n\t\t// Support # Text for h4\n\t\tmsg = msg.replace(/^#### (([\\S\\w\\d-_\\/\\*\\.,\\\\][ \\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]?)+)/gm, '<h4>$1</h4>');\n\t}\n\n\t// Support *text* to make bold\n\tmsg = msg.replace(/(^|&gt;|[ >_~`])\\*{1,2}([^\\*\\r\\n]+)\\*{1,2}([<_~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">*</span><strong>$2</strong><span class=\"copyonly\">*</span>$3');\n\n\t// Support _text_ to make italics\n\tmsg = msg.replace(/(^|&gt;|[ >*~`])\\_{1,2}([^\\_\\r\\n]+)\\_{1,2}([<*~`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">_</span><em>$2</em><span class=\"copyonly\">_</span>$3');\n\n\t// Support ~text~ to strike through text\n\tmsg = msg.replace(/(^|&gt;|[ >_*`])\\~{1,2}([^~\\r\\n]+)\\~{1,2}([<_*`]|\\B|\\b|$)/gm, '$1<span class=\"copyonly\">~</span><strike>$2</strike><span class=\"copyonly\">~</span>$3');\n\n\t// Support for block quote\n\t// >>>\n\t// Text\n\t// <<<\n\tmsg = msg.replace(/(?:&gt;){3}\\n+([\\s\\S]*?)\\n+(?:&lt;){3}/g, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;&gt;&gt;</span>$1<span class=\"copyonly\">&lt;&lt;&lt;</span></blockquote>');\n\n\t// Support >Text for quote\n\tmsg = msg.replace(/^&gt;(.*)$/gm, '<blockquote class=\"background-transparent-darker-before\"><span class=\"copyonly\">&gt;</span>$1</blockquote>');\n\n\t// Remove white-space around blockquote (prevent <br>). Because blockquote is block element.\n\tmsg = msg.replace(/\\s*<blockquote class=\"background-transparent-darker-before\">/gm, '<blockquote class=\"background-transparent-darker-before\">');\n\tmsg = msg.replace(/<\\/blockquote>\\s*/gm, '</blockquote>');\n\n\t// Remove new-line between blockquotes.\n\tmsg = msg.replace(/<\\/blockquote>\\n<blockquote/gm, '</blockquote><blockquote');\n\n\t// Support ![alt text](http://image url)\n\tmsg = msg.replace(new RegExp(`!\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" title=\"${ s.escapeHTML(title) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\"><div class=\"inline-image\" style=\"background-image: url(${ s.escapeHTML(url) });\"></div></a>`);\n\t});\n\n\t// Support [Text](http://link)\n\tmsg = msg.replace(new RegExp(`\\\\[([^\\\\]]+)\\\\]\\\\(((?:${ schemes }):\\\\/\\\\/[^\\\\)]+)\\\\)`, 'gm'), (match, title, url) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ s.escapeHTML(title) }</a>`);\n\t});\n\n\t// Support <http://link|Text>\n\tmsg = msg.replace(new RegExp(`(?:<|&lt;)((?:${ schemes }):\\\\/\\\\/[^\\\\|]+)\\\\|(.+?)(?=>|&gt;)(?:>|&gt;)`, 'gm'), (match, url, title) => {\n\t\tconst target = url.indexOf(Meteor.absoluteUrl()) === 0 ? '' : '_blank';\n\t\treturn addAsToken(`<a href=\"${ s.escapeHTML(url) }\" target=\"${ s.escapeHTML(target) }\" rel=\"noopener noreferrer\">${ s.escapeHTML(title) }</a>`);\n\t});\n\n\treturn msg;\n};\n\nexport const markdown = function(message) {\n\tmessage.html = parseNotEscaped(message.html, message);\n\treturn message;\n};\n","/*\n * Markdown is a named function that will parse markdown syntax\n * @param {Object} message - The message object\n */\nimport { markdown } from './markdown.js';\nimport { code } from './code.js';\n\nexport const original = (message) => {\n\t// Parse markdown code\n\tmessage = code(message);\n\n\t// Parse markdown\n\tmessage = markdown(message);\n\n\t// Replace linebreak to br\n\tmessage.html = message.html.replace(/\\n/gm, '<br>');\n\n\treturn message;\n};\n"]}