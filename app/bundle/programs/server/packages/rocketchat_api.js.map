{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:api/server/api.js","meteor://ðŸ’»app/packages/rocketchat:api/server/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/requestParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getPaginationItems.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/isUserFromParams.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/parseJsonQuery.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/channels.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/rooms.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/subscriptions.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/chat.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/commands.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/groups.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/im.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/integrations.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/misc.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/push.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/settings.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/stats.js","meteor://ðŸ’»app/packages/rocketchat:api/server/v1/users.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/helpers/getLoggedInUser.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/info.js","meteor://ðŸ’»app/packages/rocketchat:api/server/default/metrics.js"],"names":["_","module","watch","require","default","v","API","Restivus","constructor","properties","logger","Logger","version","authMethods","helperMethods","Map","fieldSeparator","defaultFieldsToExclude","joinCode","$loki","meta","members","usernames","importIds","limitedUserFieldsToExclude","avatarOrigin","emails","phone","statusConnection","createdAt","lastLogin","services","requirePasswordChange","requirePasswordChangeReason","roles","statusDefault","_updatedAt","customFields","_config","defaultOptionsEndpoint","_defaultOptionsEndpoint","request","method","headers","RocketChat","settings","get","response","writeHead","write","done","addAuthMethod","push","success","result","isObject","statusCode","body","failure","errorType","error","unauthorized","msg","notFound","addRoute","routes","options","endpoints","isArray","forEach","route","Object","keys","action","originalAction","debug","toUpperCase","url","apply","e","stack","v1","message","test","channel","channels","group","groups","developerWarning","name","helperMethod","_initAuth","loginCompatibility","bodyParams","user","username","email","password","code","without","length","auth","includes","hashed","digest","algorithm","totp","login","self","authRequired","post","args","invocation","DDPCommon","MethodInvocation","connection","close","DDP","_CurrentInvocation","withValue","Meteor","call","reason","status","users","findOne","_id","id","userId","update","Accounts","_hashLoginToken","token","$unset","data","authToken","extraData","onLoggedIn","extend","extra","logout","hashedToken","tokenLocation","index","lastIndexOf","tokenPath","substring","tokenFieldName","tokenToRemove","tokenRemovalQuery","$pull","onLoggedOut","console","warn","getUserAuth","_getUserAuth","invalidResults","undefined","payload","JSON","parse","i","arguments","createApi","enableCors","useDefaultAuth","prettyJson","process","env","NODE_ENV","key","value","addGroup","section","add","type","public","enableQuery","set","_requestParams","queryParams","_getPaginationItems","hardUpperLimit","defaultCount","offset","parseInt","count","_getUserFromParams","doesntExist","_doesntExist","params","requestParams","trim","models","Users","findOneById","findOneByUsername","Error","_isUserFromParams","_parseJsonQuery","sort","fields","nonSelectableFields","authz","hasPermission","concat","k","split","assign","query","nonQuerableFields","_getLoggedInUser","findChannelByIdOrName","checkedArchived","returnUsernames","roomId","roomName","room","Rooms","findOneByName","t","archived","findResult","runAsUser","activeUsersOnly","getUserFromParams","latest","oldest","Date","inclusive","sub","Subscriptions","findOneByRoomIdAndUserId","open","readOnly","rid","getPaginationItems","parseJsonQuery","ourQuery","files","Uploads","find","skip","limit","fetch","total","includeAllPublicChannels","$in","integrations","Integrations","_createdAt","latestDate","oldestDate","unreads","rooms","pluck","findByTypeAndUserId","totalCount","processQueryOptionsOnResult","sortFn","a","b","Match","Number","Array","from","utcOffset","messages","Messages","ts","online","findUsersNotOffline","onlineInRoom","indexOf","description","purpose","ro","topic","updatedSince","updatedSinceDate","isNaN","remove","urlParams","Busboy","Npm","busboy","wrapAsync","callback","on","fieldname","file","filename","encoding","mimetype","fileDate","fileBuffer","Buffer","bindEnvironment","pipe","fileStore","FileUpload","getStore","details","size","uploadedFile","insert","bind","check","ObjectIncluding","msgId","String","asUser","Maybe","Boolean","u","now","lastUpdate","messageId","pinnedMessage","messageReturn","processWebhookMessage","searchText","starred","text","command","cmd","slashCommands","commands","toLowerCase","values","filter","getLoggedInUser","run","Random","findPrivateGroupByIdOrName","roomSub","findOneByRoomNameAndUserId","_room","includeAllPrivateGroups","channelsToSearch","findByType","findDirectMessageRoom","getRoomByNameOrIdWithOptionToJoin","currentUserId","nameOrId","subscription","log","msgs","ims","enabled","urls","event","triggerWords","alias","avatar","emoji","scriptEnabled","script","targetChannel","integration","history","IntegrationHistory","items","target_url","integrationId","hasRole","info","Info","me","pick","verifiedEmail","verified","address","onlineCache","onlineCacheDate","cacheInvalid","icon","types","map","hideIcon","TAPi18n","__","iconSize","leftSize","rightSize","width","height","replace","appName","delete","affectedRecords","Push","appCollection","$or","hidden","$ne","Settings","findOneNotHiddenById","Any","updateValueNotHiddenById","ServiceConfiguration","Package","configurations","secret","refresh","stats","statistics","Statistics","active","joinDefaultChannels","sendWelcomeEmail","validateCustomFields","newUserId","saveUser","saveCustomFieldsWithoutValidation","getURL","cdn","full","setHeader","isUserFromParams","presence","connectionStatus","avatarUrl","setUserAvatar","imageData","userData","saveCustomFields","promclient","register","metrics"],"mappings":"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","file":"/packages/rocketchat_api.js","sourcesContent":["/* global Restivus, DDP, DDPCommon */\nimport _ from 'underscore';\n\nclass API extends Restivus {\n\tconstructor(properties) {\n\t\tsuper(properties);\n\t\tthis.logger = new Logger(`API ${ properties.version ? properties.version : 'default' } Logger`, {});\n\t\tthis.authMethods = [];\n\t\tthis.helperMethods = new Map();\n\t\tthis.fieldSeparator = '.';\n\t\tthis.defaultFieldsToExclude = {\n\t\t\tjoinCode: 0,\n\t\t\t$loki: 0,\n\t\t\tmeta: 0,\n\t\t\tmembers: 0,\n\t\t\tusernames: 0, // Please use the `channel/dm/group.members` endpoint. This is disabled for performance reasons\n\t\t\timportIds: 0\n\t\t};\n\t\tthis.limitedUserFieldsToExclude = {\n\t\t\tavatarOrigin: 0,\n\t\t\temails: 0,\n\t\t\tphone: 0,\n\t\t\tstatusConnection: 0,\n\t\t\tcreatedAt: 0,\n\t\t\tlastLogin: 0,\n\t\t\tservices: 0,\n\t\t\trequirePasswordChange: 0,\n\t\t\trequirePasswordChangeReason: 0,\n\t\t\troles: 0,\n\t\t\tstatusDefault: 0,\n\t\t\t_updatedAt: 0,\n\t\t\tcustomFields: 0\n\t\t};\n\n\t\tthis._config.defaultOptionsEndpoint = function _defaultOptionsEndpoint() {\n\t\t\tif (this.request.method === 'OPTIONS' && this.request.headers['access-control-request-method']) {\n\t\t\t\tif (RocketChat.settings.get('API_Enable_CORS') === true) {\n\t\t\t\t\tthis.response.writeHead(200, {\n\t\t\t\t\t\t'Access-Control-Allow-Origin': RocketChat.settings.get('API_CORS_Origin'),\n\t\t\t\t\t\t'Access-Control-Allow-Headers': 'Origin, X-Requested-With, Content-Type, Accept, X-User-Id, X-Auth-Token'\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.response.writeHead(405);\n\t\t\t\t\tthis.response.write('CORS not enabled. Go to \"Admin > General > REST Api\" to enable it.');\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.response.writeHead(404);\n\t\t\t}\n\n\t\t\tthis.done();\n\t\t};\n\t}\n\n\taddAuthMethod(method) {\n\t\tthis.authMethods.push(method);\n\t}\n\n\tsuccess(result = {}) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = true;\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 200,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\tfailure(result, errorType) {\n\t\tif (_.isObject(result)) {\n\t\t\tresult.success = false;\n\t\t} else {\n\t\t\tresult = {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: result\n\t\t\t};\n\n\t\t\tif (errorType) {\n\t\t\t\tresult.errorType = errorType;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tstatusCode: 400,\n\t\t\tbody: result\n\t\t};\n\t}\n\n\n\tunauthorized(msg) {\n\t\treturn {\n\t\t\tstatusCode: 403,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'unauthorized'\n\t\t\t}\n\t\t};\n\t}\n\n\tnotFound(msg) {\n\t\treturn {\n\t\t\tstatusCode: 404,\n\t\t\tbody: {\n\t\t\t\tsuccess: false,\n\t\t\t\terror: msg ? msg : 'Nothing was found'\n\t\t\t}\n\t\t};\n\t}\n\n\taddRoute(routes, options, endpoints) {\n\t\t//Note: required if the developer didn't provide options\n\t\tif (typeof endpoints === 'undefined') {\n\t\t\tendpoints = options;\n\t\t\toptions = {};\n\t\t}\n\n\t\t//Allow for more than one route using the same option and endpoints\n\t\tif (!_.isArray(routes)) {\n\t\t\troutes = [routes];\n\t\t}\n\n\t\troutes.forEach((route) => {\n\t\t\t//Note: This is required due to Restivus calling `addRoute` in the constructor of itself\n\t\t\tif (this.helperMethods) {\n\t\t\t\tObject.keys(endpoints).forEach((method) => {\n\t\t\t\t\tif (typeof endpoints[method] === 'function') {\n\t\t\t\t\t\tendpoints[method] = {action: endpoints[method]};\n\t\t\t\t\t}\n\n\t\t\t\t\t//Add a try/catch for each endpoint\n\t\t\t\t\tconst originalAction = endpoints[method].action;\n\t\t\t\t\tendpoints[method].action = function() {\n\t\t\t\t\t\tthis.logger.debug(`${ this.request.method.toUpperCase() }: ${ this.request.url }`);\n\t\t\t\t\t\tlet result;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tresult = originalAction.apply(this);\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tthis.logger.debug(`${ method } ${ route } threw an error:`, e.stack);\n\t\t\t\t\t\t\treturn RocketChat.API.v1.failure(e.message, e.error);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tresult = result ? result : RocketChat.API.v1.success();\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t/(channels|groups)\\./.test(route)\n\t\t\t\t\t\t\t&& result\n\t\t\t\t\t\t\t&& result.body\n\t\t\t\t\t\t\t&& result.body.success === true\n\t\t\t\t\t\t\t&& (result.body.channel || result.body.channels || result.body.group || result.body.groups)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// TODO: Remove this after three versions have been released. That means at 0.64 this should be gone. ;)\n\t\t\t\t\t\t\tresult.body.developerWarning = '[WARNING]: The \"usernames\" field has been removed for performance reasons. Please use the \"*.members\" endpoint to get a list of members/users in a room.';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const [name, helperMethod] of this.helperMethods) {\n\t\t\t\t\t\tendpoints[method][name] = helperMethod;\n\t\t\t\t\t}\n\n\t\t\t\t\t//Allow the endpoints to make usage of the logger which respects the user's settings\n\t\t\t\t\tendpoints[method].logger = this.logger;\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tsuper.addRoute(route, options, endpoints);\n\t\t});\n\t}\n\n\t_initAuth() {\n\t\tconst loginCompatibility = (bodyParams) => {\n\t\t\t// Grab the username or email that the user is logging in with\n\t\t\tconst {user, username, email, password, code} = bodyParams;\n\n\t\t\tif (password == null) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tif (_.without(Object.keys(bodyParams), 'user', 'username', 'email', 'password', 'code').length > 0) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tconst auth = {\n\t\t\t\tpassword\n\t\t\t};\n\n\t\t\tif (typeof user === 'string') {\n\t\t\t\tauth.user = user.includes('@') ? {email: user} : {username: user};\n\t\t\t} else if (username) {\n\t\t\t\tauth.user = {username};\n\t\t\t} else if (email) {\n\t\t\t\tauth.user = {email};\n\t\t\t}\n\n\t\t\tif (auth.user == null) {\n\t\t\t\treturn bodyParams;\n\t\t\t}\n\n\t\t\tif (auth.password.hashed) {\n\t\t\t\tauth.password = {\n\t\t\t\t\tdigest: auth.password,\n\t\t\t\t\talgorithm: 'sha-256'\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (code) {\n\t\t\t\treturn {\n\t\t\t\t\ttotp: {\n\t\t\t\t\t\tcode,\n\t\t\t\t\t\tlogin: auth\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\treturn auth;\n\t\t};\n\n\t\tconst self = this;\n\n\t\tthis.addRoute('login', {authRequired: false}, {\n\t\t\tpost() {\n\t\t\t\tconst args = loginCompatibility(this.bodyParams);\n\n\t\t\t\tconst invocation = new DDPCommon.MethodInvocation({\n\t\t\t\t\tconnection: {\n\t\t\t\t\t\tclose() {}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tlet auth;\n\t\t\t\ttry {\n\t\t\t\t\tauth = DDP._CurrentInvocation.withValue(invocation, () => Meteor.call('login', args));\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlet e = error;\n\t\t\t\t\tif (error.reason === 'User not found') {\n\t\t\t\t\t\te = {\n\t\t\t\t\t\t\terror: 'Unauthorized',\n\t\t\t\t\t\t\treason: 'Unauthorized'\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tstatusCode: 401,\n\t\t\t\t\t\tbody: {\n\t\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\t\terror: e.error,\n\t\t\t\t\t\t\tmessage: e.reason || e.message\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tthis.user = Meteor.users.findOne({\n\t\t\t\t\t_id: auth.id\n\t\t\t\t});\n\n\t\t\t\tthis.userId = this.user._id;\n\n\t\t\t\t// Remove tokenExpires to keep the old behavior\n\t\t\t\tMeteor.users.update({\n\t\t\t\t\t_id: this.user._id,\n\t\t\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(auth.token)\n\t\t\t\t}, {\n\t\t\t\t\t$unset: {\n\t\t\t\t\t\t'services.resume.loginTokens.$.when': 1\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tconst response = {\n\t\t\t\t\tstatus: 'success',\n\t\t\t\t\tdata: {\n\t\t\t\t\t\tuserId: this.userId,\n\t\t\t\t\t\tauthToken: auth.token\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tconst extraData = self._config.onLoggedIn && self._config.onLoggedIn.call(this);\n\n\t\t\t\tif (extraData != null) {\n\t\t\t\t\t_.extend(response.data, {\n\t\t\t\t\t\textra: extraData\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\treturn response;\n\t\t\t}\n\t\t});\n\n\t\tconst logout = function() {\n\t\t\t// Remove the given auth token from the user's account\n\t\t\tconst authToken = this.request.headers['x-auth-token'];\n\t\t\tconst hashedToken = Accounts._hashLoginToken(authToken);\n\t\t\tconst tokenLocation = self._config.auth.token;\n\t\t\tconst index = tokenLocation.lastIndexOf('.');\n\t\t\tconst tokenPath = tokenLocation.substring(0, index);\n\t\t\tconst tokenFieldName = tokenLocation.substring(index + 1);\n\t\t\tconst tokenToRemove = {};\n\t\t\ttokenToRemove[tokenFieldName] = hashedToken;\n\t\t\tconst tokenRemovalQuery = {};\n\t\t\ttokenRemovalQuery[tokenPath] = tokenToRemove;\n\n\t\t\tMeteor.users.update(this.user._id, {\n\t\t\t\t$pull: tokenRemovalQuery\n\t\t\t});\n\n\t\t\tconst response = {\n\t\t\t\tstatus: 'success',\n\t\t\t\tdata: {\n\t\t\t\t\tmessage: 'You\\'ve been logged out!'\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Call the logout hook with the authenticated user attached\n\t\t\tconst extraData = self._config.onLoggedOut && self._config.onLoggedOut.call(this);\n\t\t\tif (extraData != null) {\n\t\t\t\t_.extend(response.data, {\n\t\t\t\t\textra: extraData\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn response;\n\t\t};\n\n\t\t/*\n\t\tAdd a logout endpoint to the API\n\t\tAfter the user is logged out, the onLoggedOut hook is called (see Restfully.configure() for\n\t\tadding hook).\n\t\t*/\n\t\treturn this.addRoute('logout', {\n\t\t\tauthRequired: true\n\t\t}, {\n\t\t\tget() {\n\t\t\t\tconsole.warn('Warning: Default logout via GET will be removed in Restivus v1.0. Use POST instead.');\n\t\t\t\tconsole.warn('    See https://github.com/kahmali/meteor-restivus/issues/100');\n\t\t\t\treturn logout.call(this);\n\t\t\t},\n\t\t\tpost: logout\n\t\t});\n\t}\n}\n\n\nRocketChat.API = {};\n\nconst getUserAuth = function _getUserAuth() {\n\tconst invalidResults = [undefined, null, false];\n\treturn {\n\t\ttoken: 'services.resume.loginTokens.hashedToken',\n\t\tuser() {\n\t\t\tif (this.bodyParams && this.bodyParams.payload) {\n\t\t\t\tthis.bodyParams = JSON.parse(this.bodyParams.payload);\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < RocketChat.API.v1.authMethods.length; i++) {\n\t\t\t\tconst method = RocketChat.API.v1.authMethods[i];\n\n\t\t\t\tif (typeof method === 'function') {\n\t\t\t\t\tconst result = method.apply(this, arguments);\n\t\t\t\t\tif (!invalidResults.includes(result)) {\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlet token;\n\t\t\tif (this.request.headers['x-auth-token']) {\n\t\t\t\ttoken = Accounts._hashLoginToken(this.request.headers['x-auth-token']);\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tuserId: this.request.headers['x-user-id'],\n\t\t\t\ttoken\n\t\t\t};\n\t\t}\n\t};\n};\n\nconst createApi = function(enableCors) {\n\tif (!RocketChat.API.v1 || RocketChat.API.v1._config.enableCors !== enableCors) {\n\t\tRocketChat.API.v1 = new API({\n\t\t\tversion: 'v1',\n\t\t\tuseDefaultAuth: true,\n\t\t\tprettyJson: process.env.NODE_ENV === 'development',\n\t\t\tenableCors,\n\t\t\tauth: getUserAuth()\n\t\t});\n\t}\n\n\tif (!RocketChat.API.default || RocketChat.API.default._config.enableCors !== enableCors) {\n\t\tRocketChat.API.default = new API({\n\t\t\tuseDefaultAuth: true,\n\t\t\tprettyJson: process.env.NODE_ENV === 'development',\n\t\t\tenableCors,\n\t\t\tauth: getUserAuth()\n\t\t});\n\t}\n};\n\n// register the API to be re-created once the CORS-setting changes.\nRocketChat.settings.get('API_Enable_CORS', (key, value) => {\n\tcreateApi(value);\n});\n\n// also create the API immediately\ncreateApi(!!RocketChat.settings.get('API_Enable_CORS'));\n","RocketChat.settings.addGroup('General', function() {\n\tthis.section('REST API', function() {\n\t\tthis.add('API_Upper_Count_Limit', 100, { type: 'int', public: false });\n\t\tthis.add('API_Default_Count', 50, { type: 'int', public: false });\n\t\tthis.add('API_Allow_Infinite_Count', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Direct_Message_History_EndPoint', false, { type: 'boolean', public: false });\n\t\tthis.add('API_Enable_Shields', true, { type: 'boolean', public: false });\n\t\tthis.add('API_Shield_Types', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_Shields', value: true } });\n\t\tthis.add('API_Enable_CORS', false, { type: 'boolean', public: false });\n\t\tthis.add('API_CORS_Origin', '*', { type: 'string', public: false, enableQuery: { _id: 'API_Enable_CORS', value: true } });\n\t});\n});\n","RocketChat.API.v1.helperMethods.set('requestParams', function _requestParams() {\n\treturn ['POST', 'PUT'].includes(this.request.method) ? this.bodyParams : this.queryParams;\n});\n","// If the count query param is higher than the \"API_Upper_Count_Limit\" setting, then we limit that\n// If the count query param isn't defined, then we set it to the \"API_Default_Count\" setting\n// If the count is zero, then that means unlimited and is only allowed if the setting \"API_Allow_Infinite_Count\" is true\n\nRocketChat.API.v1.helperMethods.set('getPaginationItems', function _getPaginationItems() {\n\tconst hardUpperLimit = RocketChat.settings.get('API_Upper_Count_Limit') <= 0 ? 100 : RocketChat.settings.get('API_Upper_Count_Limit');\n\tconst defaultCount = RocketChat.settings.get('API_Default_Count') <= 0 ? 50 : RocketChat.settings.get('API_Default_Count');\n\tconst offset = this.queryParams.offset ? parseInt(this.queryParams.offset) : 0;\n\tlet count = defaultCount;\n\n\t// Ensure count is an appropiate amount\n\tif (typeof this.queryParams.count !== 'undefined') {\n\t\tcount = parseInt(this.queryParams.count);\n\t} else {\n\t\tcount = defaultCount;\n\t}\n\n\tif (count > hardUpperLimit) {\n\t\tcount = hardUpperLimit;\n\t}\n\n\tif (count === 0 && !RocketChat.settings.get('API_Allow_Infinite_Count')) {\n\t\tcount = defaultCount;\n\t}\n\n\treturn {\n\t\toffset,\n\t\tcount\n\t};\n});\n","//Convenience method, almost need to turn it into a middleware of sorts\nRocketChat.API.v1.helperMethods.set('getUserFromParams', function _getUserFromParams() {\n\tconst doesntExist = { _doesntExist: true };\n\tlet user;\n\tconst params = this.requestParams();\n\n\tif (params.userId && params.userId.trim()) {\n\t\tuser = RocketChat.models.Users.findOneById(params.userId) || doesntExist;\n\t} else if (params.username && params.username.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.username) || doesntExist;\n\t} else if (params.user && params.user.trim()) {\n\t\tuser = RocketChat.models.Users.findOneByUsername(params.user) || doesntExist;\n\t} else {\n\t\tthrow new Meteor.Error('error-user-param-not-provided', 'The required \"userId\" or \"username\" param was not provided');\n\t}\n\n\tif (user._doesntExist) {\n\t\tthrow new Meteor.Error('error-invalid-user', 'The required \"userId\" or \"username\" param provided does not match any users');\n\t}\n\n\treturn user;\n});\n","RocketChat.API.v1.helperMethods.set('isUserFromParams', function _isUserFromParams() {\n\tconst params = this.requestParams();\n\n\treturn (!params.userId && !params.username && !params.user) ||\n\t\t(params.userId && this.userId === params.userId) ||\n\t\t(params.username && this.user.username === params.username) ||\n\t\t(params.user && this.user.username === params.user);\n});\n","RocketChat.API.v1.helperMethods.set('parseJsonQuery', function _parseJsonQuery() {\n\tlet sort;\n\tif (this.queryParams.sort) {\n\t\ttry {\n\t\t\tsort = JSON.parse(this.queryParams.sort);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid sort parameter provided \"${ this.queryParams.sort }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-sort', `Invalid sort parameter provided: \"${ this.queryParams.sort }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\tlet fields;\n\tif (this.queryParams.fields) {\n\t\ttry {\n\t\t\tfields = JSON.parse(this.queryParams.fields);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid fields parameter provided \"${ this.queryParams.fields }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-fields', `Invalid fields parameter provided: \"${ this.queryParams.fields }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user's selected fields only contains ones which their role allows\n\tif (typeof fields === 'object') {\n\t\tlet nonSelectableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\t\tnonSelectableFields = nonSelectableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExclude));\n\t\t}\n\n\t\tObject.keys(fields).forEach((k) => {\n\t\t\tif (nonSelectableFields.includes(k) || nonSelectableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete fields[k];\n\t\t\t}\n\t\t});\n\t}\n\n\t// Limit the fields by default\n\tfields = Object.assign({}, fields, RocketChat.API.v1.defaultFieldsToExclude);\n\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\tfields = Object.assign(fields, RocketChat.API.v1.limitedUserFieldsToExclude);\n\t}\n\n\tlet query;\n\tif (this.queryParams.query) {\n\t\ttry {\n\t\t\tquery = JSON.parse(this.queryParams.query);\n\t\t} catch (e) {\n\t\t\tthis.logger.warn(`Invalid query parameter provided \"${ this.queryParams.query }\":`, e);\n\t\t\tthrow new Meteor.Error('error-invalid-query', `Invalid query parameter provided: \"${ this.queryParams.query }\"`, { helperMethod: 'parseJsonQuery' });\n\t\t}\n\t}\n\n\t// Verify the user has permission to query the fields they are\n\tif (typeof query === 'object') {\n\t\tlet nonQuerableFields = Object.keys(RocketChat.API.v1.defaultFieldsToExclude);\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-full-other-user-info') && this.request.route.includes('/v1/users.')) {\n\t\t\tnonQuerableFields = nonQuerableFields.concat(Object.keys(RocketChat.API.v1.limitedUserFieldsToExclude));\n\t\t}\n\n\t\tObject.keys(query).forEach((k) => {\n\t\t\tif (nonQuerableFields.includes(k) || nonQuerableFields.includes(k.split(RocketChat.API.v1.fieldSeparator)[0])) {\n\t\t\t\tdelete query[k];\n\t\t\t}\n\t\t});\n\t}\n\n\treturn {\n\t\tsort,\n\t\tfields,\n\t\tquery\n\t};\n});\n","RocketChat.API.v1.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","import _ from 'underscore';\n\n//Returns the channel IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findChannelByIdOrName({ params, checkedArchived = true, returnUsernames = false }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tconst fields = { ...RocketChat.API.v1.defaultFieldsToExclude };\n\tif (returnUsernames) {\n\t\tdelete fields.usernames;\n\t}\n\n\tlet room;\n\tif (params.roomId) {\n\t\troom = RocketChat.models.Rooms.findOneById(params.roomId, { fields });\n\t} else if (params.roomName) {\n\t\troom = RocketChat.models.Rooms.findOneByName(params.roomName, { fields });\n\t}\n\n\tif (!room || room.t !== 'c') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any channel');\n\t}\n\n\tif (checkedArchived && room.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The channel, ${ room.name }, is archived`);\n\t}\n\n\treturn room;\n}\n\nRocketChat.API.v1.addRoute('channels.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult._id, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.cleanHistory', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (!this.bodyParams.latest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"latest\" is required.');\n\t\t}\n\n\t\tif (!this.bodyParams.oldest) {\n\t\t\treturn RocketChat.API.v1.failure('Body parameter \"oldest\" is required.');\n\t\t}\n\n\t\tconst latest = new Date(this.bodyParams.latest);\n\t\tconst oldest = new Date(this.bodyParams.oldest);\n\n\t\tlet inclusive = false;\n\t\tif (typeof this.bodyParams.inclusive !== 'undefined') {\n\t\t\tinclusive = this.bodyParams.inclusive;\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('cleanChannelHistory', { roomId: findResult._id, latest, oldest, inclusive });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }.`);\n\t\t}\n\n\t\tif (!sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-c')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createChannel', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: findResult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('canAccessRoom', findResult._id, this.userId);\n\t\t});\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet includeAllPublicChannels = true;\n\t\tif (typeof this.queryParams.includeAllPublicChannels !== 'undefined') {\n\t\t\tincludeAllPublicChannels = this.queryParams.includeAllPublicChannels === 'true';\n\t\t}\n\n\t\tlet ourQuery = {\n\t\t\tchannel: `#${ findResult.name }`\n\t\t};\n\n\t\tif (includeAllPublicChannels) {\n\t\t\tourQuery.channel = {\n\t\t\t\t$in: [ourQuery.channel, 'all_public_channels']\n\t\t\t};\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult._id, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.join', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('joinRoom', findResult._id, this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult._id, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list', { authRequired: true }, {\n\tget: {\n\t\t//This is defined as such only to provide an example of how the routes can be defined :X\n\t\taction() {\n\t\t\tconst { offset, count } = this.getPaginationItems();\n\t\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\t\t//Special check for the permissions\n\t\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room')) {\n\t\t\t\tourQuery.usernames = {\n\t\t\t\t\t$in: [ this.user.username ]\n\t\t\t\t};\n\t\t\t} else if (!RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t\t}\n\n\t\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\t\tskip: offset,\n\t\t\t\tlimit: count,\n\t\t\t\tfields\n\t\t\t}).fetch();\n\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tchannels: rooms,\n\t\t\t\tcount: rooms.length,\n\t\t\t\toffset,\n\t\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t\t});\n\t\t}\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.list.joined', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('c', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannels: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false, returnUsernames: true });\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tlet sortFn = (a, b) => a > b;\n\t\tif (Match.test(sort, Object) && Match.test(sort.username, Number) && sort.username === -1) {\n\t\t\tsortFn = (a, b) => b < a;\n\t\t}\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult.usernames).sort(sortFn), {\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } }, {\n\t\t\tfields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 },\n\t\t\tsort: sort ? sort : { username: 1 }\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult._id });\n\n\t\t//Special check for the permissions\n\t\tif (RocketChat.authz.hasPermission(this.userId, 'view-joined-room') && !findResult.usernames.includes(this.user.username)) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t} else if (!RocketChat.authz.hasPermission(this.userId, 'view-c-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'c' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Channel does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tconst sub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(findResult._id, this.userId);\n\n\t\tif (!sub) {\n\t\t\treturn RocketChat.API.v1.failure(`The user/callee is not in the channel \"${ findResult.name }\".`);\n\t\t}\n\n\t\tif (sub.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is already open to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult._id, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: { roomId: this.bodyParams.roomId} });\n\n\t\tif (findResult.name === this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('The channel name is the same as what it would be renamed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.description) {\n\t\t\treturn RocketChat.API.v1.failure('The channel description is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setJoinCode', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.joinCode || !this.bodyParams.joinCode.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"joinCode\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'joinCode', this.bodyParams.joinCode);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.description === this.bodyParams.purpose) {\n\t\t\treturn RocketChat.API.v1.failure('The channel purpose (description) is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The channel read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.topic === this.bodyParams.topic) {\n\t\t\treturn RocketChat.API.v1.failure('The channel topic is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams() });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The channel type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult._id, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tchannel: RocketChat.models.Rooms.findOneById(findResult._id, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('channels.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findChannelByIdOrName({ params: this.requestParams(), checkedArchived: false });\n\n\t\tif (!findResult.archived) {\n\t\t\treturn RocketChat.API.v1.failure(`The channel, ${ findResult.name }, is not archived`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","RocketChat.API.v1.addRoute('rooms.get', { authRequired: true }, {\n\tget() {\n\t\tconst { updatedSince } = this.queryParams;\n\n\t\tlet updatedSinceDate;\n\t\tif (updatedSince) {\n\t\t\tif (isNaN(Date.parse(updatedSince))) {\n\t\t\t\tthrow new Meteor.Error('error-updatedSince-param-invalid', 'The \"updatedSince\" query parameter must be a valid date.');\n\t\t\t} else {\n\t\t\t\tupdatedSinceDate = new Date(updatedSince);\n\t\t\t}\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('rooms/get', updatedSinceDate));\n\n\t\tif (Array.isArray(result)) {\n\t\t\tresult = {\n\t\t\t\tupdate: result,\n\t\t\t\tremove: []\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('rooms.upload/:rid', { authRequired: true }, {\n\tpost() {\n\t\tconst room = Meteor.call('canAccessRoom', this.urlParams.rid, this.userId);\n\n\t\tif (!room) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst Busboy = Npm.require('busboy');\n\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\t\tconst files = [];\n\t\tconst fields = {};\n\n\t\tMeteor.wrapAsync((callback) => {\n\t\t\tbusboy.on('file', (fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\tif (fieldname !== 'file') {\n\t\t\t\t\treturn files.push(new Meteor.Error('invalid-field'));\n\t\t\t\t}\n\n\t\t\t\tconst fileDate = [];\n\t\t\t\tfile.on('data', data => fileDate.push(data));\n\n\t\t\t\tfile.on('end', () => {\n\t\t\t\t\tfiles.push({ fieldname, file, filename, encoding, mimetype, fileBuffer: Buffer.concat(fileDate) });\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tbusboy.on('field', (fieldname, value) => fields[fieldname] = value);\n\n\t\t\tbusboy.on('finish', Meteor.bindEnvironment(() => callback()));\n\n\t\t\tthis.request.pipe(busboy);\n\t\t})();\n\n\t\tif (files.length === 0) {\n\t\t\treturn RocketChat.API.v1.failure('File required');\n\t\t}\n\n\t\tif (files.length > 1) {\n\t\t\treturn RocketChat.API.v1.failure('Just 1 file is allowed');\n\t\t}\n\n\t\tconst file = files[0];\n\n\t\tconst fileStore = FileUpload.getStore('Uploads');\n\n\t\tconst details = {\n\t\t\tname: file.filename,\n\t\t\tsize: file.fileBuffer.length,\n\t\t\ttype: file.mimetype,\n\t\t\trid: this.urlParams.rid\n\t\t};\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tconst uploadedFile = Meteor.wrapAsync(fileStore.insert.bind(fileStore))(details, file.fileBuffer);\n\n\t\t\tuploadedFile.description = fields.description;\n\n\t\t\tdelete fields.description;\n\n\t\t\tRocketChat.API.v1.success(Meteor.call('sendFileMessage', this.urlParams.rid, null, uploadedFile, fields));\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","RocketChat.API.v1.addRoute('subscriptions.get', { authRequired: true }, {\n\tget() {\n\t\tconst { updatedSince } = this.queryParams;\n\n\t\tlet updatedSinceDate;\n\t\tif (updatedSince) {\n\t\t\tif (isNaN(Date.parse(updatedSince))) {\n\t\t\t\tthrow new Meteor.Error('error-roomId-param-invalid', 'The \"lastUpdate\" query parameter must be a valid date.');\n\t\t\t} else {\n\t\t\t\tupdatedSinceDate = new Date(updatedSince);\n\t\t\t}\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('subscriptions/get', updatedSinceDate));\n\n\t\tif (Array.isArray(result)) {\n\t\t\tresult = {\n\t\t\t\tupdate: result,\n\t\t\t\tremove: []\n\t\t\t};\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n","/* global processWebhookMessage */\nRocketChat.API.v1.addRoute('chat.delete', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tmsgId: String,\n\t\t\troomId: String,\n\t\t\tasUser: Match.Maybe(Boolean)\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId, { fields: { u: 1, rid: 1 }});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\tif (this.bodyParams.asUser && msg.u._id !== this.userId && !RocketChat.authz.hasPermission(Meteor.userId(), 'force-delete-message', msg.rid)) {\n\t\t\treturn RocketChat.API.v1.failure('Unauthorized. You must have the permission \"force-delete-message\" to delete other\\'s message as them.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.bodyParams.asUser ? msg.u._id : this.userId, () => {\n\t\t\tMeteor.call('deleteMessage', { _id: msg._id });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\t_id: msg._id,\n\t\t\tts: Date.now(),\n\t\t\tmessage: msg\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.syncMessages', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId, lastUpdate } = this.queryParams;\n\n\t\tif (!roomId) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-not-provided', 'The required \"roomId\" query param is missing.');\n\t\t}\n\n\t\tif (!lastUpdate) {\n\t\t\tthrow new Meteor.Error('error-lastUpdate-param-not-provided', 'The required \"lastUpdate\" query param is missing.');\n\t\t} else if (isNaN(Date.parse(lastUpdate))) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-invalid', 'The \"lastUpdate\" query parameter must be a valid date.');\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('messages/get', roomId, { lastUpdate: new Date(lastUpdate) });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tresult\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.getMessage', { authRequired: true }, {\n\tget() {\n\t\tif (!this.queryParams.msgId) {\n\t\t\treturn RocketChat.API.v1.failure('The \"msgId\" query parameter must be provided.');\n\t\t}\n\n\t\tlet msg;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tmsg = Meteor.call('getSingleMessage', this.queryParams.msgId);\n\t\t});\n\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: msg\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.pinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is missing.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tlet pinnedMessage;\n\t\tMeteor.runAsUser(this.userId, () => pinnedMessage = Meteor.call('pinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: pinnedMessage\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.postMessage', { authRequired: true }, {\n\tpost() {\n\t\tconst messageReturn = processWebhookMessage(this.bodyParams, this.user, undefined, true)[0];\n\n\t\tif (!messageReturn) {\n\t\t\treturn RocketChat.API.v1.failure('unknown-error');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tts: Date.now(),\n\t\t\tchannel: messageReturn.channel,\n\t\t\tmessage: messageReturn.message\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.search', { authRequired: true }, {\n\tget() {\n\t\tconst { roomId, searchText, limit } = this.queryParams;\n\n\t\tif (!roomId) {\n\t\t\tthrow new Meteor.Error('error-roomId-param-not-provided', 'The required \"roomId\" query param is missing.');\n\t\t}\n\n\t\tif (!searchText) {\n\t\t\tthrow new Meteor.Error('error-searchText-param-not-provided', 'The required \"searchText\" query param is missing.');\n\t\t}\n\n\t\tif (limit && (typeof limit !== 'number' || isNaN(limit) || limit <= 0)) {\n\t\t\tthrow new Meteor.Error('error-limit-param-invalid', 'The \"limit\" query parameter must be a valid number and be greater than 0.');\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('messageSearch', searchText, roomId, limit));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: result.messages\n\t\t});\n\t}\n});\n\n// The difference between `chat.postMessage` and `chat.sendMessage` is that `chat.sendMessage` allows\n// for passing a value for `_id` and the other one doesn't. Also, `chat.sendMessage` only sends it to\n// one channel whereas the other one allows for sending to more than one channel at a time.\nRocketChat.API.v1.addRoute('chat.sendMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.message) {\n\t\t\tthrow new Meteor.Error('error-invalid-params', 'The \"message\" parameter must be provided.');\n\t\t}\n\n\t\tlet message;\n\t\tMeteor.runAsUser(this.userId, () => message = Meteor.call('sendMessage', this.bodyParams.message));\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.starMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: true\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.unPinMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('unpinMessage', msg));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.unStarMessage', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.messageId || !this.bodyParams.messageId.trim()) {\n\t\t\tthrow new Meteor.Error('error-messageid-param-not-provided', 'The required \"messageId\" param is required.');\n\t\t}\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.messageId);\n\n\t\tif (!msg) {\n\t\t\tthrow new Meteor.Error('error-message-not-found', 'The provided \"messageId\" does not match any existing message.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => Meteor.call('starMessage', {\n\t\t\t_id: msg._id,\n\t\t\trid: msg.rid,\n\t\t\tstarred: false\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('chat.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\troomId: String,\n\t\t\tmsgId: String,\n\t\t\ttext: String //Using text to be consistant with chat.postMessage\n\t\t}));\n\n\t\tconst msg = RocketChat.models.Messages.findOneById(this.bodyParams.msgId);\n\n\t\t//Ensure the message exists\n\t\tif (!msg) {\n\t\t\treturn RocketChat.API.v1.failure(`No message found with the id of \"${ this.bodyParams.msgId }\".`);\n\t\t}\n\n\t\tif (this.bodyParams.roomId !== msg.rid) {\n\t\t\treturn RocketChat.API.v1.failure('The room id provided does not match where the message is from.');\n\t\t}\n\n\t\t//Permission checks are already done in the updateMessage method, so no need to duplicate them\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('updateMessage', { _id: msg._id, msg: this.bodyParams.text, rid: msg.rid });\n\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessage: RocketChat.models.Messages.findOneById(msg._id)\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('commands.get', { authRequired: true }, {\n\tget() {\n\t\tconst params = this.queryParams;\n\n\t\tif (typeof params.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The query param \"command\" must be provided.');\n\t\t}\n\n\t\tconst cmd = RocketChat.slashCommands.commands[params.command.toLowerCase()];\n\n\t\tif (!cmd) {\n\t\t\treturn RocketChat.API.v1.failure(`There is no command in the system by the name of: ${ params.command }`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ command: cmd });\n\t}\n});\n\nRocketChat.API.v1.addRoute('commands.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet commands = Object.values(RocketChat.slashCommands.commands);\n\n\t\tif (query && query.command) {\n\t\t\tcommands = commands.filter((command) => command.command === query.command);\n\t\t}\n\n\t\tconst totalCount = commands.length;\n\t\tcommands = RocketChat.models.Rooms.processQueryOptionsOnResult(commands, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tcommands,\n\t\t\toffset,\n\t\t\tcount: commands.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\n// Expects a body of: { command: 'gimme', params: 'any string value', roomId: 'value' }\nRocketChat.API.v1.addRoute('commands.run', { authRequired: true }, {\n\tpost() {\n\t\tconst body = this.bodyParams;\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (typeof body.command !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('You must provide a command to run.');\n\t\t}\n\n\t\tif (body.params && typeof body.params !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The parameters for the command must be a single string.');\n\t\t}\n\n\t\tif (typeof body.roomId !== 'string') {\n\t\t\treturn RocketChat.API.v1.failure('The room\\'s id where to execute this command must provided and be a string.');\n\t\t}\n\n\t\tconst cmd = body.command.toLowerCase();\n\t\tif (!RocketChat.slashCommands.commands[body.command.toLowerCase()]) {\n\t\t\treturn RocketChat.API.v1.failure('The command provided does not exist (or is disabled).');\n\t\t}\n\n\t\t// This will throw an error if they can't or the room is invalid\n\t\tMeteor.call('canAccessRoom', body.roomId, user._id);\n\n\t\tconst params = body.params ? body.params : '';\n\n\t\tlet result;\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tresult = RocketChat.slashCommands.run(cmd, params, {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: body.roomId,\n\t\t\t\tmsg: `/${ cmd } ${ params }`\n\t\t\t});\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({ result });\n\t}\n});\n","import _ from 'underscore';\n\n//Returns the private group subscription IF found otherwise it will return the failure of why it didn't. Check the `statusCode` property\nfunction findPrivateGroupByIdOrName({ params, userId, checkedArchived = true }) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.roomName || !params.roomName.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'The parameter \"roomId\" or \"roomName\" is required');\n\t}\n\n\tlet roomSub;\n\tif (params.roomId) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(params.roomId, userId);\n\t} else if (params.roomName) {\n\t\troomSub = RocketChat.models.Subscriptions.findOneByRoomNameAndUserId(params.roomName, userId);\n\t}\n\n\tif (!roomSub || roomSub.t !== 'p') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"roomName\" param provided does not match any group');\n\t}\n\n\tif (checkedArchived && roomSub.archived) {\n\t\tthrow new Meteor.Error('error-room-archived', `The private group, ${ roomSub.name }, is archived`);\n\t}\n\n\treturn roomSub;\n}\n\nRocketChat.API.v1.addRoute('groups.addAll', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addAllUserToRoom', findResult.rid, this.bodyParams.activeUsersOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.addLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst user = this.getUserFromParams();\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Archives a private group only if it wasn't\nRocketChat.API.v1.addRoute('groups.archive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('archiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.close', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (!findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//Create Private Group\nRocketChat.API.v1.addRoute('groups.create', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'create-p')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.bodyParams.name) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"name\" is required');\n\t\t}\n\n\t\tif (this.bodyParams.members && !_.isArray(this.bodyParams.members)) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"members\" must be an array if provided');\n\t\t}\n\n\t\tif (this.bodyParams.customFields && !(typeof this.bodyParams.customFields === 'object')) {\n\t\t\treturn RocketChat.API.v1.failure('Body param \"customFields\" must be an object if provided');\n\t\t}\n\n\t\tlet readOnly = false;\n\t\tif (typeof this.bodyParams.readOnly !== 'undefined') {\n\t\t\treadOnly = this.bodyParams.readOnly;\n\t\t}\n\n\t\tlet id;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tid = Meteor.call('createPrivateGroup', this.bodyParams.name, this.bodyParams.members ? this.bodyParams.members : [], readOnly, this.bodyParams.customFields);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(id.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.delete', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('eraseRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.processQueryOptionsOnResult([findResult._room], { fields: RocketChat.API.v1.defaultFieldsToExclude })[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.files', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.getIntegrations', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet includeAllPrivateGroups = true;\n\t\tif (typeof this.queryParams.includeAllPrivateGroups !== 'undefined') {\n\t\t\tincludeAllPrivateGroups = this.queryParams.includeAllPrivateGroups === 'true';\n\t\t}\n\n\t\tconst channelsToSearch = [`#${ findResult.name }`];\n\t\tif (includeAllPrivateGroups) {\n\t\t\tchannelsToSearch.push('all_private_groups');\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { channel: { $in: channelsToSearch } });\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _createdAt: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\tcount: integrations.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.history', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', { rid: findResult.rid, latest: latestDate, oldest: oldestDate, inclusive, count, unreads });\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.info', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.invite', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('addUserToRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.kick', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeUserFromRoom', { rid: findResult.rid, username: user.username });\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.leave', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('leaveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\n//List Private Groups a user has access to\nRocketChat.API.v1.addRoute('groups.list', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('p', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\n\nRocketChat.API.v1.addRoute('groups.listAll', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = RocketChat.models.Rooms.findByType('p').fetch();\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroups: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.members', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tlet sortFn = (a, b) => a > b;\n\t\tif (Match.test(sort, Object) && Match.test(sort.username, Number) && sort.username === -1) {\n\t\t\tsortFn = (a, b) => b < a;\n\t\t}\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult._room.usernames).sort(sortFn), {\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } }, {\n\t\t\tfields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 },\n\t\t\tsort: sort ? sort : { username: 1 }\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult._room.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.messages', { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.rid });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.online', { authRequired: true }, {\n\tget() {\n\t\tconst { query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { t: 'p' });\n\n\t\tconst room = RocketChat.models.Rooms.findOne(ourQuery);\n\n\t\tif (room == null) {\n\t\t\treturn RocketChat.API.v1.failure('Group does not exists');\n\t\t}\n\n\t\tconst online = RocketChat.models.Users.findUsersNotOffline({\n\t\t\tfields: {\n\t\t\t\tusername: 1\n\t\t\t}\n\t\t}).fetch();\n\n\t\tconst onlineInRoom = [];\n\t\tonline.forEach(user => {\n\t\t\tif (room.usernames.indexOf(user.username) !== -1) {\n\t\t\t\tonlineInRoom.push({\n\t\t\t\t\t_id: user._id,\n\t\t\t\t\tusername: user.username\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tonline: onlineInRoom\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.open', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tif (findResult.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The private group, ${ findResult.name }, is already open for the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('openRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeModerator', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomModerator', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeOwner', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomOwner', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.removeLeader', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('removeRoomLeader', findResult.rid, user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.rename', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.name || !this.bodyParams.name.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"name\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: { roomId: this.bodyParams.roomId}, userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomName', this.bodyParams.name);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setDescription', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.description || !this.bodyParams.description.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"description\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.description);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tdescription: this.bodyParams.description\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setPurpose', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.purpose || !this.bodyParams.purpose.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"purpose\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomDescription', this.bodyParams.purpose);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpurpose: this.bodyParams.purpose\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setReadOnly', { authRequired: true }, {\n\tpost() {\n\t\tif (typeof this.bodyParams.readOnly === 'undefined') {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"readOnly\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.ro === this.bodyParams.readOnly) {\n\t\t\treturn RocketChat.API.v1.failure('The private group read only setting is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'readOnly', this.bodyParams.readOnly);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setTopic', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.setType', { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.type || !this.bodyParams.type.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"type\" is required');\n\t\t}\n\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId });\n\n\t\tif (findResult.t === this.bodyParams.type) {\n\t\t\treturn RocketChat.API.v1.failure('The private group type is the same as what it would be changed to.');\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.rid, 'roomType', this.bodyParams.type);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tgroup: RocketChat.models.Rooms.findOneById(findResult.rid, { fields: RocketChat.API.v1.defaultFieldsToExclude })\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('groups.unarchive', { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findPrivateGroupByIdOrName({ params: this.requestParams(), userId: this.userId, checkedArchived: false });\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('unarchiveRoom', findResult.rid);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","import _ from 'underscore';\n\nfunction findDirectMessageRoom(params, user) {\n\tif ((!params.roomId || !params.roomId.trim()) && (!params.username || !params.username.trim())) {\n\t\tthrow new Meteor.Error('error-room-param-not-provided', 'Body param \"roomId\" or \"username\" is required');\n\t}\n\n\tconst room = RocketChat.getRoomByNameOrIdWithOptionToJoin({\n\t\tcurrentUserId: user._id,\n\t\tnameOrId: params.username || params.roomId,\n\t\ttype: 'd'\n\t});\n\n\tif (!room || room.t !== 'd') {\n\t\tthrow new Meteor.Error('error-room-not-found', 'The required \"roomId\" or \"username\" param provided does not match any dirct message');\n\t}\n\n\tconst subscription = RocketChat.models.Subscriptions.findOneByRoomIdAndUserId(room._id, user._id);\n\n\treturn {\n\t\troom,\n\t\tsubscription\n\t};\n}\n\nRocketChat.API.v1.addRoute(['dm.create', 'im.create'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\troom: findResult.room\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.close', 'im.close'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (!findResult.subscription.open) {\n\t\t\treturn RocketChat.API.v1.failure(`The direct message room, ${ this.bodyParams.name }, is already closed to the sender`);\n\t\t}\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('hideRoom', findResult.room._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.files', 'im.files'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst files = RocketChat.models.Uploads.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tfiles,\n\t\t\tcount: files.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Uploads.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.history', 'im.history'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tlet latestDate = new Date();\n\t\tif (this.queryParams.latest) {\n\t\t\tlatestDate = new Date(this.queryParams.latest);\n\t\t}\n\n\t\tlet oldestDate = undefined;\n\t\tif (this.queryParams.oldest) {\n\t\t\toldestDate = new Date(this.queryParams.oldest);\n\t\t}\n\n\t\tlet inclusive = false;\n\t\tif (this.queryParams.inclusive) {\n\t\t\tinclusive = this.queryParams.inclusive;\n\t\t}\n\n\t\tlet count = 20;\n\t\tif (this.queryParams.count) {\n\t\t\tcount = parseInt(this.queryParams.count);\n\t\t}\n\n\t\tlet unreads = false;\n\t\tif (this.queryParams.unreads) {\n\t\t\tunreads = this.queryParams.unreads;\n\t\t}\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getChannelHistory', {\n\t\t\t\trid: findResult.room._id,\n\t\t\t\tlatest: latestDate,\n\t\t\t\toldest: oldestDate,\n\t\t\t\tinclusive,\n\t\t\t\tcount,\n\t\t\t\tunreads\n\t\t\t});\n\t\t});\n\n\t\tif (!result) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(result);\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.members', 'im.members'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort } = this.parseJsonQuery();\n\n\t\tconst members = RocketChat.models.Rooms.processQueryOptionsOnResult(Array.from(findResult.room.usernames), {\n\t\t\tsort: sort ? sort : -1,\n\t\t\tskip: offset,\n\t\t\tlimit: count\n\t\t});\n\n\t\tconst users = RocketChat.models.Users.find({ username: { $in: members } },\n\t\t\t{ fields: { _id: 1, username: 1, name: 1, status: 1, utcOffset: 1 } }).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmembers: users,\n\t\t\tcount: members.length,\n\t\t\toffset,\n\t\t\ttotal: findResult.room.usernames.length\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages', 'im.messages'], { authRequired: true }, {\n\tget() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconsole.log(findResult);\n\t\tconst ourQuery = Object.assign({}, query, { rid: findResult.room._id });\n\n\t\tconst messages = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages,\n\t\t\tcount: messages.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.messages.others', 'im.messages.others'], { authRequired: true }, {\n\tget() {\n\t\tif (RocketChat.settings.get('API_Enable_Direct_Message_History_EndPoint') !== true) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/im.messages.others' });\n\t\t}\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst roomId = this.queryParams.roomId;\n\t\tif (!roomId || !roomId.trim()) {\n\t\t\tthrow new Meteor.Error('error-roomid-param-not-provided', 'The parameter \"roomId\" is required');\n\t\t}\n\n\t\tconst room = RocketChat.models.Rooms.findOneById(roomId);\n\t\tif (!room || room.t !== 'd') {\n\t\t\tthrow new Meteor.Error('error-room-not-found', `No direct message room found by the id of: ${ roomId }`);\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\t\tconst ourQuery = Object.assign({}, query, { rid: room._id });\n\n\t\tconst msgs = RocketChat.models.Messages.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tmessages: msgs,\n\t\t\toffset,\n\t\t\tcount: msgs.length,\n\t\t\ttotal: RocketChat.models.Messages.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list', 'im.list'], { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields } = this.parseJsonQuery();\n\t\tlet rooms = _.pluck(RocketChat.models.Subscriptions.findByTypeAndUserId('d', this.userId).fetch(), '_room');\n\t\tconst totalCount = rooms.length;\n\n\t\trooms = RocketChat.models.Rooms.processQueryOptionsOnResult(rooms, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: totalCount\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.list.everyone', 'im.list.everyone'], { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-room-administration')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { t: 'd' });\n\n\t\tconst rooms = RocketChat.models.Rooms.find(ourQuery, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tims: rooms,\n\t\t\toffset,\n\t\t\tcount: rooms.length,\n\t\t\ttotal: RocketChat.models.Rooms.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.open', 'im.open'], { authRequired: true }, {\n\tpost() {\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tif (!findResult.subscription.open) {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('openRoom', findResult.room._id);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute(['dm.setTopic', 'im.setTopic'], { authRequired: true }, {\n\tpost() {\n\t\tif (!this.bodyParams.topic || !this.bodyParams.topic.trim()) {\n\t\t\treturn RocketChat.API.v1.failure('The bodyParam \"topic\" is required');\n\t\t}\n\n\t\tconst findResult = findDirectMessageRoom(this.requestParams(), this.user);\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('saveRoomSettings', findResult.room._id, 'roomTopic', this.bodyParams.topic);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\ttopic: this.bodyParams.topic\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('integrations.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\tname: String,\n\t\t\tenabled: Boolean,\n\t\t\tusername: String,\n\t\t\turls: Match.Maybe([String]),\n\t\t\tchannel: String,\n\t\t\tevent: Match.Maybe(String),\n\t\t\ttriggerWords: Match.Maybe([String]),\n\t\t\talias: Match.Maybe(String),\n\t\t\tavatar: Match.Maybe(String),\n\t\t\temoji: Match.Maybe(String),\n\t\t\ttoken: Match.Maybe(String),\n\t\t\tscriptEnabled: Boolean,\n\t\t\tscript: Match.Maybe(String),\n\t\t\ttargetChannel: Match.Maybe(String)\n\t\t}));\n\n\t\tlet integration;\n\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addOutgoingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tintegration = Meteor.call('addIncomingIntegration', this.bodyParams);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ integration });\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.history', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tif (!this.queryParams.id || this.queryParams.id.trim() === '') {\n\t\t\treturn RocketChat.API.v1.failure('Invalid integration id.');\n\t\t}\n\n\t\tconst id = this.queryParams.id;\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query, { 'integration._id': id });\n\t\tconst history = RocketChat.models.IntegrationHistory.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _updatedAt: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\thistory,\n\t\t\toffset,\n\t\t\titems: history.length,\n\t\t\ttotal: RocketChat.models.IntegrationHistory.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'manage-integrations')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst ourQuery = Object.assign({}, query);\n\t\tconst integrations = RocketChat.models.Integrations.find(ourQuery, {\n\t\t\tsort: sort ? sort : { ts: -1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tintegrations,\n\t\t\toffset,\n\t\t\titems: integrations.length,\n\t\t\ttotal: RocketChat.models.Integrations.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('integrations.remove', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\ttype: String,\n\t\t\ttarget_url: Match.Maybe(String),\n\t\t\tintegrationId: Match.Maybe(String)\n\t\t}));\n\n\t\tif (!this.bodyParams.target_url && !this.bodyParams.integrationId) {\n\t\t\treturn RocketChat.API.v1.failure('An integrationId or target_url needs to be provided.');\n\t\t}\n\n\t\tlet integration;\n\t\tswitch (this.bodyParams.type) {\n\t\t\tcase 'webhook-outgoing':\n\t\t\t\tif (this.bodyParams.target_url) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ urls: this.bodyParams.target_url });\n\t\t\t\t} else if (this.bodyParams.integrationId) {\n\t\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\t\t\t\t}\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteOutgoingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tcase 'webhook-incoming':\n\t\t\t\tintegration = RocketChat.models.Integrations.findOne({ _id: this.bodyParams.integrationId });\n\n\t\t\t\tif (!integration) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('No integration found.');\n\t\t\t\t}\n\n\t\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\t\tMeteor.call('deleteIncomingIntegration', integration._id);\n\t\t\t\t});\n\n\t\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\t\tintegration\n\t\t\t\t});\n\t\t\tdefault:\n\t\t\t\treturn RocketChat.API.v1.failure('Invalid integration type.');\n\t\t}\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.API.v1.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tinfo: {\n\t\t\t\t'version': RocketChat.Info.version\n\t\t\t}\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('me', { authRequired: true }, {\n\tget() {\n\t\tconst me = _.pick(this.user, [\n\t\t\t'_id',\n\t\t\t'name',\n\t\t\t'emails',\n\t\t\t'status',\n\t\t\t'statusConnection',\n\t\t\t'username',\n\t\t\t'utcOffset',\n\t\t\t'active',\n\t\t\t'language'\n\t\t]);\n\n\t\tconst verifiedEmail = me.emails.find((email) => email.verified);\n\n\t\tme.email = verifiedEmail ? verifiedEmail.address : undefined;\n\n\t\treturn RocketChat.API.v1.success(me);\n\t}\n});\n\nlet onlineCache = 0;\nlet onlineCacheDate = 0;\nconst cacheInvalid = 60000; // 1 minute\nRocketChat.API.v1.addRoute('shield.svg', { authRequired: false }, {\n\tget() {\n\t\tconst { type, channel, name, icon } = this.queryParams;\n\t\tif (!RocketChat.settings.get('API_Enable_Shields')) {\n\t\t\tthrow new Meteor.Error('error-endpoint-disabled', 'This endpoint is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst types = RocketChat.settings.get('API_Shield_Types');\n\t\tif (type && (types !== '*' && !types.split(',').map((t) => t.trim()).includes(type))) {\n\t\t\tthrow new Meteor.Error('error-shield-disabled', 'This shield type is disabled', { route: '/api/v1/shields.svg' });\n\t\t}\n\t\tconst hideIcon = icon === 'false';\n\t\tif (hideIcon && (!name || !name.trim())) {\n\t\t\treturn RocketChat.API.v1.failure('Name cannot be empty when icon is hidden');\n\t\t}\n\t\tlet text;\n\t\tswitch (type) {\n\t\t\tcase 'online':\n\t\t\t\tif (Date.now() - onlineCacheDate > cacheInvalid) {\n\t\t\t\t\tonlineCache = RocketChat.models.Users.findUsersNotOffline().count();\n\t\t\t\t\tonlineCacheDate = Date.now();\n\t\t\t\t}\n\t\t\t\ttext = `${ onlineCache } ${ TAPi18n.__('Online') }`;\n\t\t\t\tbreak;\n\t\t\tcase 'channel':\n\t\t\t\tif (!channel) {\n\t\t\t\t\treturn RocketChat.API.v1.failure('Shield channel is required for type \"channel\"');\n\t\t\t\t}\n\t\t\t\ttext = `#${ channel }`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\ttext = TAPi18n.__('Join_Chat').toUpperCase();\n\t\t}\n\t\tconst iconSize = hideIcon ? 7 : 24;\n\t\tconst leftSize = name ? name.length * 6 + 7 + iconSize : iconSize;\n\t\tconst rightSize = text.length * 6 + 20;\n\t\tconst width = leftSize + rightSize;\n\t\tconst height = 20;\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'image/svg+xml;charset=utf-8' },\n\t\t\tbody: `\n\t\t\t\t<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"${ width }\" height=\"${ height }\">\n\t\t\t\t  <linearGradient id=\"b\" x2=\"0\" y2=\"100%\">\n\t\t\t\t    <stop offset=\"0\" stop-color=\"#bbb\" stop-opacity=\".1\"/>\n\t\t\t\t    <stop offset=\"1\" stop-opacity=\".1\"/>\n\t\t\t\t  </linearGradient>\n\t\t\t\t  <mask id=\"a\">\n\t\t\t\t    <rect width=\"${ width }\" height=\"${ height }\" rx=\"3\" fill=\"#fff\"/>\n\t\t\t\t  </mask>\n\t\t\t\t  <g mask=\"url(#a)\">\n\t\t\t\t    <path fill=\"#555\" d=\"M0 0h${ leftSize }v${ height }H0z\"/>\n\t\t\t\t    <path fill=\"#4c1\" d=\"M${ leftSize } 0h${ rightSize }v${ height }H${ leftSize }z\"/>\n\t\t\t\t    <path fill=\"url(#b)\" d=\"M0 0h${ width }v${ height }H0z\"/>\n\t\t\t\t  </g>\n\t\t\t\t    ${ hideIcon ? '' : '<image x=\"5\" y=\"3\" width=\"14\" height=\"14\" xlink:href=\"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfNSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCIgdmlld0JveD0iMCAwIDUxMiA1MTIiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDUxMiA1MTIiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxwYXRoIGZpbGw9IiNDMTI3MkQiIGQ9Ik01MDIuNTg2LDI1NS4zMjJjMC0yNS4yMzYtNy41NS00OS40MzYtMjIuNDQ1LTcxLjkzMmMtMTMuMzczLTIwLjE5NS0zMi4xMDktMzguMDcyLTU1LjY4Ny01My4xMzJDMzc4LjkzNywxMDEuMTgyLDMxOS4xMDgsODUuMTY4LDI1Niw4NS4xNjhjLTIxLjA3OSwwLTQxLjg1NSwxLjc4MS02Mi4wMDksNS4zMWMtMTIuNTA0LTExLjcwMi0yNy4xMzktMjIuMjMyLTQyLjYyNy0zMC41NkM2OC42MTgsMTkuODE4LDAsNTguOTc1LDAsNTguOTc1czYzLjc5OCw1Mi40MDksNTMuNDI0LDk4LjM1Yy0yOC41NDIsMjguMzEzLTQ0LjAxLDYyLjQ1My00NC4wMSw5Ny45OThjMCwwLjExMywwLjAwNiwwLjIyNiwwLjAwNiwwLjM0YzAsMC4xMTMtMC4wMDYsMC4yMjYtMC4wMDYsMC4zMzljMCwzNS41NDUsMTUuNDY5LDY5LjY4NSw0NC4wMSw5Ny45OTlDNjMuNzk4LDM5OS45NCwwLDQ1Mi4zNSwwLDQ1Mi4zNXM2OC42MTgsMzkuMTU2LDE1MS4zNjMtMC45NDNjMTUuNDg4LTguMzI3LDMwLjEyNC0xOC44NTcsNDIuNjI3LTMwLjU2YzIwLjE1NCwzLjUyOCw0MC45MzEsNS4zMSw2Mi4wMDksNS4zMWM2My4xMDgsMCwxMjIuOTM3LTE2LjAxNCwxNjguNDU0LTQ1LjA5MWMyMy41NzctMTUuMDYsNDIuMzEzLTMyLjkzNyw1NS42ODctNTMuMTMyYzE0Ljg5Ni0yMi40OTYsMjIuNDQ1LTQ2LjY5NSwyMi40NDUtNzEuOTMyYzAtMC4xMTMtMC4wMDYtMC4yMjYtMC4wMDYtMC4zMzlDNTAyLjU4LDI1NS41NDgsNTAyLjU4NiwyNTUuNDM2LDUwMi41ODYsMjU1LjMyMnoiLz48cGF0aCBmaWxsPSIjRkZGRkZGIiBkPSJNMjU2LDEyMC44NDdjMTE2Ljg1NCwwLDIxMS41ODYsNjAuNTA5LDIxMS41ODYsMTM1LjE1NGMwLDc0LjY0MS05NC43MzEsMTM1LjE1NS0yMTEuNTg2LDEzNS4xNTVjLTI2LjAxOSwwLTUwLjkzNy0zLjAwOS03My45NTktOC40OTVjLTIzLjM5NiwyOC4xNDctNzQuODY4LDY3LjI4LTEyNC44NjksNTQuNjI5YzE2LjI2NS0xNy40Nyw0MC4zNjEtNDYuOTg4LDM1LjIwMS05NS42MDNjLTI5Ljk2OC0yMy4zMjItNDcuOTU5LTUzLjE2My00Ny45NTktODUuNjg2QzQ0LjQxNCwxODEuMzU2LDEzOS4xNDUsMTIwLjg0NywyNTYsMTIwLjg0NyIvPjxnPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjI1NiIgY3k9IjI2MC4zNTIiIHI9IjI4LjEwNSIvPjwvZz48Zz48Y2lyY2xlIGZpbGw9IiNDMTI3MkQiIGN4PSIzNTMuNzI4IiBjeT0iMjYwLjM1MiIgcj0iMjguMTA0Ii8+PC9nPjxnPjxjaXJjbGUgZmlsbD0iI0MxMjcyRCIgY3g9IjE1OC4yNzIiIGN5PSIyNjAuMzUyIiByPSIyOC4xMDUiLz48L2c+PC9nPjxnPjxwYXRoIGZpbGw9IiNDQ0NDQ0MiIGQ9Ik0yNTYsMzczLjM3M2MtMjYuMDE5LDAtNTAuOTM3LTIuNjA3LTczLjk1OS03LjM2MmMtMjAuNjU5LDIxLjU0LTYzLjIwOSw1MC40OTYtMTA3LjMwNyw0OS40M2MtNS44MDYsOC44MDUtMTIuMTIxLDE2LjAwNi0xNy41NjIsMjEuODVjNTAsMTIuNjUxLDEwMS40NzMtMjYuNDgxLDEyNC44NjktNTQuNjI5YzIzLjAyMyw1LjQ4Niw0Ny45NDEsOC40OTUsNzMuOTU5LDguNDk1YzExNS45MTcsMCwyMTAuMDQ4LTU5LjU1LDIxMS41NTEtMTMzLjM2NEM0NjYuMDQ4LDMyMS43NjUsMzcxLjkxNywzNzMuMzczLDI1NiwzNzMuMzczeiIvPjwvZz48L3N2Zz4=\"/>' }\n\t\t\t\t  <g fill=\"#fff\" font-family=\"DejaVu Sans,Verdana,Geneva,sans-serif\" font-size=\"11\">\n\t\t\t\t\t\t${ name ? `<text x=\"${ iconSize }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ name }</text>\n\t\t\t\t    <text x=\"${ iconSize }\" y=\"14\">${ name }</text>` : '' }\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"15\" fill=\"#010101\" fill-opacity=\".3\">${ text }</text>\n\t\t\t\t    <text x=\"${ leftSize + 7 }\" y=\"14\">${ text }</text>\n\t\t\t\t  </g>\n\t\t\t\t</svg>\n\t\t\t`.trim().replace(/\\>[\\s]+\\</gm, '><')\n\t\t};\n\t}\n});\n","/* globals Push */\n\nRocketChat.API.v1.addRoute('push.token', { authRequired: true }, {\n\tpost() {\n\t\tconst { type, value, appName } = this.bodyParams;\n\t\tlet { id } = this.bodyParams;\n\n\t\tif (id && typeof id !== 'string') {\n\t\t\tthrow new Meteor.Error('error-id-param-not-valid', 'The required \"id\" body param is invalid.');\n\t\t} else {\n\t\t\tid = Random.id();\n\t\t}\n\n\t\tif (!type || (type !== 'apn' && type !== 'gcm')) {\n\t\t\tthrow new Meteor.Error('error-type-param-not-valid', 'The required \"type\" body param is missing or invalid.');\n\t\t}\n\n\t\tif (!value || typeof value !== 'string') {\n\t\t\tthrow new Meteor.Error('error-token-param-not-valid', 'The required \"token\" body param is missing or invalid.');\n\t\t}\n\n\t\tif (!appName || typeof appName !== 'string') {\n\t\t\tthrow new Meteor.Error('error-appName-param-not-valid', 'The required \"appName\" body param is missing or invalid.');\n\t\t}\n\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => result = Meteor.call('raix:push-update', {\n\t\t\tid,\n\t\t\ttoken: { [type]: value },\n\t\t\tappName,\n\t\t\tuserId: this.userId\n\t\t}));\n\n\t\treturn RocketChat.API.v1.success({ result });\n\t},\n\tdelete() {\n\t\tconst { token } = this.bodyParams;\n\n\t\tif (!token || typeof token !== 'string') {\n\t\t\tthrow new Meteor.Error('error-token-param-not-valid', 'The required \"token\" body param is missing or invalid.');\n\t\t}\n\n\t\tconst affectedRecords = Push.appCollection.remove({\n\t\t\t$or: [{\n\t\t\t\t'token.apn': token\n\t\t\t}, {\n\t\t\t\t'token.gcm': token\n\t\t\t}],\n\t\t\tuserId: this.userId\n\t\t});\n\n\t\tif (affectedRecords === 0) {\n\t\t\treturn RocketChat.API.v1.notFound();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n","import _ from 'underscore';\n\n// settings endpoints\nRocketChat.API.v1.addRoute('settings.public', { authRequired: false }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true },\n\t\t\t'public': true\n\t\t};\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings', { authRequired: true }, {\n\tget() {\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tlet ourQuery = {\n\t\t\thidden: { $ne: true }\n\t\t};\n\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\tourQuery.public = true;\n\t\t}\n\n\t\tourQuery = Object.assign({}, query, ourQuery);\n\n\t\tconst settings = RocketChat.models.Settings.find(ourQuery, {\n\t\t\tsort: sort ? sort : { _id: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields: Object.assign({ _id: 1, value: 1 }, fields)\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tsettings,\n\t\t\tcount: settings.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Settings.find(ourQuery).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('settings/:_id', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success(_.pick(RocketChat.models.Settings.findOneNotHiddenById(this.urlParams._id), '_id', 'value'));\n\t},\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'edit-privileged-setting')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tcheck(this.bodyParams, {\n\t\t\tvalue: Match.Any\n\t\t});\n\n\t\tif (RocketChat.models.Settings.updateValueNotHiddenById(this.urlParams._id, this.bodyParams.value)) {\n\t\t\treturn RocketChat.API.v1.success();\n\t\t}\n\n\t\treturn RocketChat.API.v1.failure();\n\t}\n});\n\nRocketChat.API.v1.addRoute('service.configurations', { authRequired: false }, {\n\tget() {\n\t\tconst ServiceConfiguration = Package['service-configuration'].ServiceConfiguration;\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tconfigurations: ServiceConfiguration.configurations.find({}, {fields: {secret: 0}}).fetch()\n\t\t});\n\t}\n});\n","RocketChat.API.v1.addRoute('statistics', { authRequired: true }, {\n\tget() {\n\t\tlet refresh = false;\n\t\tif (typeof this.queryParams.refresh !== 'undefined' && this.queryParams.refresh === 'true') {\n\t\t\trefresh = true;\n\t\t}\n\n\t\tlet stats;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tstats = Meteor.call('getStatistics', refresh);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics: stats\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('statistics.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-statistics')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst statistics = RocketChat.models.Statistics.find(query, {\n\t\t\tsort: sort ? sort : { name: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tstatistics,\n\t\t\tcount: statistics.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Statistics.find(query).count()\n\t\t});\n\t}\n});\n","import _ from 'underscore';\n\nRocketChat.API.v1.addRoute('users.create', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\temail: String,\n\t\t\tname: String,\n\t\t\tpassword: String,\n\t\t\tusername: String,\n\t\t\tactive: Match.Maybe(Boolean),\n\t\t\troles: Match.Maybe(Array),\n\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\tverified: Match.Maybe(Boolean),\n\t\t\tcustomFields: Match.Maybe(Object)\n\t\t});\n\n\t\t//New change made by pull request #5152\n\t\tif (typeof this.bodyParams.joinDefaultChannels === 'undefined') {\n\t\t\tthis.bodyParams.joinDefaultChannels = true;\n\t\t}\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.validateCustomFields(this.bodyParams.customFields);\n\t\t}\n\n\t\tconst newUserId = RocketChat.saveUser(this.userId, this.bodyParams);\n\n\t\tif (this.bodyParams.customFields) {\n\t\t\tRocketChat.saveCustomFieldsWithoutValidation(newUserId, this.bodyParams.customFields);\n\t\t}\n\n\n\t\tif (typeof this.bodyParams.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', newUserId, this.bodyParams.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(newUserId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.delete', { authRequired: true }, {\n\tpost() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'delete-user')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tMeteor.call('deleteUser', user._id);\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getAvatar', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tconst url = RocketChat.getURL(`/avatar/${ user.username }`, { cdn: false, full: true });\n\t\tthis.response.setHeader('Location', url);\n\n\t\treturn {\n\t\t\tstatusCode: 307,\n\t\t\tbody: url\n\t\t};\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.getPresence', { authRequired: true }, {\n\tget() {\n\t\tif (this.isUserFromParams()) {\n\t\t\tconst user = RocketChat.models.Users.findOneById(this.userId);\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tpresence: user.status,\n\t\t\t\tconnectionStatus: user.statusConnection,\n\t\t\t\tlastLogin: user.lastLogin\n\t\t\t});\n\t\t}\n\n\t\tconst user = this.getUserFromParams();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tpresence: user.status\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.info', { authRequired: true }, {\n\tget() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tlet result;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tresult = Meteor.call('getFullUserData', { filter: user.username, limit: 1 });\n\t\t});\n\n\t\tif (!result || result.length !== 1) {\n\t\t\treturn RocketChat.API.v1.failure(`Failed to get the user data for the userId of \"${ user._id }\".`);\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tuser: result[0]\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.list', { authRequired: true }, {\n\tget() {\n\t\tif (!RocketChat.authz.hasPermission(this.userId, 'view-d-room')) {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tconst { offset, count } = this.getPaginationItems();\n\t\tconst { sort, fields, query } = this.parseJsonQuery();\n\n\t\tconst users = RocketChat.models.Users.find(query, {\n\t\t\tsort: sort ? sort : { username: 1 },\n\t\t\tskip: offset,\n\t\t\tlimit: count,\n\t\t\tfields\n\t\t}).fetch();\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tusers,\n\t\t\tcount: users.length,\n\t\t\toffset,\n\t\t\ttotal: RocketChat.models.Users.find(query).count()\n\t\t});\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.register', { authRequired: false }, {\n\tpost() {\n\t\tif (this.userId) {\n\t\t\treturn RocketChat.API.v1.failure('Logged in users can not register again.');\n\t\t}\n\n\t\t//We set their username here, so require it\n\t\t//The `registerUser` checks for the other requirements\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tusername: String\n\t\t}));\n\n\t\t//Register the user\n\t\tconst userId = Meteor.call('registerUser', this.bodyParams);\n\n\t\t//Now set their username\n\t\tMeteor.runAsUser(userId, () => Meteor.call('setUsername', this.bodyParams.username));\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.resetAvatar', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\n\t\tif (user._id === this.userId) {\n\t\t\tMeteor.runAsUser(this.userId, () => Meteor.call('resetAvatar'));\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tMeteor.runAsUser(user._id, () => Meteor.call('resetAvatar'));\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.setAvatar', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, Match.ObjectIncluding({\n\t\t\tavatarUrl: Match.Maybe(String),\n\t\t\tuserId: Match.Maybe(String),\n\t\t\tusername: Match.Maybe(String)\n\t\t}));\n\n\t\tlet user;\n\t\tif (this.isUserFromParams()) {\n\t\t\tuser = Meteor.users.findOne(this.userId);\n\t\t} else if (RocketChat.authz.hasPermission(this.userId, 'edit-other-user-info')) {\n\t\t\tuser = this.getUserFromParams();\n\t\t} else {\n\t\t\treturn RocketChat.API.v1.unauthorized();\n\t\t}\n\n\t\tMeteor.runAsUser(user._id, () => {\n\t\t\tif (this.bodyParams.avatarUrl) {\n\t\t\t\tRocketChat.setUserAvatar(user, this.bodyParams.avatarUrl, '', 'url');\n\t\t\t} else {\n\t\t\t\tconst Busboy = Npm.require('busboy');\n\t\t\t\tconst busboy = new Busboy({ headers: this.request.headers });\n\n\t\t\t\tMeteor.wrapAsync((callback) => {\n\t\t\t\t\tbusboy.on('file', Meteor.bindEnvironment((fieldname, file, filename, encoding, mimetype) => {\n\t\t\t\t\t\tif (fieldname !== 'image') {\n\t\t\t\t\t\t\treturn callback(new Meteor.Error('invalid-field'));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst imageData = [];\n\t\t\t\t\t\tfile.on('data', Meteor.bindEnvironment((data) => {\n\t\t\t\t\t\t\timageData.push(data);\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t\tfile.on('end', Meteor.bindEnvironment(() => {\n\t\t\t\t\t\t\tRocketChat.setUserAvatar(user, Buffer.concat(imageData), mimetype, 'rest');\n\t\t\t\t\t\t\tcallback();\n\t\t\t\t\t\t}));\n\n\t\t\t\t\t}));\n\t\t\t\t\tthis.request.pipe(busboy);\n\t\t\t\t})();\n\t\t\t}\n\t\t});\n\n\t\treturn RocketChat.API.v1.success();\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.update', { authRequired: true }, {\n\tpost() {\n\t\tcheck(this.bodyParams, {\n\t\t\tuserId: String,\n\t\t\tdata: Match.ObjectIncluding({\n\t\t\t\temail: Match.Maybe(String),\n\t\t\t\tname: Match.Maybe(String),\n\t\t\t\tpassword: Match.Maybe(String),\n\t\t\t\tusername: Match.Maybe(String),\n\t\t\t\tactive: Match.Maybe(Boolean),\n\t\t\t\troles: Match.Maybe(Array),\n\t\t\t\tjoinDefaultChannels: Match.Maybe(Boolean),\n\t\t\t\trequirePasswordChange: Match.Maybe(Boolean),\n\t\t\t\tsendWelcomeEmail: Match.Maybe(Boolean),\n\t\t\t\tverified: Match.Maybe(Boolean),\n\t\t\t\tcustomFields: Match.Maybe(Object)\n\t\t\t})\n\t\t});\n\n\t\tconst userData = _.extend({ _id: this.bodyParams.userId }, this.bodyParams.data);\n\n\t\tMeteor.runAsUser(this.userId, () => RocketChat.saveUser(this.userId, userData));\n\n\t\tif (this.bodyParams.data.customFields) {\n\t\t\tRocketChat.saveCustomFields(this.bodyParams.userId, this.bodyParams.data.customFields);\n\t\t}\n\n\t\tif (typeof this.bodyParams.data.active !== 'undefined') {\n\t\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\t\tMeteor.call('setUserActiveStatus', this.bodyParams.userId, this.bodyParams.data.active);\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({ user: RocketChat.models.Users.findOneById(this.bodyParams.userId, { fields: RocketChat.API.v1.defaultFieldsToExclude }) });\n\t}\n});\n\nRocketChat.API.v1.addRoute('users.createToken', { authRequired: true }, {\n\tpost() {\n\t\tconst user = this.getUserFromParams();\n\t\tlet data;\n\t\tMeteor.runAsUser(this.userId, () => {\n\t\t\tdata = Meteor.call('createToken', user._id);\n\t\t});\n\t\treturn data ? RocketChat.API.v1.success({data}) : RocketChat.API.v1.unauthorized();\n\t}\n});\n","RocketChat.API.default.helperMethods.set('getLoggedInUser', function _getLoggedInUser() {\n\tlet user;\n\n\tif (this.request.headers['x-auth-token'] && this.request.headers['x-user-id']) {\n\t\tuser = RocketChat.models.Users.findOne({\n\t\t\t'_id': this.request.headers['x-user-id'],\n\t\t\t'services.resume.loginTokens.hashedToken': Accounts._hashLoginToken(this.request.headers['x-auth-token'])\n\t\t});\n\t}\n\n\treturn user;\n});\n","RocketChat.API.default.addRoute('info', { authRequired: false }, {\n\tget() {\n\t\tconst user = this.getLoggedInUser();\n\n\t\tif (user && RocketChat.authz.hasRole(user._id, 'admin')) {\n\t\t\treturn RocketChat.API.v1.success({\n\t\t\t\tinfo: RocketChat.Info\n\t\t\t});\n\t\t}\n\n\t\treturn RocketChat.API.v1.success({\n\t\t\tversion: RocketChat.Info.version\n\t\t});\n\t}\n});\n","RocketChat.API.default.addRoute('metrics', { authRequired: false }, {\n\tget() {\n\t\treturn {\n\t\t\theaders: { 'Content-Type': 'text/plain' },\n\t\t\tbody: RocketChat.promclient.register.metrics()\n\t\t};\n\t}\n});\n"]}