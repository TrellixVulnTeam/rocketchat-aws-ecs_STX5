{"version":3,"sources":["meteor://ðŸ’»app/packages/rocketchat:slashcommands-invite-all/server/server.js"],"names":["inviteAll","type","command","params","item","test","Match","String","regexp","channel","exec","trim","currentUser","Meteor","users","findOne","userId","baseChannel","RocketChat","models","Rooms","findOneById","rid","findOneByName","targetChannel","Notifications","notifyUser","_id","Random","id","ts","Date","msg","TAPi18n","__","postProcess","sprintf","language","usernames","length","settings","get","Error","method","indexOf","t","call","e","error","slashCommands","add","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;;;GAKA,SAASA,SAAT,CAAmBC,IAAnB,EAAyB;AAExB,QAAO,SAASD,SAAT,CAAmBE,OAAnB,EAA4BC,MAA5B,EAAoCC,IAApC,EAA0C;AAEhD,MAAI,CAAC,wBAAwBC,IAAxB,CAA6BH,OAA7B,CAAD,IAA0C,CAACI,MAAMD,IAAN,CAAWF,MAAX,EAAmBI,MAAnB,CAA/C,EAA2E;AAC1E;AACA;;AAED,QAAMC,SAAS,gBAAf;AACA,QAAM,GAAGC,OAAH,IAAcD,OAAOE,IAAP,CAAYP,OAAOQ,IAAP,EAAZ,CAApB;;AAEA,MAAI,CAACF,OAAL,EAAc;AACb;AACA;;AAED,QAAMG,cAAcC,OAAOC,KAAP,CAAaC,OAAb,CAAqBF,OAAOG,MAAP,EAArB,CAApB;AACA,QAAMC,cAAchB,SAAS,IAAT,GAAgBiB,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoCjB,KAAKkB,GAAzC,CAAhB,GAAgEJ,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBG,aAAxB,CAAsCd,OAAtC,CAApF;AACA,QAAMe,gBAAgBvB,SAAS,MAAT,GAAkBiB,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBC,WAAxB,CAAoCjB,KAAKkB,GAAzC,CAAlB,GAAkEJ,WAAWC,MAAX,CAAkBC,KAAlB,CAAwBG,aAAxB,CAAsCd,OAAtC,CAAxF;;AAEA,MAAI,CAACQ,WAAL,EAAkB;AACjB,UAAOC,WAAWO,aAAX,CAAyBC,UAAzB,CAAoCb,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AACtEW,SAAKC,OAAOC,EAAP,EADiE;AAEtEP,SAAKlB,KAAKkB,GAF4D;AAGtEQ,QAAI,IAAIC,IAAJ,EAHkE;AAItEC,SAAKC,QAAQC,EAAR,CAAW,sBAAX,EAAmC;AACvCC,kBAAa,SAD0B;AAEvCC,cAAS,CAAC3B,OAAD;AAF8B,KAAnC,EAGFG,YAAYyB,QAHV;AAJiE,IAAhE,CAAP;AASA;;AACD,QAAMvB,QAAQG,YAAYqB,SAAZ,IAAyB,EAAvC;;AAEA,MAAI;AACH,OAAIxB,MAAMyB,MAAN,GAAerB,WAAWsB,QAAX,CAAoBC,GAApB,CAAwB,gBAAxB,CAAnB,EAA8D;AAC7D,UAAM,IAAI5B,OAAO6B,KAAX,CAAiB,2BAAjB,EAA8C,qBAA9C,EAAqE;AAC1EC,aAAQ;AADkE,KAArE,CAAN;AAGA;;AAED,OAAI,CAACnB,aAAD,IAAkB,CAAC,GAAD,EAAM,GAAN,EAAWoB,OAAX,CAAmB3B,YAAY4B,CAA/B,IAAoC,CAAC,CAA3D,EAA8D;AAC7DhC,WAAOiC,IAAP,CAAY7B,YAAY4B,CAAZ,KAAkB,GAAlB,GAAwB,eAAxB,GAA0C,oBAAtD,EAA4EpC,OAA5E,EAAqFK,KAArF;AACAI,eAAWO,aAAX,CAAyBC,UAAzB,CAAoCb,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DW,UAAKC,OAAOC,EAAP,EAD0D;AAE/DP,UAAKlB,KAAKkB,GAFqD;AAG/DQ,SAAI,IAAIC,IAAJ,EAH2D;AAI/DC,UAAKC,QAAQC,EAAR,CAAW,iBAAX,EAA8B;AAClCC,mBAAa,SADqB;AAElCC,eAAS,CAAC3B,OAAD;AAFyB,MAA9B,EAGFG,YAAYyB,QAHV;AAJ0D,KAAhE;AASA,IAXD,MAWO;AACNxB,WAAOiC,IAAP,CAAY,gBAAZ,EAA8B;AAC7BxB,UAAKE,cAAcG,GADU;AAE7Bb;AAF6B,KAA9B;AAIA;;AACD,UAAOI,WAAWO,aAAX,CAAyBC,UAAzB,CAAoCb,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AACtEW,SAAKC,OAAOC,EAAP,EADiE;AAEtEP,SAAKlB,KAAKkB,GAF4D;AAGtEQ,QAAI,IAAIC,IAAJ,EAHkE;AAItEC,SAAKC,QAAQC,EAAR,CAAW,aAAX,EAA0B,IAA1B,EAAgCtB,YAAYyB,QAA5C;AAJiE,IAAhE,CAAP;AAMA,GA9BD,CA8BE,OAAOU,CAAP,EAAU;AACX,SAAMf,MAAMe,EAAEC,KAAF,KAAY,6BAAZ,GAA4C,qCAA5C,GAAoFD,EAAEC,KAAlG;AACA9B,cAAWO,aAAX,CAAyBC,UAAzB,CAAoCb,OAAOG,MAAP,EAApC,EAAqD,SAArD,EAAgE;AAC/DW,SAAKC,OAAOC,EAAP,EAD0D;AAE/DP,SAAKlB,KAAKkB,GAFqD;AAG/DQ,QAAI,IAAIC,IAAJ,EAH2D;AAI/DC,SAAKC,QAAQC,EAAR,CAAWF,GAAX,EAAgB,IAAhB,EAAsBpB,YAAYyB,QAAlC;AAJ0D,IAAhE;AAMA;AACD,EArED;AAsEA;;AACDnB,WAAW+B,aAAX,CAAyBC,GAAzB,CAA6B,eAA7B,EAA8ClD,UAAU,IAAV,CAA9C;AACAkB,WAAW+B,aAAX,CAAyBC,GAAzB,CAA6B,iBAA7B,EAAgDlD,UAAU,MAAV,CAAhD;AACAmD,OAAOC,OAAP,GAAiBpD,SAAjB,C","file":"/packages/rocketchat_slashcommands-invite-all.js","sourcesContent":["/*\n * Invite is a named function that will replace /invite commands\n * @param {Object} message - The message object\n */\n\nfunction inviteAll(type) {\n\n\treturn function inviteAll(command, params, item) {\n\n\t\tif (!/invite\\-all-(to|from)/.test(command) || !Match.test(params, String)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst regexp = /#?([\\d-_\\w]+)/g;\n\t\tconst [, channel] = regexp.exec(params.trim());\n\n\t\tif (!channel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst currentUser = Meteor.users.findOne(Meteor.userId());\n\t\tconst baseChannel = type === 'to' ? RocketChat.models.Rooms.findOneById(item.rid) : RocketChat.models.Rooms.findOneByName(channel);\n\t\tconst targetChannel = type === 'from' ? RocketChat.models.Rooms.findOneById(item.rid) : RocketChat.models.Rooms.findOneByName(channel);\n\n\t\tif (!baseChannel) {\n\t\t\treturn RocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: item.rid,\n\t\t\t\tts: new Date(),\n\t\t\t\tmsg: TAPi18n.__('Channel_doesnt_exist', {\n\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\tsprintf: [channel]\n\t\t\t\t}, currentUser.language)\n\t\t\t});\n\t\t}\n\t\tconst users = baseChannel.usernames || [];\n\n\t\ttry {\n\t\t\tif (users.length > RocketChat.settings.get('API_User_Limit')) {\n\t\t\t\tthrow new Meteor.Error('error-user-limit-exceeded', 'User Limit Exceeded', {\n\t\t\t\t\tmethod: 'addAllToRoom'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (!targetChannel && ['c', 'p'].indexOf(baseChannel.t) > -1) {\n\t\t\t\tMeteor.call(baseChannel.t === 'c' ? 'createChannel' : 'createPrivateGroup', channel, users);\n\t\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t\t_id: Random.id(),\n\t\t\t\t\trid: item.rid,\n\t\t\t\t\tts: new Date(),\n\t\t\t\t\tmsg: TAPi18n.__('Channel_created', {\n\t\t\t\t\t\tpostProcess: 'sprintf',\n\t\t\t\t\t\tsprintf: [channel]\n\t\t\t\t\t}, currentUser.language)\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tMeteor.call('addUsersToRoom', {\n\t\t\t\t\trid: targetChannel._id,\n\t\t\t\t\tusers\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn RocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: item.rid,\n\t\t\t\tts: new Date(),\n\t\t\t\tmsg: TAPi18n.__('Users_added', null, currentUser.language)\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tconst msg = e.error === 'cant-invite-for-direct-room' ? 'Cannot_invite_users_to_direct_rooms' : e.error;\n\t\t\tRocketChat.Notifications.notifyUser(Meteor.userId(), 'message', {\n\t\t\t\t_id: Random.id(),\n\t\t\t\trid: item.rid,\n\t\t\t\tts: new Date(),\n\t\t\t\tmsg: TAPi18n.__(msg, null, currentUser.language)\n\t\t\t});\n\t\t}\n\t};\n}\nRocketChat.slashCommands.add('invite-all-to', inviteAll('to'));\nRocketChat.slashCommands.add('invite-all-from', inviteAll('from'));\nmodule.exports = inviteAll;\n"]}